import{r as e,R as t,_ as a,a as r,b as s,L as l,c as n,d as i,f as o}from"./prefetch.helper-4a4e89e7.js";import{m as c,u,x as m,y as d}from"./store-87403b6b.js";import{f as v,h as b,u as E}from"./BEConfigProvider-697f66d7.js";import{u as f}from"./useServiceFormContext-e5a256c1.js";import{u as g,b as p,c as y,S as w,a as h,p as _}from"./ServiceGeneralTab-52506f68.js";import"./holiday.helper-ca9c72dc.js";import"./color.helper-9b8c6bb8.js";function C({serviceForm:n,service_id:i,onDelete:o,disabled:u}){const[m,d]=e.useState(null);return t.createElement(a.ReactPopover.Root,{onOpenChange:e=>{e&&(async()=>{if(d(null),!i)return;const e=await c({in_args:{service_id:{values:[i],placeholder:"%d"}}});d(e)})()}},t.createElement(a.ReactPopover.Trigger,{asChild:!0},t.createElement(a.Button,{className:"bw-mr-auto msm:bw-hidden",disabled:u,size:"icon",color:"error",variant:"outline",tabIndex:-1},t.createElement(r.Trash,null))),t.createElement(v,null,t.createElement("div",{className:"bw-flex bw-items-start bw-gap-2"},t.createElement(r.Info,{className:"bw-h-5 bw-w-5 bw-fill-warning bw-text-base-bg1"}),t.createElement("div",null,"We Strongly ",t.createElement("strong",null,"Recommend Archiving")," instead of Delete!",t.createElement("br",null),s.sprintf(s.__("Deleting this %(service)s will cause","bookster"),l)," ",t.createElement("strong",null,null===m?"...":m," Appointments")," to be deleted?")),t.createElement(b,null,t.createElement(a.ReactPopover.Close,{asChild:!0},t.createElement(a.Button,{size:"small",color:"error",variant:"outline",onClick:()=>{o()}},"Delete")),t.createElement(a.ReactPopover.Close,{asChild:!0},t.createElement(a.Button,{size:"small",onClick:()=>(n.setFieldValue("activated",!1),void n.submit())},"Archive")))))}function F(){const r=u((e=>e.resetServiceForm)),{toast:c}=a.useToast(),v=g(),{data:b,isLoading:F}=p(v),k=E();function D(){k(".."),r()}const{form:S}=f(),T=n.useQueryClient(),A=n.useMutation({mutationKey:["services",v,"edit"],mutationFn:({id:e,values:t})=>m(e,t),onSuccess:e=>{T.setQueryData(["service",v],e),T.invalidateQueries({queryKey:["services"]})}}),L=n.useMutation({mutationKey:["services",v,"delete"],mutationFn:d,onSuccess:()=>{T.removeQueries({queryKey:["service",v]}),T.invalidateQueries({queryKey:["services"]})}}),N=n.useActiveAgents(),R=e.useMemo((()=>{if(b){const e=y(b,N);return i.booksterHooks.applyFilters(i.HOOK_NAMES.adminServiceForm.initFormValues,e,b)}}),[b,N]);e.useEffect((()=>{R&&(S.resetFields(),S.setFieldsValue(R))}),[R]);const j=F||!b&&!F||A.isLoading||L.isLoading;return t.createElement(t.Fragment,null,t.createElement(a.DrawerHeader,null,t.createElement(a.DrawerTitle,null,s.sprintf(s.__("Edit %(service)s","bookster"),l)),t.createElement(a.DrawerCloseIcon,null)),t.createElement(a.DrawerBody,null,t.createElement(a.LoadingOverlay,{loading:j}),t.createElement(o.Form,{form:S,initialValues:R,disabled:j,layout:"vertical",scrollToFirstError:!0,onFinish:e=>{!async function(e){if(v&&b)try{const t=_(e);await A.mutateAsync({id:b.service_id,values:t}),c.success(s.sprintf(s.__("%(service)s has been Saved Successfully!","bookster"),l)),D()}catch(t){c.error(await n.getErrorMsg(t))}}(e)}},t.createElement(a.TabsRoot,{defaultValue:"general"},t.createElement(a.TabsList,{"aria-label":"tabs settings"},t.createElement(a.LineTabsTrigger,{value:"general"},s.__("General","bookster")),t.createElement(a.LineTabsTrigger,{value:"available"},s.__("Available","bookster"))),t.createElement(a.TabsContent,{value:"general"},t.createElement(w,null)),t.createElement(a.TabsContent,{value:"available"},t.createElement(h,null))),t.createElement("button",{type:"submit",className:"bw-hidden"}))),t.createElement(a.DrawerFooter,null,b?t.createElement(C,{serviceForm:S,disabled:j,service_id:b.service_id,onDelete:async function(){if(v&&b)try{await L.mutateAsync(b.service_id),c.success(s.sprintf(s.__("%(service)s has been Deleted Successfully!","bookster"),l)),D()}catch(e){c.error(await n.getErrorMsg(e))}}}):null,t.createElement(a.DrawerClose,{asChild:!0},t.createElement(a.Button,{key:"back",tabIndex:-1,variant:"trivial",className:"bw-min-w-[8rem]"},s.__("Cancel","bookster"))),t.createElement(a.Button,{key:"submit",disabled:j,className:"bw-min-w-[8rem]",onClick:()=>S.submit()},s.__("Save","bookster"))))}export{F as default};
