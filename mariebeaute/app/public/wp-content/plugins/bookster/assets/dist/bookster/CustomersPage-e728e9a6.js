import{c as e,R as t,_ as a,r as l,a as n,g as r,b as s,L as m}from"./prefetch.helper-4a4e89e7.js";import{P as o,a as c}from"./UIComponents-1eb3bdbf.js";import{u}from"./BEConfigProvider-697f66d7.js";import{u as i}from"./usePagination-047a16d8.js";import{u as w}from"./index-ad7a2af3.js";import"./index-f9ec547e.js";function b({children:l}){const n=e.useMatch("/customers"),r=u(),s=null===n,m=e.useIsMutating({mutationKey:["customers"]});return t.createElement(a.DrawerRoot,{open:s,onOpenChange:e=>{e||m||r(".")}},t.createElement(a.Drawer,null,l))}function d(){const[o]=e.useSearchParams(),c=o.get("keywords"),b=w(c,{wait:500}),{pagination:d,pagingPayload:E,setTotal:p,setCurrent:g}=i(),f={...E,...b?{keywords:b}:{}},{data:h,isLoading:v}=e.useQuery({queryKey:["customers",f],queryFn:()=>e.queryCustomers(f),keepPreviousData:!0}),_=e.useQueryClient(),N=u();return l.useEffect((()=>{p((null==h?void 0:h.total)||0),(null==h?void 0:h.total)&&0===(null==h?void 0:h.data.length)&&g(1)}),[h]),t.createElement(t.Fragment,null,t.createElement(a.TableBorder,null,t.createElement(a.Table,{className:"btr-fullpage-table bw-bg-white"},t.createElement(a.TableHeader,null,t.createElement(a.TableHeadRow,null,t.createElement(a.TableHead,null,"Name"),t.createElement(a.TableHead,null,"Email"),t.createElement(a.TableHead,{className:"bw-w-3/12"},"Phone"),t.createElement(a.TableHead,{className:"bw-w-2/12"},"WP User"),t.createElement(a.TableHead,{className:"bw-w-16"}))),t.createElement(a.TableBody,null,(v||0===(null==h?void 0:h.data.length))&&t.createElement(a.TableRow,null,t.createElement(a.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},t.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-base-foreground/60"},v?"Loading...":"No Data Found"))),null==h?void 0:h.data.map((e=>t.createElement(a.TableRow,{className:"btr-has-action-link",onClick:()=>{var t;const a=null==(t=null==window?void 0:window.getSelection())?void 0:t.toString();var l;(null==a?void 0:a.length)||(N(`${(l=e).customer_id}`),_.setQueryData(["customer",l.customer_id],l))},key:e.customer_id},t.createElement(a.TableCell,null,t.createElement("div",{key:e.customer_id,className:"bw-flex bw-items-center bw-gap-1.5"},t.createElement(a.Avatar,{className:"bw-h-5 bw-w-5"},t.createElement(a.AvatarImage,{src:e.transient_avatar_url}),t.createElement(a.AvatarFallback,{className:"bw-text-xs"},t.createElement(n.UserRound,{className:"bw-h-3 bw-w-3"}))),e.first_name," ",e.last_name)),t.createElement(a.TableCell,null,e.email),t.createElement(a.TableCell,null,e.phone),t.createElement(a.TableCell,{className:"bw-flex bw-items-center bw-gap-1.5"},e.wp_user_id&&e.wp_user_display_name?t.createElement(t.Fragment,null,t.createElement(n.Link2,null),t.createElement(r.Default,{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${e.wp_user_id}`,target:"_blank",onClick:e=>e.stopPropagation()},e.wp_user_display_name)):t.createElement(t.Fragment,null,t.createElement(n.Unlink2,null),t.createElement("span",null,"Not Linked"))),t.createElement(a.TableCell,null,t.createElement(a.Tooltip,{content:s.sprintf(s.__("Edit %(customer)s","bookster"),m)},t.createElement(n.SquarePen,{className:"btr-row-action-link bw-h-3.5 bw-w-3.5 bw-text-primary hover:bw-text-primary/60"}))))))))),t.createElement(a.Pagination,{pagination:d,onNavChange:g}))}function E({className:l,...r}){const[s,m]=e.useSearchParams(),o=s.get("keywords");return t.createElement("div",{className:"bw-relative"},t.createElement(a.InputPrefix,null,t.createElement(n.Search,null)),t.createElement(a.Input,{className:a.clsx("bw-ps-10",l),defaultValue:o??"",withStatus:!1,onChange:e=>{const t=e.target.value??"";var a;a=t,m((e=>(e.set("keywords",a),e)))},placeholder:"Customer Name, Email, Phone",...r}))}function p(){return t.createElement(o,null,t.createElement(c.Wrapper,null,t.createElement(c.Title,null,m.customers),t.createElement(E,{className:"bw-w-72 bw-flex-none"})),t.createElement(d,null),t.createElement(b,null,t.createElement(e.Outlet,null)))}export{p as default};
