import{c as e,f as t,_ as a,R as r,b as l,a as n,g as s,v as o,r as m,d as i}from"./prefetch.helper-4a4e89e7.js";import{v as u,_ as c}from"./phoneInput.helper-24509875.js";import{A as d}from"./AvatarPicker-e9de6b9b.js";import{H as _}from"./HiddenInput-2f0ce489.js";import{p,q as b,r as E}from"./DeleteAppointmentButton-e4b7a1de.js";function w(){const{customerId:t}=e.useParams();return isNaN(Number(t))?null:Number(t)}function f(t){return e.useQuery({queryKey:["customer",t],queryFn:()=>t?p(t):null,staleTime:0})}function F(){const m=t.Form.useFormInstance(),{toast:i}=a.useToast(),u=w(),{data:c}=f(u),d=null===u,_=t.Form.useWatch("wp_user_id",m),p=t.Form.useWatch("wp_user_display_name",m),F=_&&p,k=e.useQueryClient(),g=e.useMutation({mutationFn:({id:e,email:t})=>b(e,t),onSuccess:e=>{m.setFieldsValue({wp_user_id:e.wp_user_id,wp_user_display_name:e.wp_user_display_name}),k.invalidateQueries({queryKey:["customers"]})}}),h=e.useMutation({mutationFn:({id:e})=>E(e),onSuccess:e=>{m.setFieldsValue({wp_user_id:e.wp_user_id,wp_user_display_name:e.wp_user_display_name}),k.invalidateQueries({queryKey:["customers"]})}});return r.createElement(r.Fragment,null,d?null:r.createElement(t.Form.Item,{label:r.createElement("span",{className:"bw-flex bw-items-center bw-gap-1"},r.createElement("span",null,l.__("Wordpress User","bookster")," :"),F?r.createElement(r.Fragment,null,h.isLoading?r.createElement(n.Loader2,{className:"bw-animate-spin"}):r.createElement(s.Default,{onClick:async function(){(null==c?void 0:c.customer_id)&&await h.mutateAsync({id:c.customer_id})}},l.__("Unlink Now","bookster"))):r.createElement(r.Fragment,null,g.isLoading?r.createElement(n.Loader2,{className:"bw-animate-spin"}):r.createElement(s.Default,{onClick:async function(){if(!(null==c?void 0:c.customer_id))return;try{await m.validateFields(["email","first_name","last_name"])}catch(a){return}const t=m.getFieldValue("email");if(t===c.email)try{await g.mutateAsync({id:c.customer_id,email:t})}catch(a){i.error(await e.getErrorMsg(a))}else i.warning("Email has changed! Please save form before linking.")}},l.__("Link Now","bookster")))),tooltip:"Link Customer with WP User to allow them to login and browse Appointment History."},F?r.createElement(o.Default,{className:"bw-flex bw-items-center bw-gap-1.5"},r.createElement(n.Link2,null)," ",l.__("Linked to the WP User","bookster"),r.createElement(s.Default,{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${_}`,target:"_blank"},p),"."):r.createElement(o.Default,{className:"bw-flex bw-items-center bw-gap-1.5"},r.createElement(n.Unlink2,null)," ",l.__("Not Linked to any WP User.","bookster"))),r.createElement(t.Form.Item,{name:"wp_user_id",hidden:!0},r.createElement(t.InputNumber,null)),r.createElement(t.Form.Item,{name:"wp_user_display_name",hidden:!0},r.createElement(a.Input,null)))}function k(){const e=w(),{data:n}=f(e),[s,o]=m.useState(""),p=t.Form.useFormInstance(),b=t.Form.useWatch("wp_user_id",p);return m.useEffect((()=>{n&&o((null==n?void 0:n.transient_avatar_url)??"")}),[n]),r.createElement(r.Fragment,null,r.createElement(d,{avatarSrc:s,onSelectAvatar:e=>{p.setFieldValue("avatar_id",+e.id),o(e.url)}}),r.createElement(t.Form.Item,{name:"avatar_id",hidden:!0},r.createElement(_,null)),r.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},r.createElement("div",null,r.createElement(t.Form.Item,{label:l.__("First Name","bookster"),name:"first_name",rules:[{required:!0}]},r.createElement(a.Input,{placeholder:l.__("Please enter First Name","bookster"),autoFocus:!0}))),r.createElement("div",null,r.createElement(t.Form.Item,{label:l.__("Last Name","bookster"),name:"last_name",rules:[{required:!0}]},r.createElement(a.Input,{placeholder:l.__("Please enter Last Name","bookster")}))),r.createElement("div",null,r.createElement(t.Form.Item,{label:l.__("Email","bookster"),name:"email",rules:[{required:!0},{type:"email",validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"],tooltip:void 0!==b&&r.createElement(r.Fragment,null,l.__("Please change Email from","bookster"),"  ",r.createElement("a",{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${b}`,className:"bw-text-info",target:"_blank"},l.__("Wordpress Profile","bookster")))},r.createElement(a.Input,{placeholder:l.__("Please enter Email","bookster"),disabled:void 0!==b}))),r.createElement("div",null,r.createElement(t.Form.Item,{label:l.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:u,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},r.createElement(c,null))),r.createElement("div",{className:"bw-col-span-full"},r.createElement(F,null)),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminCustomerForm.AfterWpUser,[]),r.createElement("div",{className:"bw-col-span-full"},r.createElement(t.Form.Item,{label:l.__("Notes by Customer","bookster"),name:"customer_note"},r.createElement(a.Textarea,{rows:3,placeholder:l.__("Please enter Note","bookster")}))),r.createElement("div",{className:"bw-col-span-full"},r.createElement(t.Form.Item,{label:l.__("Notes by Staff","bookster"),name:"admin_note"},r.createElement(a.Textarea,{rows:3,placeholder:l.__("Please enter Note","bookster")}))),i.booksterHooks.applyFilters(i.HOOK_NAMES.adminCustomerForm.EndForm,[])),r.createElement("button",{type:"submit",className:"bw-hidden"}))}export{k as C,w as a,f as u};
