import{c as e,R as t,_ as r,f as a,r as s,b as n,L as o}from"./prefetch.helper-4a4e89e7.js";import{u as l}from"./store-87403b6b.js";import{u as i,C as m}from"./BEConfigProvider-697f66d7.js";import{u,C as c}from"./CustomerFormContent-cbddc6fa.js";import{m as d,v as E,e as p,n as w}from"./DeleteAppointmentButton-e4b7a1de.js";import{D as y}from"./customer.helper-d5537c29.js";function b({parentPath:a,children:s}){const n=e.useMatch(a),o=i(),m=l((e=>e.resetAppointmentForm)),u=null===n,c=e.useIsMutating({mutationKey:["appointments"]});return t.createElement(r.DrawerRoot,{open:u,onOpenChange:e=>{e||c||(o("."),m())}},t.createElement(r.Drawer,null,s))}function f(){const{toast:i}=r.useToast(),[,m]=l((e=>e.appointments.form.nestedCustomer)),p=l((e=>e.closeAppointmentNestedCustomer)),w=isNaN(Number(m))?null:Number(m),{data:y,isLoading:b}=u(w),[f]=a.Form.useForm(),C=e.useQueryClient(),F=e.useMutation({mutationKey:["customers",w,"edit"],mutationFn:({id:e,values:t})=>d(e,t),onSuccess:e=>{C.setQueryData(["customer",w],e),C.invalidateQueries({queryKey:["customers"]})}});s.useEffect((()=>{y&&(f.resetFields(),f.setFieldsValue(y))}),[y]);const _=b||!y&&!b||F.isLoading;return t.createElement(t.Fragment,null,t.createElement(r.DrawerHeader,null,t.createElement(r.DrawerTitle,null,n.sprintf(n.__("Edit %(customer)s","bookster"),o)),t.createElement(r.DrawerCloseIcon,null)),t.createElement(r.DrawerBody,null,t.createElement(r.LoadingOverlay,{loading:_}),t.createElement(a.Form,{form:f,disabled:_,layout:"vertical",scrollToFirstError:!0,onFinish:t=>{!async function(t){if(w&&y)try{t.email&&t.email!==y.email&&await E(t.email),await F.mutateAsync({id:y.customer_id,values:t}),i.success(n.sprintf(n.__("%(customer)s has been Saved Successfully!","bookster"),o)),p()}catch(r){i.error(await e.getErrorMsg(r))}}(t)}},t.createElement(c,null))),t.createElement(r.DrawerFooter,null,t.createElement(r.DrawerClose,{asChild:!0},t.createElement(r.Button,{key:"back",tabIndex:-1,variant:"trivial",className:"bw-min-w-[8rem]"},n.__("Cancel","bookster"))),t.createElement(r.Button,{key:"submit",disabled:_,className:"bw-min-w-[8rem]",onClick:()=>f.submit()},n.__("Save","bookster"))))}function C(){const s=l((e=>e.closeAppointmentNestedCustomer)),{toast:i}=r.useToast(),{form:m}=p(),[u]=a.Form.useForm(),d=e.useQueryClient(),b=e.useMutation({mutationKey:["customers","new"],mutationFn:w,onSuccess:e=>{d.setQueryData(["customer",e.customer_id],e),d.invalidateQueries({queryKey:["customers"]})}}),f=y;return t.createElement(t.Fragment,null,t.createElement(r.DrawerHeader,null,t.createElement(r.DrawerTitle,null,n.sprintf(n.__("New %(customer)s","bookster"),o)),t.createElement(r.DrawerCloseIcon,null)),t.createElement(r.DrawerBody,null,t.createElement(r.LoadingOverlay,{loading:b.isLoading}),t.createElement(a.Form,{form:u,initialValues:f,disabled:b.isLoading,layout:"vertical",scrollToFirstError:!0,onFinish:t=>{!async function(t){try{await E(t.email);const e=await b.mutateAsync(t);i.success(n.sprintf(n.__("%(customer)s has been Saved Successfully!","bookster"),o)),s(),m.setFieldsValue({customer_ids:[e.customer_id]})}catch(r){i.error(await e.getErrorMsg(r))}}(t)}},t.createElement(c,null))),t.createElement(r.DrawerFooter,null,t.createElement(r.DrawerClose,{asChild:!0},t.createElement(r.Button,{key:"back",tabIndex:-1,variant:"trivial",className:"bw-min-w-[8rem]"},n.__("Cancel","bookster"))),t.createElement(r.Button,{key:"submit",disabled:b.isLoading,className:"bw-min-w-[8rem]",onClick:()=>u.submit()},n.__("Save","bookster"))))}function F(){const[a]=l((e=>e.appointments.form.nestedCustomer)),s=l((e=>e.closeAppointmentNestedCustomer)),n=e.useIsMutating({mutationKey:["customers"]});return t.createElement(r.DrawerRoot,{open:"close"!==a,onOpenChange:e=>{e||n||s()}},t.createElement(r.Drawer,null,"close"===a&&t.createElement(m,null),"new"===a&&t.createElement(C,null),"edit"===a&&t.createElement(f,null)))}export{b as A,F as N};
