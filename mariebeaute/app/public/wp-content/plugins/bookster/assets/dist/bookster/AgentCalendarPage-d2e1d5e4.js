import{c as e,R as t,a,_ as n,b as r,d as s,r as l,f as i}from"./prefetch.helper-4a4e89e7.js";import{k as o}from"./DeleteAppointmentButton-e4b7a1de.js";import{u as m,S as c,g as p,a as d,b as u,C as E,m as f,c as v,d as w}from"./CalendarNav.styled-1832bdf1.js";import{P as b}from"./UIComponents-1eb3bdbf.js";import{A as g}from"./AgentAppointmentFormDrawer-a75f2b4a.js";import{m as h,a as j}from"./main-38921655.js";import{u as y,a as C,b as x}from"./page-agent.js";import{d as A}from"./appointment.helper-80ab8c9c.js";import{e as S,u as k,d as N}from"./BEConfigProvider-697f66d7.js";import{S as F,P as _}from"./queue.helper-9ff85512.js";import{u as P}from"./useAgentAppointmentEvents-94e6a9bb.js";import{A as T,a as M,b as B}from"./ApptsFilterService-7f63b074.js";import"./createBookTimeInput.helper-a66a36a8.js";import"./useBreakpoint-2ef0bad1.js";import"./index-f9ec547e.js";import"./useEffectWithTarget-688d6bb0.js";import"./index-ad7a2af3.js";import"./index-db6d4b60.js";import"./index-8ef1ff47.js";import"./lodash-f550b173.js";function R({isFetching:l,isSaving:i,...o}){const{getCalendarApi:c}=m(),{title:p,type:d}=y((e=>e.calendar.view)),u=y((e=>e.calendarToday)),E=y((e=>e.calendarPrev)),f=y((e=>e.calendarNext)),v=y((e=>e.calendarChangeView)),w=e.useQueryClient();return t.createElement(t.Fragment,null,t.createElement(V,{...o},t.createElement(Q,{onClick:()=>u(c())},"Today"),t.createElement("div",{className:"bw-mr-1 bw-inline-flex -bw-space-x-px"},t.createElement(D,{onClick:()=>E(c())},t.createElement(a.ChevronLeft,{className:"bw-h-5 bw-w-5"})),t.createElement(D,{onClick:()=>f(c())},t.createElement(a.ChevronRight,{className:"bw-h-5 bw-w-5"}))),t.createElement(I,null,p,t.createElement(F,{isSaving:i})),t.createElement(H,{onClick:()=>w.invalidateQueries({queryKey:["appointments","events"]})},t.createElement(a.RefreshCw,{className:l?"bw-animate-spin":""})),t.createElement(n.Select,{value:d,onValueChange:e=>{S({calendarViewAgent:e}),v(c(),e)}},t.createElement(n.SelectTrigger,{className:"bw-w-32",withStatus:!1},t.createElement(n.SelectValue,null)),t.createElement(n.SelectContent,null,t.createElement(n.SelectItem,{value:"dayGridMonth"},r.__("Month View","bookster")),t.createElement(n.SelectItem,{value:"timeGridWeek"},r.__("Week View","bookster"))))),t.createElement("div",{className:"bw-mb-3 bw-flex bw-flex-row bw-flex-wrap bw-items-center bw-gap-2"},t.createElement("span",{className:"bw-text-lg bw-font-semibold bw-text-base-foreground/80"},"Filters"),t.createElement(n.Separator,{orientation:"vertical",className:"bw-h-6 bw-bg-base-border"}),t.createElement(T,null),t.createElement(M,null),s.booksterHooks.applyFilters(s.HOOK_NAMES.adminCalendar.BeforeApptsFilterClear,[]),t.createElement(B,null)))}const{Wrapper:V,NavButton:D,Title:I,TodayButton:Q,ReloadButton:H}=c,W=new _;function q(){const[a,r]=l.useState(null),{activeStart:s,activeEnd:i,type:o}=y((e=>e.calendar.view)),c=y((e=>e.calendarRefresh)),w=C(),{businessHours:b,slotMinAbs:g,slotMaxAbs:S}=p(w.weekly_schedule??void 0),{toast:F}=n.useToast(),{invalidateLazy:_,invalidateNow:T,updateModel:M}=d(),B=u(s,i),{data:V,isFetching:D,isRefetching:I}=P(w.agent_id,B),{getCalendarApi:Q,calendarRef:H}=m();l.useEffect((()=>{if(void 0!==V&&H.current){const e=Q();e.batchRendering((()=>{e.removeAllEvents(),V.forEach((t=>e.addEvent(t)))}))}}),[V,H.current]),l.useEffect((()=>{c(Q())}),[]);const q=e.useQueryClient(),K=k();return t.createElement(t.Fragment,null,t.createElement(R,{className:"bw-mb-4",isSaving:a,isFetching:D||I}),t.createElement(E,{key:"agent-calendar",plugins:[h,j,f],initialView:o,allDaySlot:!1,slotMinTime:60*g*1e3,slotMaxTime:60*S*1e3,businessHours:b,eventContent:v,eventClick:async function(e){var t;e.jsEvent.preventDefault(),t=e.event.extendedProps.model,q.setQueryData(["appointment",t.appointment_id],t),K(`${t.appointment_id}`)},eventDrop:async function(t){if(!N.writeAppt)return;const a=t.event;if(!a.start||!a.end)return;const n=A(a.extendedProps.model,a.start,a.end);W.add((async()=>{r(!0);try{const e=await x(w.agent_id,parseInt(t.event.id),n);t.event.setExtendedProp("model",e),M(e),_()}catch(a){throw r(null),F.error(await e.getErrorMsg(a)),T(),t.revert(),a}}),(()=>{r(!1)}))},editable:N.writeAppt,schedulerLicenseKey:void 0}))}function K(){const[a]=i.Form.useForm();return t.createElement(b,null,t.createElement(w,null,t.createElement(q,null)),t.createElement(o.Provider,{value:{form:a}},t.createElement(g,{parentPath:"/calendar"},t.createElement(e.Outlet,null))))}export{K as default};
