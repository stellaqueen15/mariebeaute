import{c as e,d as t,R as a,_ as r,r as n,a as s,L as m,b as l}from"./prefetch.helper-4a4e89e7.js";import{p as o}from"./DeleteAppointmentButton-e4b7a1de.js";import{u as c}from"./index-ad7a2af3.js";const u=["code","date-from","date-to","status","payment","agent","service","customer"];function i(){const[n,s]=e.useSearchParams(),m=t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.apptsFilterSearchParamKeys,u),l=m.some((e=>n.get(e)));return a.createElement(r.Button,{className:r.clsx(!l&&"bw-hidden"),variant:"link",onClick:function(){s((e=>(m.forEach((t=>e.delete(t))),e)))}},"Clear Filters")}function d({className:t,...u}){const[i,d]=n.useState(!1),[b,w]=n.useState(""),p=c(b,{wait:300}),[E,v]=e.useSearchParams(),g=E.get("customer"),f=g?parseInt(g,10):null,h=e.useQueryClient(),{data:C}=e.useQuery(["customers",f],(async()=>f?await o(f):null)),{data:_,isFetching:y}=e.useQuery({queryKey:["customers",{keywords:p}],queryFn:async()=>p?await e.queryCustomers({keywords:p,limit:10}):await e.queryCustomers({limit:10}),keepPreviousData:!0}),N=[...C?[C]:[],...((null==_?void 0:_.data)??[]).filter((e=>!C||e.customer_id!==f))],x=n.useMemo((()=>f?a.createElement(a.Fragment,null,a.createElement(r.Separator,{orientation:"vertical"}),a.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},a.createElement(r.Avatar,{className:"bw-h-5 bw-w-5"},a.createElement(r.AvatarImage,{src:null==C?void 0:C.transient_avatar_url}),a.createElement(r.AvatarFallback,{className:"bw-text-xs"},a.createElement(s.UserRound,{className:"bw-h-3 bw-w-3"}))),a.createElement("span",null,C?`${C.first_name} ${C.last_name}`:`Customer #${f}`))):null),[C,f]);return a.createElement(r.Popover,{open:i,onOpenChange:d},a.createElement(r.ComboboxTrigger,{withStatus:!1,className:r.clsx("bw-w-auto bw-gap-1 bw-rounded-full bw-border-dashed bw-bg-base-bg1 bw-pe-2 bw-ps-2 bw-text-sm",t),...u},a.createElement(s.PlusCircle,{className:"h-2 w-2 bw-text-base-foreground/60"}),a.createElement("span",{className:"bw-text-base-foreground/60"},m.customer),x),a.createElement(r.PopoverPortal,null,a.createElement(r.PopoverContent,{className:"bw-w-[20rem] bw-p-0 bw-shadow-md",side:"bottom",align:"start"},a.createElement(r.Command,{loop:!0,shouldFilter:!1},a.createElement(r.CommandInput,{placeholder:m.customer,value:b,onValueChange:w,isFetching:y}),a.createElement(r.CommandList,{className:"bw-max-h-none"},a.createElement(r.CommandEmpty,null,l.sprintf(l.__("No %(customer)s found.","bookster"),m)),a.createElement(r.CommandGroup,null,N.map((e=>a.createElement(r.CommandItem,{key:e.customer_id,value:`${e.customer_id}`,keywords:[e.first_name,e.last_name,e.email,e.phone],onSelect:()=>(e=>{h.setQueryData(["customers",e.customer_id],e),v((t=>(t.set("customer",`${e.customer_id}`),t)))})(e)},a.createElement(r.ComboboxItemIcon,{isActive:f===e.customer_id}),a.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},a.createElement(r.Avatar,{className:"bw-h-5 bw-w-5"},a.createElement(r.AvatarImage,{src:e.transient_avatar_url}),a.createElement(r.AvatarFallback,{className:"bw-text-xs"},a.createElement(s.UserRound,{className:"bw-h-3 bw-w-3"}))),a.createElement("span",null,`${e.first_name} ${e.last_name}`)))))),f&&a.createElement(a.Fragment,null,a.createElement(r.CommandSeparator,{alwaysRender:!0}),a.createElement(r.CommandGroup,{forceMount:!0},a.createElement(r.CommandItem,{forceMount:!0,onSelect:()=>{v((e=>(e.delete("customer"),e)))},className:"bw-justify-center bw-py-2 bw-font-medium bw-text-base-foreground/60"},l.__("Clear Filter","bookster")))))))))}function b({className:t,...o}){const[c,u]=n.useState(!1),i=e.useActiveServices(),[d,b]=e.useSearchParams(),w=d.get("service"),p=(w?w.split(","):[]).map((e=>parseInt(e,10))),E=n.useMemo((()=>{if(0===p.length)return null;const e=i.flatMap((e=>e.services)).find((e=>e.service_id===p[0]));return e?a.createElement(a.Fragment,null,a.createElement(r.Separator,{orientation:"vertical"}),a.createElement("span",null,e.name),p.length>1&&a.createElement("span",null,"+",p.length-1)):null}),[p,i]);return a.createElement(r.Popover,{open:c,onOpenChange:u},a.createElement(r.ComboboxTrigger,{withStatus:!1,className:r.clsx("bw-w-auto bw-gap-1 bw-rounded-full bw-border-dashed bw-bg-base-bg1 bw-pe-2 bw-ps-2 bw-text-sm",t),...o},a.createElement(s.PlusCircle,{className:"h-2 w-2 bw-text-base-foreground/60"}),a.createElement("span",{className:"bw-text-base-foreground/60"},m.service),E),a.createElement(r.PopoverPortal,null,a.createElement(r.PopoverContent,{className:"bw-w-[20rem] bw-p-0 bw-shadow-md",side:"bottom",align:"start"},a.createElement(r.Command,{loop:!0},a.createElement(r.CommandInput,{placeholder:m.service}),a.createElement(r.CommandList,null,a.createElement(r.CommandEmpty,null,l.sprintf(l.__("No %(services)s found","bookster"),m)),i.map((e=>a.createElement(r.CommandGroup,{key:e.service_category_id,heading:e.name,className:"[&_[cmdk-group-heading]]:bw-ps-6"},e.services.map((e=>a.createElement(r.CommandItem,{key:e.service_id,value:e.name,onSelect:()=>(e=>{if(p.includes(e)){const t=p.filter((t=>t!==e));b((e=>(e.set("service",t.join(",")),e)))}else b((t=>(t.set("service",[...p,e].join(",")),t)))})(e.service_id)},a.createElement(r.ComboboxItemIcon,{isActive:p.includes(e.service_id)}),e.name)))))),p.length>0&&a.createElement(a.Fragment,null,a.createElement(r.CommandSeparator,{alwaysRender:!0}),a.createElement(r.CommandGroup,{forceMount:!0},a.createElement(r.CommandItem,{forceMount:!0,onSelect:()=>{b((e=>(e.delete("service"),e)))},className:"bw-justify-center bw-py-2 bw-font-medium bw-text-base-foreground/60"},l.__("Clear Filter","bookster")))))))))}export{b as A,d as a,i as b};
