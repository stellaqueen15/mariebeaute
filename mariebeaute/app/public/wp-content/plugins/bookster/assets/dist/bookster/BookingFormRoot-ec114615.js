import{c as e,d as t,q as a,e as o,T as n,B as r,C as s,r as l,E as i,R as c,_ as m,b as u,s as b,D as d,f as w,L as p,a as f,g,u as k,F as E}from"./prefetch.helper-4a4e89e7.js";import{g as y}from"./agentSchedule.helper-648c495b.js";import{c as v}from"./createBookTimeInput.helper-a66a36a8.js";import{E as h}from"./ErrorAlert-70706561.js";import{v as _,_ as x}from"./phoneInput.helper-24509875.js";import{S}from"./ServiceCard-c25895f8.js";const N=window.booksterPublicData.customizeSettings.content.steps;function A(){return{steps:[{title:N.service.title,description:N.service.description,phase:"browse",name:"service",acts:[a.ACT_NAME.selectService]},{title:N.agent.title,description:N.agent.description,phase:"browse",name:"agent",acts:[a.ACT_NAME.selectAgent]},{title:N.datetime.title,description:N.datetime.description,phase:"browse",name:"datetime",acts:[a.ACT_NAME.selectDateTime]},{title:N.contact.title,description:N.contact.description,phase:"checkout",name:"contact",acts:[a.ACT_NAME.formContact]},{title:N.checkout.title,description:N.checkout.description,phase:"checkout",name:"checkout",acts:[a.ACT_NAME.selectPayOption]},{title:N.confirmation.title,description:N.confirmation.description,phase:"complete",name:"confirmation",acts:[a.ACT_NAME.showAppointment]}]}}function C(t){return{context:{formId:t||e.genUniqueId(),parent:{is:"dialog"}},process:A()}}function M(t,a){return{context:{formId:a||e.genUniqueId(),parent:{is:"body",parentWidth:t}},process:A()}}function B(e,a={}){return t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.bookingConfig,e,a)}const F={sideSteps:15,mainContent:32,sideSummary:18,total:65,totalWhenEmptySummary:52},T={desktop:F.total*function(){const e=document.querySelector("html");return e?parseInt(window.getComputedStyle(e).fontSize):16}()},O=e=>e>=T.desktop?"desktop":"mobile";function D(){const e=o.dayjs().add(1,"minute").startOf("minute"),t=function(e){const[t,a]=window.booksterPublicData.generalSettings.book_restriction_earliest;if("no_restriction"===t||!a)return e;switch(t){case"minutes":case"hours":return e.add(a,t).startOf("minute");case"days":case"months":case"years":return e.add(a,t).startOf("day");default:return e.add(a,t)}}(e),a=function(e){const[t,a]=window.booksterPublicData.generalSettings.book_restriction_latest;if("no_restriction"===t||!a)return null;switch(t){case"minutes":case"hours":return e.add(a,t).endOf("minute");case"days":case"months":case"years":return e.add(a,t).endOf("day");default:return e.add(a,t)}}(e);return{now:e,earliest:t,latest:a}}function I(e,t){return null!==t&&e.isAfter(t)}const P=D();function L(e,t){let a=function(e,t){const a=e.format(o.YEAR_KEY_FORMAT),n=e.format(o.DATE_KEY_FORMAT),r=t[a];if(void 0===r)return;const s=r[n];return void 0!==s?s:void 0}(e,t.dayoff);return void 0!==a?a:(a=function(e,t){const a=e.format(o.YEAR_KEY_FORMAT),n=e.format(o.DATE_KEY_FORMAT);if(null!==t.specific_year){const e=t.specific_year[a];if(void 0!==e){const t=e[n];if(void 0!==t)return t}}const r=t.every_year;if(null!==r)return r[n]}(e,t.holiday),void 0!==a?a:function(e,t){const a=e.day();return!t[a].working||0===t[a].periods.length}(e,t.weekly))}function H(e){return o.dayjs().hour(e.hour).minute(e.minute).format(n)}function R(e,t){if(!t)return H(e);const o=a.Helper.booktime.createFromAbsMinute(e.absMinute+t);return`${H(e)} - ${H(o)}`}function j(e){return{...e,startLabel:H(e.start),endLabel:H(e.end)}}function K(){const n=a.useBookingStore(),c=l.useCallback((()=>{n.setState((e=>{const{now:t,earliest:a,latest:o}=D();e.datetime.timestamps.now=t,a===e.datetime.timestamps.earliest||a.isSame(e.datetime.timestamps.earliest)||(e.datetime.timestamps.earliest=a),o===e.datetime.timestamps.latest||(null==o?void 0:o.isSame(e.datetime.timestamps.latest))||(e.datetime.timestamps.latest=o)}))}),[n]);l.useEffect((()=>{const e=setInterval((()=>{c()}),15e3);return()=>clearInterval(e)}),[c]);const m=a.useBookingState((e=>e.select.agent)),u=l.useMemo((()=>null===m?null:y(m)),[m]),b=a.useBookingState((e=>e)),d=a.useBookingState((e=>e.datetime.timestamps)),w=a.useBookingState((e=>e.datetime.picker.bookMonth)),p=a.useBookingState((e=>e.select.service)),f=t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.bookingDuration,{bufferBefore:(null==p?void 0:p.buffer_before)||0,bufferAfter:(null==p?void 0:p.buffer_after)||0,duration:(null==p?void 0:p.duration)||0},b),g=l.useMemo((()=>null===p||null===u?null:function(e,t,n,s){const l=function(e,t){return e.map((e=>{const o=e.periods.map((e=>function(e,t){const o=[];let n=e.start.absMinute;const s=e.end.absMinute;for(;n+t<=s;n+=r){const e=a.Helper.booktime.createFromAbsMinute(n),r=a.Helper.booktime.createFromAbsMinute(n+t);o.push({start:e,end:r})}return{...e,timeSlots:o.map(j)}}(j(e),t)));return{periods:o}}))}(e.weekly,n),i={};let c=t.startOf("month");for(;c.isSame(t,"month");c=c.add(1,"day")){const t=(m=c.endOf("date"),u=s.earliest,m.isBefore(u)),a=I(c,s.latest),n=t||a,r=c.format(o.DAY_KEY_FORMAT),b=L(c,e);i[r]={isRestricted:n,isDayOff:b,periods:b?[]:l[c.day()].periods}}var m,u;return i}(u,w,f.duration,d)),[u,w,f.duration,d]),{data:k}=function(t,a){const n=e.useQuery({queryKey:["booked_appointments",t?t.agent_id:null,a.format("YYYY-MM")],queryFn:async()=>t?await s(t,a):null,staleTime:6e4,select:e=>e?function(e,t){const a={};let n=e.startOf("month");for(;n.isSame(e,"month");n=n.add(1,"day")){const e=n.format(o.DAY_KEY_FORMAT);a[e]=[]}return t.forEach((e=>{const t=o.dayjs(e.datetime_start).format(o.DAY_KEY_FORMAT);a[t].push(e)})),a}(a,e.data):null});return l.useEffect((()=>{t&&i(t,a.add(1,"month"))}),[t,a]),n}(m,w),E=l.useMemo((()=>null===g||null===f||null==k?null:function(e,t,n,r,s){const l={};let i=r.startOf("month");for(;i.isSame(r,"month");i=i.add(1,"day")){const r=i.format(o.DAY_KEY_FORMAT),c=e[r];if(c.isRestricted||c.isDayOff){l[r]={isRestricted:c.isRestricted,isDayOff:c.isDayOff,timeSlotCountTotal:0,timeSlotCountAvailable:0,periods:[]};continue}const m=i.isSame(s.earliest,"day"),u=m?a.Helper.booktime.createFromDayjs(s.earliest).absMinute:Number.MAX_SAFE_INTEGER,b=i.isSame(s.latest,"day"),d=b&&s.latest?a.Helper.booktime.createFromDayjs(s.latest).absMinute:-1;let w=0,p=0;const f=[];c.periods.forEach((e=>{const o=t[r],s=[];e.timeSlots.forEach((e=>{let t=!0;t&&m&&(t=e.start.absMinute>=u),t&&b&&(t=e.end.absMinute<=d),t&&(t=o.every((t=>!a.Helper.overlap.isApptOverlapWithTimeSlot(t,e.start.absMinute,n)))),t&&p++,w++,s.push({...e,isAvailable:t})})),f.push({...e,timeSlots:s})})),l[r]={isRestricted:c.isRestricted,isDayOff:c.isDayOff,timeSlotCountTotal:w,timeSlotCountAvailable:p,periods:f}}return l}(g,k,f,w,d)),[g,k,f,w,d]);return l.useMemo((()=>({computed:{bookingDuration:f,agentSchedule:u,monthTimeSlots:g,monthAvailableTimeSlots:E},mutate:{refreshTimestamps:c}})),[f,u,g,E])}const z={};function V(e,a){const{stepIndex:o,actIndex:n}=e.current,r=a.process.steps[o],s=o>0||n>0,l=!("complete"===r.phase)&&o>0,i=o<a.process.steps.length-1,c=n>0||l,m={nextAct:n<r.acts.length-1||i,prevAct:c,nextStep:i,prevStep:l,reset:s};return t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.canMutateProcess,m,e,a)}const Y=(e,o,n)=>{const r=a.beginMutatePrevAct(e,o);return t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.mutatePrevAct,!1,e,o,r,n)},q=(e,o,n)=>{const r=a.beginMutateNextAct(e,o);return t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.mutateNextAct,!1,e,o,r,n)};function $({children:e}){const o=a.useBookingConfig(),n=a.useBookingState((e=>e)),r=function(){const e=a.useBookingConfig(),o=a.useBookingStore(),n=a.useBookingState((e=>e.process)),r=a.useBookingState((e=>e.booked.state)),s=function(e,t){const{stepIndex:a,actIndex:o}=e.current,n=t.process.steps[a],r=n.acts[o];return{stepName:n.name,phase:n.phase,act:r,title:n.title,description:n.description}}(n,e),l=V(n,e);function i(t){if(t&&!t.prevAct)return;if(!t&&!l.prevAct)return;const a=o.getState();let n=!1;o.setState((t=>{n=Y(t,e,a)})),n&&i(V(o.getState().process,e))}function c(){if(!l.nextAct)return;const t=o.getState();let a=!1;o.setState((o=>{a=q(o,e,t)})),a&&c()}return"processing"===r&&(l.reset=!1),{computed:s,can:l,mutate:{nextAct:c,prevAct:i,nextStep:function(){if(!l.nextStep)return;const t=o.getState();let a=!1;o.setState((o=>{do{a=q(o,e,t)}while(o.process.current.stepIndex===t.process.current.stepIndex)})),a&&c()},prevStep:function(){if(!l.prevStep)return;const t=o.getState();let a=!1;o.setState((o=>{do{a=Y(o,e,t)}while(o.process.current.stepIndex===t.process.current.stepIndex)})),a&&i(V(o.getState().process,e))},reset:function(){if(!l.reset)return;const a=o.getState();o.setState((o=>{do{Y(o,e,a)}while(0!==o.process.current.stepIndex||0!==o.process.current.actIndex);t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.mutateReset,o,e,a)}))}}}}(),s=K(),i={process:r,datetime:s,input:function(e){const t=a.useBookingState((e=>e.select)),{service:o,agent:n,bookDate:r,bookTime:s,payOption:i,contact:c}=t,m=l.useMemo((()=>{if(!o)return;const e=a.makeBlueprintBooking(o,n,r,s,c);return a.calculateDetails(e)}),[o,n,r,s,c]),{apptInput:u,apptTransient:b}=l.useMemo((()=>{if(!(o&&n&&r&&s&&m&&c))return{apptInput:void 0,apptTransient:void 0};const t=e.bookingDuration||{duration:0,bufferBefore:0,bufferAfter:0},l=a.Helper.booktime.createFromAbsMinute(s.absMinute+t.duration),i=v(r,s,l,t.bufferBefore,t.bufferAfter),u={service_id:o.service_id,agent_ids:[n.agent_id],datetime_start:i.datetime_start};return{apptInput:u,apptTransient:{...u,...i}}}),[o,n,r,s,c]),d=l.useMemo((()=>{if(i){if("later"===i&&window.booksterPublicData.paymentGateway.later)return{payment_gateway:window.booksterPublicData.paymentGateway.later};if("full"===i&&window.booksterPublicData.paymentGateway.now)return{payment_gateway:window.booksterPublicData.paymentGateway.now};throw new Error("Sorry, the Payment is not available. Please contact the admin for more information.")}}),[i]);return{apptInput:u,bookingMetaInput:z,transactionInput:d,apptTransient:b,bookingDetailsValue:m}}(s.computed)},m=t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.bookingLogic,i,o,n);return c.createElement(a.BookingLogicContext.Provider,{value:m},e)}function W({className:e,...t}){const{formLayout:o,showSidebar:n,showSummary:r}=a.useBookingLayout(),{sidebar:s,main:l,summary:i}=a.useBookingParts();return c.createElement("div",{className:m.cx("bw-relative bw-flex bw-items-stretch bw-gap-0 bw-overscroll-none",e),style:{..."desktop"===o&&{width:`${r?F.total:F.totalWhenEmptySummary}rem`}},...t},n&&c.createElement(m.Slot,{key:s.key,className:"bw-flex bw-flex-none bw-flex-col bw-border-0 bw-border-r bw-border-solid bw-border-base-border bw-px-5 bw-py-4",style:{flexBasis:`${F.sideSteps}rem`}},s.node),c.createElement(m.Slot,{key:l.key,className:"bw-flex bw-flex-grow bw-flex-col",style:{flexBasis:`${F.mainContent}rem`,..."desktop"===o?{maxWidth:F.totalWhenEmptySummary-F.sideSteps+"rem"}:{}}},l.node),r&&c.createElement(m.Slot,{key:i.key,className:"bw-flex bw-flex-none bw-flex-col bw-overflow-auto bw-border-0 bw-border-l bw-border-solid bw-border-base-border",style:{flexBasis:`${F.sideSummary}rem`}},i.node))}const G=(e,t)=>c.createElement("span",{className:m.cx("bw-relative bw-flex bw-h-full bw-w-full bw-rounded-full bw-bg-muted",("process"===t.status||"finish"===t.status)&&"bw-bg-primary")},"process"===t.status&&c.createElement("span",{className:"bw-absolute bw-inline-flex bw-h-full bw-w-full bw-animate-ping bw-rounded-full bw-bg-primary/60"})),U=m.styled.span("bw-text-base bw-font-heading"),X=m.styled.span("bw-text-primary bw-font-heading bw-font-bold bw-text-lg"),Z=m.styled.span("bw-text-sm"),Q=m.styled.span("bw-invisible bw-text-sm");function J({className:o,...n}){const r=a.useBookingState((e=>e.process.current.stepIndex)),s=a.useBookingState((e=>e.customize.content.help)),i=function(){const o=a.useBookingConfig(),{process:n}=o,{datetime:r}=a.useBookingLogic(),s=a.useBookingState((e=>e.customize.content.steps)),i=a.useBookingState((e=>e.process.current.stepIndex)),m=a.useBookingState((e=>e.select)),w=a.useBookingState((e=>e.datetime.picker)),p=a.useBookingState((e=>e.booked));return l.useMemo((()=>{const{service:a,agent:l,bookDate:f,bookTime:g,contact:k}=m,E=n.steps.map(((t,o)=>{var n,m;const E=s[t.name],y=(null==E?void 0:E.title)??t.title,v=(null==E?void 0:E.description)??t.description,h={title:c.createElement(U,null,u.__(y,"bookster")),description:c.createElement(Q,null,"_")};switch(i===o&&(h.title=c.createElement(X,null,u.__(y,"bookster")),h.description=c.createElement(Z,null,u.__(v,"bookster"))),t.name){case"service":a&&(h.description=c.createElement(Z,null,a.name));break;case"agent":l&&(h.description=c.createElement(Z,null,`${l.first_name} ${l.last_name}`));break;case"datetime":f&&g?h.description=c.createElement(Z,null,f.format(d),c.createElement("br",null),R(g,null==(n=r.computed.bookingDuration)?void 0:n.duration)):w.bookDate&&w.bookTime?h.description=c.createElement(Z,null,w.bookDate.format(d),c.createElement("br",null),R(w.bookTime,null==(m=r.computed.bookingDuration)?void 0:m.duration)):w.bookDate&&!w.bookTime&&(h.description=c.createElement(Z,null,w.bookDate.format(d)));break;case"contact":(null==k?void 0:k.values)&&(h.description=c.createElement(Z,null,k.values.first_name," ",k.values.last_name));break;case"checkout":"success"===p.state&&p.appointment&&(h.description=c.createElement(Z,null,b.Decimal.fromString(p.appointment.booking.total_amount).isZero()?u.__("Free","bookster"):e.formatPrice(p.appointment.booking.total_amount)))}return h}));return t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.stepItems,E,o)}),[o,s,i,m,w,p])}();return c.createElement("div",{className:m.cx(o),...n},c.createElement(w.Steps,{progressDot:G,direction:"vertical",current:r,items:i}),c.createElement("div",{className:"bw-mt-auto"},c.createElement(m.Separator,{className:"bw-my-6"}),c.createElement("div",{className:"bw-whitespace-pre-wrap"},u.__(s,"bookster"))))}function ee({className:t,...o}){const{bookingDetailsValue:n}=a.useBookingLogic().input;return c.createElement("div",{className:m.cx("bw-flex bw-min-h-[15rem] bw-flex-col bw-border-0 bw-border-t bw-border-solid bw-border-base-border bw-p-4",t),...o},c.createElement("p",{className:"bw-mb-1 bw-text-sm bw-leading-none bw-text-base-foreground/60"},"Booking Details"),c.createElement("div",{className:"bw-flex-grow bw-py-2"},null==n?void 0:n.booking.items.map((t=>c.createElement("p",{key:t.id,className:"bw-mb-1 bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",null,t.title," ",t.quantity>1&&"(x"+t.quantity+")"),e.formatPrice(t.amount)))),null==n?void 0:n.adjustment.items.map((t=>c.createElement("p",{key:t.id,className:"bw-mb-1 bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",null,t.title),e.formatPrice(t.amount)))),null==n?void 0:n.tax.items.map((t=>c.createElement("p",{key:t.id,className:"bw-mb-1 bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",null,t.title),e.formatPrice(t.amount))))),c.createElement("p",{className:"bw-mb-0 bw-flex bw-w-full bw-items-center bw-justify-between bw-border-0 bw-border-t bw-border-solid bw-border-base-border bw-pt-3 bw-text-lg bw-font-bold"},c.createElement("span",{className:"bw-font-medium"},"Total"),n&&e.formatPrice(n.tax.total)))}function te({className:e,...t}){const{summarySelect:o,summaryCost:n}=a.useBookingParts();return c.createElement("div",{className:m.cx(e),...t},c.createElement("div",null,c.createElement("div",{className:"bw-flex bw-h-14 bw-items-center bw-pl-4 bw-pr-2"},c.createElement("p",{className:"bw-mb-0 bw-flex-grow bw-font-heading bw-text-lg bw-font-semibold bw-text-primary"},"SUMMARY"),c.createElement(a.CloseDialogButton,null)),c.createElement(m.Separator,null),c.createElement(m.Slot,{className:"bw-px-4 bw-py-3",key:o.key},o.node)),c.createElement(m.Slot,{className:"bw-mt-auto",key:n.key},n.node))}function ae({className:e,...o}){var n;const r=a.useBookingState((e=>e.select)),s=a.useBookingState((e=>e.customize.labels)),{datetime:l}=a.useBookingLogic(),{service:i,agent:b,bookDate:w,bookTime:f,payOption:g,contact:k}=r;return c.createElement("div",{className:m.cx(e),...o},c.createElement("div",{className:"bw-mb-4"},i&&c.createElement("h4",{className:"bw-m-0 bw-mb-1 bw-text-lg"},i.name),w&&f&&c.createElement("p",{className:"bw-text-sm bw-text-primary"},w.format(d)," |"," ",R(f,null==(n=l.computed.bookingDuration)?void 0:n.duration))),t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.SummarySelectAfterService,[]),(null==k?void 0:k.values)&&c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},p.customer),k.values.first_name," ",k.values.last_name),b&&c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},s.agent),b.first_name," ",b.last_name),g&&c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},u.__("Payment","bookster"),":"),"later"===g&&"Will Pay Locally","full"===g&&"Pay in Full"))}function oe(o){const n=e.usePublicActiveAgents(),r=a.useBookingStore(),s=a.useBookingState((e=>e.select.service)),l=a.useBookingLogic().process,i=a.useBookingConfig();let u=n.filter((e=>{if(s){const t=e.available_agent_services.find((e=>e.service_id===s.service_id));if(t&&!1===t.available)return!1}return!0}));return u=t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.agentsList,u,r,i),c.createElement("div",{...o},c.createElement(a.MainHeader,null),c.createElement(m.ScrollArea,{className:"btr-main-scrollarea"},c.createElement(m.XyzTransitionGroup,{appear:!0,className:"bw-grid bw-grid-cols-3 bw-gap-4 bw-p-4",xyz:"fade down-4 stagger-0.5"},u.map((e=>c.createElement("div",{key:e.agent_id,className:"bw-cursor-pointer bw-rounded-lg bw-border bw-border-solid bw-border-base-border bw-bg-base-bg1 bw-p-3 bw-shadow-sm bw-duration-300 bw-ease-in-out hover:bw-shadow-md",onClick:()=>function(e){r.setState((t=>{t.select.agent=e})),l.mutate.nextAct()}(e)},c.createElement("div",{className:"bw-flex bw-flex-col bw-items-center"},c.createElement(m.Avatar,{className:"bw-h-28 bw-w-28 bw-shadow"},c.createElement(m.AvatarImage,{src:e.transient_avatar_url}),c.createElement(m.AvatarFallback,{className:"bw-text-lg"},c.createElement(f.UserRound,{className:"bw-h-8 bw-w-8"}))),c.createElement("div",{className:"bw-mt-3 bw-text-center bw-font-semibold bw-leading-4"},e.first_name," ",e.last_name))))))),c.createElement(a.MainFooter,null))}function ne(){return c.createElement("svg",{width:43,height:50,viewBox:"0 0 43 50",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c.createElement("g",{clipPath:"url(#clip0_225_1307)"},c.createElement("path",{d:"M33.2 45.4L29.8 43L25.6 46L21.4 43L17 46L12.8 43L8.60001 46L4.40001 43L0.900005 45.4C0.600005 45.6 0.100006 45.4 0.100006 45V1C0.100006 0.6 0.600005 0.4 0.900005 0.6L4.40001 3L8.60001 0L12.8 3L17 0L21.2 3L25.4 0L29.6 3L33.1 0.6C33.5 0.3 34 0.6 34 1V45C34 45.4 33.5 45.7 33.2 45.4Z",fill:"#56AAFF"}),c.createElement("path",{d:"M42.1 30.5L37.7 22.1C37.4 21.4 36.7 21 35.9 21H33.9V32.1C33.9 32.9 33.2 33.6 32.4 33.6C31.6 33.6 31 32.9 31 32.1V23.6C31 21.9 29.7 20.6 28 20.6C26.3 20.6 25 21.9 25 23.6V40.1C25 41.8 25.4 43.4 26.2 44.9L29 50H41L42.8 33.9C42.9 32.7 42.7 31.5 42.1 30.5Z",fill:"#D9DCE1"}),c.createElement("path",{d:"M23 12H27",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),c.createElement("path",{d:"M27 17H23",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),c.createElement("path",{d:"M7 12H17",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),c.createElement("path",{d:"M20 17H7",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),c.createElement("path",{d:"M17 22H7",stroke:"white",strokeWidth:2,strokeMiterlimit:10}),c.createElement("path",{d:"M17.8 36.8V38.4H16.3V36.8C15.3 36.6 14.3 36.2 13.5 35.4L14.6 34C15.4 34.7 16.3 35.1 17.1 35.1C17.8 35.1 18.3 34.8 18.3 34.2C18.3 33.6 17.9 33.3 16.7 33C15.1 32.5 13.7 32 13.7 30.2C13.7 28.8 14.6 27.7 16.3 27.5V25.8H17.8V27.5C18.7 27.7 19.6 28.1 20.2 28.6L19.1 30C18.3 29.5 17.6 29.2 16.9 29.2C16.2 29.2 15.8 29.5 15.8 30C15.8 30.5 16.3 30.8 17.3 31.1C19.2 31.7 20.4 32.2 20.4 34C20.4 35.5 19.4 36.6 17.8 36.8Z",fill:"#0478ED"})),c.createElement("defs",null,c.createElement("clipPath",{id:"clip0_225_1307"},c.createElement("rect",{width:43,height:50,fill:"white"}))))}function re(){const t=a.useBookingStore(),o=a.useBookingState((e=>e.select.contact)),n=a.useBookingState((e=>e.booked.state)),{process:r,input:s}=a.useBookingLogic(),{apptInput:i,bookingMetaInput:b}=s,[d,w]=l.useState(null);return c.createElement("div",{className:"bw-relative bw-flex-grow"},c.createElement(m.XyzTransitionGroup,{appear:!0,className:"bw-mx-auto bw-flex bw-h-full bw-max-h-[24rem] bw-items-center bw-justify-around bw-gap-5 bw-p-4",xyz:"fade down-4 stagger-0.5"},c.createElement("div",{className:"bw-min-w-40"},c.createElement(se,{onClick:async function(){if(!i||!o||!b)throw new Error("Error trying to create booking!");if("idle"===n)try{t.setState((e=>{e.booked.state="processing"}));const{appointment:a,transaction:n,customer:s}=await e.requestBooking({apptInput:i,bookingMetaInput:b,transactionInput:{payment_gateway:"payment-free"},contactInput:o});t.setState((e=>{e.booked={state:"success",appointment:a,transaction:n,customer:s}})),r.mutate.nextStep()}catch(a){w(await e.getErrorMsg(a)),t.setState((e=>{e.booked.state="idle",e.select.payOption=null}))}}},c.createElement(le,null,c.createElement(ne,null)),c.createElement(ie,null,u.__("Confirm free booking","bookster"))))),d&&c.createElement(h,{className:"bw-mx-auto bw-mt-4 bw-max-w-[30rem]"},d))}const se=m.styled.div("bw-cursor-pointer bw-rounded-2xl bw-border bw-border-solid bw-border-black/10 bw-px-4 bw-py-3 bw-text-center bw-duration-300 hover:bw-border-primary  hover:bw-shadow-[0_7px_35px_rgba(0,0,0,0.1)]"),le=m.styled.span("bw-mx-auto bw-my-0 bw-block bw-h-14 bw-w-14"),ie=m.styled.p("bw-mb-0 bw-mt-3 bw-text-base bw-text-nowrap bw-font-semibold"),ce=window.booksterPublicData.paymentGateway;window.booksterPublicData.paymentGateway.now;const me=null!==ce.later,ue=null!==ce.now;function be(){return c.createElement("svg",{width:63,height:51,viewBox:"0 0 63 51",fill:"none",xmlns:"http://www.w3.org/2000/svg"},c.createElement("g",{clipPath:"url(#clip0_225_1317)"},c.createElement("path",{d:"M43.8438 32.9062H3.10938C1.75156 32.9062 0.640625 31.7953 0.640625 30.4375V3.28125C0.640625 1.92344 1.75156 0.8125 3.10938 0.8125H43.8438C45.2016 0.8125 46.3125 1.92344 46.3125 3.28125V30.4375C46.3125 31.7953 45.2016 32.9062 43.8438 32.9062Z",fill:"#D9DCE1"}),c.createElement("path",{d:"M59.8906 50.1875H19.1562C17.7984 50.1875 16.6875 49.0766 16.6875 47.7188V20.5625C16.6875 19.2047 17.7984 18.0938 19.1562 18.0938H59.8906C61.2484 18.0938 62.3594 19.2047 62.3594 20.5625V47.7188C62.3594 49.0766 61.2484 50.1875 59.8906 50.1875Z",fill:"#56AAFF"}),c.createElement("path",{d:"M62.3594 25.5H16.6875V32.9062H62.3594V25.5Z",fill:"#0478ED"})),c.createElement("defs",null,c.createElement("clipPath",{id:"clip0_225_1317"},c.createElement("rect",{width:"63",height:"51",fill:"white"}))))}function de(){const t=a.useBookingStore(),o=a.useBookingState((e=>e.select.contact)),n=a.useBookingState((e=>e.booked.state)),{process:r,input:s}=a.useBookingLogic(),{apptInput:i,transactionInput:b,bookingMetaInput:d}=s,[w,p]=l.useState(null);return l.useEffect((()=>{!async function(){if(i&&b&&o&&d&&"payment-later"===b.payment_gateway&&"idle"===n)try{t.setState((e=>{e.booked.state="processing"}));const{appointment:a,transaction:n,customer:s}=await e.requestBooking({apptInput:i,bookingMetaInput:d,transactionInput:{payment_gateway:"payment-later"},contactInput:o});t.setState((e=>{e.booked={state:"success",appointment:a,transaction:n,customer:s}})),r.mutate.nextStep()}catch(a){p(await e.getErrorMsg(a)),t.setState((e=>{e.booked.state="idle",e.select.payOption=null}))}}()}),[i,b,o,d]),c.createElement("div",{className:"bw-relative bw-flex-grow"},c.createElement(m.XyzTransitionGroup,{appear:!0,className:"bw-grid bw-h-full bw-max-h-[24rem] bw-auto-cols-auto bw-grid-flow-col-dense bw-place-content-center bw-gap-5 bw-p-4",xyz:"fade down-4 stagger-0.5"},me&&c.createElement("div",{className:"bw-min-w-28"},c.createElement(we,{onClick:function(){t.setState((e=>{e.select.payOption="later"}))}},c.createElement(pe,null,c.createElement(ne,null)),c.createElement(fe,null,u.__("Pay Later","bookster")))),ue&&c.createElement("div",{className:"bw-min-w-28"},c.createElement(we,{onClick:function(){t.setState((e=>{e.select.payOption="full"})),r.mutate.nextAct()}},c.createElement(pe,null,c.createElement(be,null)),c.createElement(fe,null,u.__("Pay Now","bookster"))))),w&&c.createElement(h,{className:"bw-mx-auto bw-mt-4 bw-max-w-[30rem]"},w))}const we=m.styled.div("bw-cursor-pointer bw-rounded-2xl bw-border bw-border-solid bw-border-black/10 bw-px-4 bw-py-3 bw-text-center bw-duration-300 hover:bw-border-primary  hover:bw-shadow-[0_7px_35px_rgba(0,0,0,0.1)]"),pe=m.styled.span("bw-mx-auto bw-my-0 bw-block bw-h-14 bw-w-14"),fe=m.styled.p("bw-mb-0 bw-mt-3 bw-text-base bw-text-nowrap bw-font-semibold");function ge(e){const t=a.useBookingState((e=>e.booked.state)),{input:o}=a.useBookingLogic();if(!o.bookingDetailsValue)throw new Error("Bookster could not retrieve bookingDetailsValue");return c.createElement("div",{...e},c.createElement(a.MainHeader,null),o.bookingDetailsValue.tax.total.isPositive()&&c.createElement(de,null),o.bookingDetailsValue.tax.total.isZero()&&c.createElement(re,null),c.createElement(a.MainFooter,null),c.createElement(m.LoadingOverlay,{className:"bw-inset-4 bw-text-lg bw-font-medium bw-text-base-foreground/80",loading:"processing"===t},c.createElement(f.Loader2,{className:"bw-mr-4 bw-h-6 bw-w-6 bw-animate-spin"}),u.__("Booking your Appointment!","bookster")))}function ke(o){var n;const r=a.useBookingState((e=>e.select)),{appointment:s}=a.useBookingState((e=>e.booked)),l=a.useBookingState((e=>e.customize.labels)),{service:i,agent:b,bookDate:w,bookTime:p,payOption:k,contact:E}=r,{input:y,process:v,datetime:h}=a.useBookingLogic(),{bookingDetailsValue:_}=y,x=a.useBookingLayout().formLayout,{context:S}=a.useBookingConfig(),N="dialog"===S.parent.is;return c.createElement("div",{...o},c.createElement(m.ScrollArea,{className:"bw-grow"},N&&c.createElement(m.DialogCloseIcon,null),c.createElement(m.XyzTransition,{appear:!0,className:"bw-p-4",xyz:"fade down-4"},c.createElement("div",{className:"md:bw-px-4"},c.createElement("div",{className:"bw-py-6 bw-text-center md:bw-py-10"},c.createElement(f.CheckCircle,{className:"bw-mb-3 bw-h-16 bw-w-16 bw-text-success/80"}),c.createElement("h3",{className:"bw-m-0 bw-text-lg bw-font-medium"},"BOOKING COMPLETE"," ",c.createElement(g.Default,{href:`${window.booksterMeta.pages.customerDashboardUrl}#/?apptId=${null==s?void 0:s.appointment_id}`,target:"_blank"},"#",null==s?void 0:s.appointment_id))),c.createElement("div",{className:m.cx("desktop"===x&&"bw-min-w-[16.875rem] bw-grow-0 bw-basis-3/5","bw-mx-auto bw-mt-4 bw-flex bw-max-w-[36rem] bw-flex-col bw-border-0 bw-border-solid bw-border-base-border/60 bw-pt-3")},c.createElement("div",null,c.createElement("h4",{className:"bw-mb-1 bw-text-lg"},null==i?void 0:i.name),w&&p&&c.createElement("p",{className:"bw-text-sm bw-text-primary"},w.format(d)," |"," ",R(p,null==(n=h.computed.bookingDuration)?void 0:n.duration)),c.createElement(m.Separator,{className:"bw-my-4"}),t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.ConfirmationBeforeCustomer,[]),(null==E?void 0:E.values)&&c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},l.customer),E.values.first_name," ",E.values.last_name),b&&c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between"},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},l.agent),b.first_name," ",b.last_name)),k&&c.createElement("p",{className:"bw-my-4 bw-flex bw-w-full bw-items-center bw-justify-between bw-rounded bw-bg-base-bg3 bw-px-3 bw-py-1 bw-font-semibold"},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},"Payment:"),"later"===k&&"Will Pay Locally","full"===k&&"Pay in Full"),_&&c.createElement(c.Fragment,null,_.booking.items.map((t=>c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between",key:t.id},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},t.title," ( ",e.formatPrice(t.unitPrice)," x",t.quantity,")"),c.createElement("span",null,e.formatPrice(t.amount))))),_.adjustment.items.map((t=>c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between",key:t.id},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},t.title),c.createElement("span",null,e.formatPrice(t.amount))))),_.tax.items.length>0&&c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between bw-font-semibold",key:"adjustment-subtotal"},c.createElement("span",{className:"bw-text-xs bw-uppercase"},"Subtotal"),c.createElement("span",null,e.formatPrice(_.adjustment.subtotal))),_.tax.items.map((t=>c.createElement("p",{className:"bw-flex bw-w-full bw-items-center bw-justify-between",key:t.id},c.createElement("span",{className:"bw-text-xs bw-uppercase bw-text-base-foreground/60"},t.title),c.createElement("span",null,e.formatPrice(t.amount)))))),c.createElement(m.Separator,{className:"bw-my-4"}),c.createElement("p",{className:"bw-mb-0 bw-flex bw-w-full bw-items-center bw-justify-between bw-text-lg bw-font-bold"},c.createElement("span",{className:"bw-font-medium"},"Total"),_&&e.formatPrice(_.tax.total)))))),!0===(null==E?void 0:E.isNewCustomer)&&c.createElement("div",{className:"bw-mx-4 bw-my-4 bw-flex bw-justify-center"},c.createElement("div",{className:"bw-overflow-x-auto bw-text-nowrap bw-rounded-lg bw-border bw-border-success/40 bw-px-4 bw-py-2 bw-text-success"},u.__("New Account Created. Please check your email to verify account.","bookster"))),!1===(null==E?void 0:E.isNewCustomer)&&c.createElement(m.Button,{color:"primary",variant:"outline",className:"bw-mx-auto bw-my-4",onClick:function(){v.mutate.reset()}},u.__("Book Another Appointment","bookster")))}const Ee=()=>{const{isLoading:t,login:a}=k(),[o,n]=l.useState(),[r]=w.Form.useForm();return c.createElement("div",{className:"bw-relative"},c.createElement(m.LoadingOverlay,{loading:t}),c.createElement(w.Form,{name:"btr-booking-login",layout:"vertical",className:"login-form",initialValues:{remember:!0},form:r,onFinish:async function(t){try{await a(t)}catch(o){const t=await e.getErrorJson(o),a=await e.getErrorMsg(o);n("incorrect_password"===t.code?c.createElement("p",{dangerouslySetInnerHTML:{__html:a}}):a)}}},o&&c.createElement("div",{className:"bw-mb-5 bw-border-0 bw-border-l-4 bw-border-solid bw-border-error bw-bg-base-bg2 bw-py-2 bw-pl-6"},o),c.createElement(w.Form.Item,{label:u.__("Email Address","bookster"),name:"username",rules:[{type:"email",required:!0,message:u.__("Please input your email address!","bookster")}]},c.createElement(m.Input,{type:"email",placeholder:u.__("Your Email Address","bookster")})),c.createElement(w.Form.Item,{label:u.__("Password","bookster"),name:"password",rules:[{required:!0,message:u.__("Please input your password!","bookster")}]},c.createElement(m.PasswordInput,{placeholder:u.__("Password","bookster")})),c.createElement(w.Form.Item,null,c.createElement("div",{className:"bw-flex bw-justify-between"},c.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},c.createElement(w.Form.Item,{name:"remember",valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},c.createElement(m.Checkbox,{id:"remember"})),c.createElement(m.Label,{htmlFor:"remember",className:"bw-cursor-pointer"},u.__("Remember me","bookster"))),c.createElement("a",{className:"login-form-forgot",href:window.booksterMeta.wpPath.lossPasswordUrl},u.__("Forgot password","bookster"))))))};function ye(){const{customerRecord:e,wpUserInfo:o}=k(),n=a.useBookingStore(),r=a.useBookingState((e=>e.select.contact)),s=a.useBookingLogic().process,[l]=w.Form.useForm();let i={customer_id:(null==r?void 0:r.values.customer_id)||(null==e?void 0:e.customer_id),first_name:(null==r?void 0:r.values.first_name)||(null==e?void 0:e.first_name)||(null==o?void 0:o.firstName),last_name:(null==r?void 0:r.values.last_name)||(null==e?void 0:e.last_name)||(null==o?void 0:o.lastName),email:(null==r?void 0:r.values.email)||(null==e?void 0:e.email)||(null==o?void 0:o.email),phone:(null==r?void 0:r.values.phone)||(null==e?void 0:e.phone),customer_note:(null==r?void 0:r.values.customer_note)??""};return i=t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingFormContact.contactInitValues,i,null==r?void 0:r.values,e,o),c.createElement(w.Form,{form:l,layout:"vertical",initialValues:i,onFinish:function(e){n.setState((t=>{t.select.contact={values:e,isNewCustomer:!1}})),s.mutate.nextAct()},name:"btr-booking-contact"},c.createElement(w.Form.Item,{name:"customer_id",hidden:!0},c.createElement(m.Input,null)),c.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},c.createElement(w.Form.Item,{label:u.__("First Name","bookster"),name:"first_name",rules:[{required:!0}]},c.createElement(m.Input,{placeholder:u.__("Please enter first name","bookster")})),c.createElement(w.Form.Item,{label:u.__("Last Name","bookster"),name:"last_name",rules:[{required:!0}]},c.createElement(m.Input,{placeholder:u.__("Please enter last name","bookster")})),c.createElement(w.Form.Item,{label:u.__("Email","bookster"),name:"email",rules:[{required:!0},{type:"email",validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},c.createElement(m.Input,{placeholder:u.__("Please enter email","bookster"),disabled:!0})),c.createElement(w.Form.Item,{label:u.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:_,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},c.createElement(x,null)),t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingFormContact.ContactAfterPhone,[]),c.createElement(w.Form.Item,{className:"bw-col-span-full",label:u.__("Comments","bookster"),name:"customer_note"},c.createElement(m.Textarea,{rows:3,placeholder:u.__("Add comments","bookster")}))))}const ve=()=>{const[e]=w.Form.useForm(),o=a.useBookingStore(),n=a.useBookingLogic().process,r=l.useRef("");return c.createElement(w.Form,{name:"btr-booking-new-customer",layout:"vertical",initialValues:{remember:!0},form:e,onFinish:e=>{o.setState((t=>{t.select.contact={values:e,isNewCustomer:!0}})),n.mutate.nextAct()},autoComplete:"off"},c.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},c.createElement(w.Form.Item,{label:u.__("First Name","bookster"),name:"first_name",rules:[{required:!0,message:u.__("First Name is required","bookster")}]},c.createElement(m.Input,{placeholder:u.__("Your Last Name","bookster")})),c.createElement(w.Form.Item,{label:u.__("Last Name","bookster"),name:"last_name",rules:[{required:!0,message:u.__("Last Name is required","bookster")}]},c.createElement(m.Input,{placeholder:u.__("Your First Name","bookster")})),c.createElement(w.Form.Item,{label:u.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:_,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},c.createElement(x,null)),c.createElement(w.Form.Item,{label:u.__("Email","bookster"),name:"email",rules:[{required:!0,validateTrigger:["onBlur","onChange"],message:u.__("Email Address is required","bookster")},{type:"email",validateTrigger:["onBlur","onChange"],message:u.__("Please enter valid email!","bookster")},{validateTrigger:"onBlur",validator:async(e,t)=>{t&&t===r.current||(await E(t),r.current=t)}}],validateTrigger:["onBlur","onChange"],validateFirst:!0,hasFeedback:!0},c.createElement(m.Input,{placeholder:u.__("Your Email Address","bookster")})),t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingFormContact.ContactAfterPhone,[]),c.createElement(w.Form.Item,{className:"bw-col-span-full",label:u.__("Comments","bookster"),name:"customer_note"},c.createElement(m.Textarea,{maxLength:100,placeholder:u.__("Add Comments","bookster"),rows:4}))))};function he(e){const[t,o]=l.useState("newCustomer"),{isLoading:n,wpUserInfo:r}=k(),s=r.isLoggedIn?"btr-booking-contact":"newCustomer"===t?"btr-booking-new-customer":"btr-booking-login";return c.createElement("div",{...e},c.createElement(a.MainHeader,null),c.createElement(m.ScrollArea,{className:"btr-main-scrollarea"},c.createElement(m.XyzTransition,{appear:!0,className:"bw-p-4",xyz:"fade down-4"},c.createElement("div",null,r.isLoggedIn?c.createElement("div",{className:"bw-pt-2"},c.createElement(ye,null)):c.createElement(m.TabsRoot,{value:t,onValueChange:o},c.createElement(m.TabsList,{"aria-label":"tabs settings"},c.createElement(m.LineTabsTrigger,{value:"newCustomer"},u.sprintf(u.__("New %(customer)s","bookster"),p)),c.createElement(m.LineTabsTrigger,{value:"login"},u.__("Already have an account?","bookster"))),c.createElement(m.TabsContent,{value:"newCustomer",forceMount:!1},c.createElement(ve,null)),c.createElement(m.TabsContent,{value:"login",forceMount:!1},c.createElement(Ee,null)))))),c.createElement(a.MainFooter,{submitButton:c.createElement(m.LoadingButton,{key:"contact-submit",type:"submit",disabled:n,loading:n,form:s},"btr-booking-login"===s?u.__("Login","bookster"):u.__("Submit","bookster"))}))}function _e({date:e}){const t=a.useBookingStore(),o=a.useBookingState((e=>e.datetime.timestamps.earliest)),n=a.useBookingState((e=>e.datetime.timestamps.latest)),r=l.useMemo((()=>e.isAfter(o,"month")),[e,o]),s=l.useMemo((()=>null===n||e.isBefore(n,"month")),[e,n]);function i(e){t.setState((t=>{t.datetime.picker.bookMonth=e,t.datetime.picker.bookDate=null,t.datetime.picker.bookTime=null}))}return c.createElement("div",{className:"bw-flex bw-h-14 bw-items-center bw-justify-between bw-px-4"},c.createElement("h4",{className:"bw-text-lg bw-font-semibold"},e.format("MMMM")),c.createElement("div",{className:"bw-flex bw-gap-1"},c.createElement(m.Button,{variant:"trivial",disabled:!r,size:"icon",onClick:()=>{i(e.subtract(1,"month"))}},c.createElement(f.ChevronLeft,{className:"bw-h-5 bw-w-5"})),c.createElement(m.Button,{variant:"trivial",disabled:!s,size:"icon",onClick:()=>{i(e.add(1,"month"))}},c.createElement(f.ChevronRight,{className:"bw-h-5 bw-w-5"}))))}const xe=l.forwardRef(((e,t)=>{const{children:a,available:o,fullyBooked:n,today:r,restricted:s,dayOff:l,outOfMonth:i,selected:u,className:b,...d}=e;return c.createElement("div",{ref:t,className:m.cx("btr-book-date-cell-wrapper bw-relative bw-m-auto bw-flex bw-h-10 bw-w-10 bw-items-center bw-justify-center bw-rounded-md bw-bg-base-bg1 bw-p-0.5 bw-font-medium",o&&"btr-book-date-cell-wrapper__available bw-cursor-pointer",l&&"bw-bg-warning/30",u&&"btr-book-date-cell-wrapper__selected bw-bg-primary/80",b),...d},c.createElement("div",{className:m.cx("btr-book-date-cell-inner bw-rounded-full bw-text-base bw-font-semibold bw-transition-all bw-duration-100 bw-ease-out",o&&"bw-text-info",n&&"bw-text-warning",r&&"bw-text-success",s&&"bw-text-muted-foreground/60",l&&"bw-text-muted-foreground/60",i&&"bw-text-muted-foreground/60",u&&"btr-book-date-cell-inner__selected -bw-mt-1 bw-text-lg bw-text-white")},a))})),{Root:Se,Trigger:Ne}=m.ReactTooltip;function Ae({children:e,content:t}){return c.createElement(Se,null,c.createElement(Ne,{asChild:!0},e),c.createElement(m.TooltipContent,{className:"bw-z-[100001] bw-py-0.5"},t))}const Ce=m.stylex.div("bw-bg-base-foreground/10 bw-absolute bw-bottom-1 bw-left-1 bw-right-1 bw-m-0 bw-h-1 bw-overflow-hidden bw-rounded-sm"),Me=m.styled.div("bw-absolute bw-left-0 bw-bottom-0 bw-top-0 bw-z-10 bw-bg-secondary");function Be({percentage:e}){return c.createElement(Ce,null,c.createElement(Me,{style:{width:`${e}%`}}))}function Fe(){return c.createElement(Ce,{className:"bw-bg-warning"})}function Te({date:e}){const t=a.useBookingStore(),{picker:n,timestamps:r}=a.useBookingState((e=>e.datetime)),{bookMonth:s,bookDate:i}=n,{datetime:m}=a.useBookingLogic(),{agentSchedule:b,monthTimeSlots:d,monthAvailableTimeSlots:w}=m.computed;if(null===b||null===d)throw new Error(u.sprintf(u.__("The Form is not working correctly. %(agent)s and %(service)s need to be selected first!","bookster"),p));const f=l.useMemo((()=>e.format("DD")),[e]),g=l.useMemo((()=>!e.isSame(s,"month")),[e,s]),k=l.useMemo((()=>e.isSame(r.now,"day")),[e,r.now]),E=l.useMemo((()=>e.isSame(i,"day")),[e,i]),y=l.useMemo((()=>e.format(o.DAY_KEY_FORMAT)),[e]),v=d[y],h=null===w||g?null:w[y],_=null!==h&&0===h.timeSlotCountAvailable,x=(null==h?void 0:h.isRestricted)||(null==v?void 0:v.isRestricted)||!1,S=(null==h?void 0:h.isDayOff)||(null==v?void 0:v.isDayOff)||!1,N=g||x||S,A=l.useCallback((a=>{var o;a.preventDefault(),a.stopPropagation(),N||E||_||(o=e,t.setState((e=>{e.datetime.picker.bookDate=o,e.datetime.picker.bookTime=null})))}),[N,e]),C={available:!_,fullyBooked:_,today:k,restricted:x,dayOff:S,outOfMonth:g,selected:E};return g||x?c.createElement(xe,{...C},f):c.createElement(Ae,{content:Oe(S,h)},c.createElement(xe,{onClick:A,...C},f,!N&&_&&c.createElement(Fe,null),!N&&!_&&h&&c.createElement(Be,{percentage:h.timeSlotCountAvailable/h.timeSlotCountTotal*100})))}function Oe(e,t){return e?u.__("Day Off","bookster"):null===t?"Loading...":0===t.timeSlotCountAvailable?u.__("Fully Booked","bookster"):`${t.timeSlotCountAvailable} `+u.__("Available Time Slots","bookster")}function De(e){const t=a.useBookingState((e=>e.datetime.picker.bookMonth));return c.createElement("div",{id:"bookster-calendar",className:"bw-m-auto bw-mb-2 bw-max-w-lg",...e},c.createElement(w.Calendar,{className:"btr-date-picker",fullscreen:!1,mode:"month",validRange:[t.startOf("month"),t.endOf("month")],value:t,headerRender:({value:e})=>c.createElement(_e,{date:e}),fullCellRender:e=>c.createElement(Te,{date:e})}))}function Ie({timeSlot:e,mode:t="range"}){const o=a.useBookingStore(),n=a.useBookingState((e=>e.datetime.picker.bookTime)),r=null!==n&&n.absMinute===e.start.absMinute,s=l.useCallback((t=>{t.preventDefault(),t.stopPropagation(),!0===e.isAvailable&&o.setState((t=>{t.datetime.picker.bookTime=e.start}))}),[o,e]);return c.createElement(m.Button,{type:"submit",variant:r?"outline":"trivial",className:m.clsx("bw-relative bw-w-full hover:bw-bg-inherit",!r&&"bw-border-dashed"),disabled:!e.isAvailable,onClick:s},"single"===t&&e.startLabel,"range"===t&&`${e.startLabel} - ${e.endLabel}`,c.createElement(m.Chip,{show:!!r},r&&c.createElement("div",{className:"bw-flex bw-h-4 bw-w-4 bw-items-center bw-justify-center bw-rounded-full bw-bg-primary"},c.createElement(f.Check,{className:"bw-h-3 bw-w-3 bw-text-base-bg1"}))))}function Pe(e){const t=a.useBookingState((e=>e.datetime.picker.bookDate)),{datetime:n}=a.useBookingLogic(),{monthTimeSlots:r,monthAvailableTimeSlots:s}=n.computed;if(null===r)throw new Error(u.sprintf(u.__("The Form is not working correctly. %(agent)s and %(service)s need to be selected first!","bookster"),p));const i=l.useMemo((()=>null===t?null:t.format(o.DAY_KEY_FORMAT)),[t]),b=null===i?null:r[i],d=null===i||null===s?null:s[i],w=((null==b?void 0:b.periods.reduce(((e,t)=>e+t.timeSlots.length),0))??0)>10?"single":"range";return c.createElement(m.XyzTransitionGroup,{appear:!0,className:m.cx("bw-m-4 bw-grid bw-justify-items-stretch bw-gap-4","12h"===Le&&"range"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(11rem,1fr))]","24h"===Le&&"range"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(8rem,1fr))]","12h"===Le&&"single"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(6rem,1fr))]","24h"===Le&&"single"===w&&"bw-grid-cols-[repeat(auto-fill,minmax(4rem,1fr))]"),xyz:"fade up delay-0.5 out-duration-0 out-delay-0",...e},(b?b.periods:[]).map(((e,t)=>e.timeSlots.map(((e,a)=>{var o;let n;return null!==d&&(n=null==(o=d.periods[t])?void 0:o.timeSlots[a]),c.createElement("div",{key:`slot-${i}-${t}-${a}`},c.createElement(Ie,{timeSlot:void 0!==n?n:e,mode:w}))})))))}const Le=window.booksterPublicData.generalSettings.time_system;function He(e){const t=a.useBookingStore(),o=a.useBookingLogic().process,n=a.useBookingState((e=>e.datetime.picker.bookTime));return c.createElement("div",{...e},c.createElement(a.MainHeader,null),c.createElement(m.ScrollArea,{className:"btr-main-scrollarea"},c.createElement(m.XyzTransition,{appear:!0,xyz:"fade down-4"},c.createElement("div",null,c.createElement(De,null))),c.createElement(m.SectionSeparator.Title,{align:"center",className:"bw-m-0"},"Pick Appointment Time"),c.createElement(Pe,null)),c.createElement(a.MainFooter,{submitButton:c.createElement(m.Button,{key:"datetime-submit",disabled:null===n,onClick:function(){t.setState((e=>{e.select.bookDate=e.datetime.picker.bookDate,e.select.bookTime=e.datetime.picker.bookTime})),o.mutate.nextAct()}},"Confirm")}))}function Re({text:e,color:t}){return c.createElement("div",{className:"bw-absolute -bw-end-2 bw-top-2 bw-m-0 bw-list-none bw-whitespace-nowrap bw-rounded bw-rounded-ee-none bw-px-2 bw-py-0 bw-leading-6",style:{backgroundColor:t}},c.createElement("span",{className:"bw-text-base bw-text-white"},e),c.createElement("div",{className:"bw-absolute bw-end-0 bw-top-full bw-h-2 bw-w-2 bw-origin-top bw-scale-y-75 bw-border-4 bw-border-solid bw-border-white",style:{borderInlineStartColor:t,borderBlockStartColor:t}}))}function je(o){const n=e.usePublicActiveServices(),r=a.useBookingStore(),s=a.useBookingState((e=>e.select.agent)),l=a.useBookingLogic().process,i=a.useBookingConfig();let u=n.map((e=>({...e,services:e.services.filter((e=>{if(s){const t=e.available_agent_services.find((e=>e.agent_id===s.agent_id));if(t&&!1===t.available)return!1}return!0}))})));return u=t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.servicesList,u,r,i),c.createElement("div",{...o},c.createElement(a.MainHeader,null),c.createElement(m.ScrollArea,{className:"btr-main-scrollarea"},c.createElement(m.XyzTransitionGroup,{appear:!0,className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(14rem,1fr))] bw-gap-4 bw-p-4",xyz:"fade down-4 stagger-0.5"},u.map((e=>e.services.map((t=>c.createElement(S,{key:t.service_id,service:t,onClick:()=>function(e){r.setState((t=>{t.select.service=e})),l.mutate.nextAct()}(t),cateRibbon:c.createElement(Re,{text:e.name,color:t.theme_color})}))))))),c.createElement(a.MainFooter,null))}function Ke(e){switch(e.process.computed.act){case a.ACT_NAME.selectService:return{key:"select-service",node:c.createElement(je,null)};case a.ACT_NAME.selectAgent:return{key:"select-agent",node:c.createElement(oe,null)};case a.ACT_NAME.selectDateTime:return{key:"select-date-time",node:c.createElement(He,null)};case a.ACT_NAME.formContact:return{key:"form-contact",node:c.createElement(he,null)};case a.ACT_NAME.selectPayOption:return{key:"select-pay-option",node:c.createElement(ge,null)};case a.ACT_NAME.showAppointment:return{key:"show-appointment",node:c.createElement(ke,null)};default:return{key:"ui-not-found",node:c.createElement("div",null,"UI Not Found")}}}function ze({children:e}){const o=a.useBookingConfig(),n=a.useBookingState((e=>e)),r=a.useBookingLogic(),s=function(e){return{layout:{key:"default-layout",node:c.createElement(W,null)},sidebar:{key:"default-sidebar",node:c.createElement(J,null)},summary:{key:"default-summary",node:c.createElement(te,null)},summarySelect:{key:"default-summary-select",node:c.createElement(ae,null)},summaryCost:{key:"default-summary-cost",node:c.createElement(ee,null)},main:Ke(e)}}(r),l=t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.bookingParts,s,o,n,r);return c.createElement(a.BookingPartsContext.Provider,{value:l},e)}function Ve(e){const a={process:{current:{stepIndex:0,actIndex:0}},select:{service:null,agent:null,bookDate:null,bookTime:null,contact:null,payOption:null},datetime:{timestamps:P,picker:{bookMonth:qe(),bookDate:null,bookTime:null}},booked:{state:"idle",transaction:null,appointment:null,customer:null},customize:{...window.booksterManagerData?window.booksterManagerData.customizeSettings:window.booksterPublicData.customizeSettings,labels:window.booksterMeta.recordLabels}};return t.booksterHooks.applyFilters(t.HOOK_NAMES.bookingForm.bookingInitState,a,e)}let Ye;function qe(){if(Ye)return Ye;const e=P.earliest;if(e.date()<20)return Ye=e.startOf("month"),Ye;const t=y(),a=e.month();let o=e.clone();do{if(!L(o,t))return Ye=o.startOf("month"),Ye;o=o.add(1,"day")}while(o.month()===a);return Ye=o.startOf("month"),Ye}let $e=!1;function We({config:e,children:t}){const o=l.useRef();return o.current||(o.current=(e=>{const t=Ve(e);return a.createBookingStore(t)})(e)),c.createElement(a.BookingConfigContext.Provider,{value:e},c.createElement(a.BookingStoreContext.Provider,{value:o.current},c.createElement($,null,c.createElement(ze,null,t))))}$e||($e=!0,t.booksterHooks.addFilter(t.HOOK_NAMES.bookingForm.mutateNextAct,"bookster/onBookingSuccess",(function(a,o,n,{oldPhase:r,newPhase:s},l){var i;return"complete"===s&&r!==s&&"success"===o.booked.state&&(e.queryClient.invalidateQueries(["booked_appointments"]),e.queryClient.invalidateQueries(["appointments"]),!1===(null==(i=o.select.contact)?void 0:i.isNewCustomer)&&l.booked.customer&&t.booksterHooks.doAction(t.HOOK_NAMES.auth.doUpdateCustomerRecord,l.booked.customer)),a})),t.booksterHooks.addFilter(t.HOOK_NAMES.bookingForm.mutatePrevAct,"bookster/deselectOnCancel",(function(e,t,o,{oldActName:n,newActName:r,newPhase:s,oldPhase:l}){switch(r){case a.ACT_NAME.selectService:t.select.service=null;break;case a.ACT_NAME.selectAgent:t.select.agent=null;break;case a.ACT_NAME.selectDateTime:t.select.bookDate=null,t.select.bookTime=null;break;case a.ACT_NAME.selectPayOption:t.select.payOption=null}return n===a.ACT_NAME.selectDateTime&&(t.datetime.picker.bookDate=null,t.datetime.picker.bookTime=null),s!==l&&"complete"===l&&(t.booked={state:"idle",appointment:null,transaction:null,customer:null}),e}),5));export{We as B,C as a,M as b,T as c,A as d,Ve as e,O as f,B as g,P as s};
