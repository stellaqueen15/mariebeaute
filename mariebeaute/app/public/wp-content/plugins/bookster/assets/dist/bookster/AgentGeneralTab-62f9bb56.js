import{r as e,f as t,R as r,_ as a,v as n,b as l,c as i,a as s,L as o,g as c}from"./prefetch.helper-4a4e89e7.js";import{v as m,_ as u}from"./phoneInput.helper-24509875.js";import{A as d}from"./AvatarPicker-e9de6b9b.js";import{H as b}from"./HiddenInput-2f0ce489.js";import{p as _,s as p,t as w}from"./store-87403b6b.js";function v({formNamePrefix:n,service:l}){if(!l.service_id)return null;const i=e.useMemo((()=>[...n,l.service_id.toString(),"service_id"]),[n,l.service_id]),s=e.useMemo((()=>[...n,l.service_id.toString(),"available"]),[n,l.service_id]),o=t.Form.useFormInstance(),c=t.Form.useWatch(s,o);return r.createElement(r.Fragment,null,r.createElement(t.Form.Item,{name:i,hidden:!0},r.createElement(t.InputNumber,null)),r.createElement(t.Form.Item,{name:s,trigger:"onCheckedChange",valuePropName:"checked",hidden:!0},r.createElement(a.Checkbox,null)),r.createElement("div",{className:a.cx("bw-block bw-cursor-pointer bw-select-none bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap bw-rounded-sm bw-border-0 bw-border-l-4 bw-border-solid bw-p-4 bw-text-primary bw-shadow bw-transition-shadow bw-duration-200 bw-ease-in-out hover:bw-shadow-md",c?"bw-bg-primary/10":"bw-grayscale"),style:{borderLeftColor:l.theme_color},onClick:function(){const e=o.getFieldValue(s);o.setFieldValue(s,!e)}},l.name))}function g({formNamePrefix:i,category:s}){const o=t.Form.useFormInstance(),c=t.Form.useWatch(i,o),m=e.useMemo((()=>{if(!c)return{checkAll:!1,indeterminate:!1};const e=s.services.filter((e=>e.service_category_id===s.service_category_id)).map((e=>e.service_id)),t=Object.values(c).filter((t=>e.includes(t.service_id)));if(0===t.length)return{checkAll:!1,indeterminate:!1};const r=t.every((e=>e.available));return{checkAll:r,indeterminate:t.some((e=>e.available))&&!r}}),[c]);return r.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},r.createElement(a.Checkbox,{id:`category-${s.service_category_id}`,checked:m.indeterminate?"indeterminate":m.checkAll,onClick:()=>(e=>{const t={...c},r=e.services.filter((t=>t.service_category_id===e.service_category_id)).map((e=>e.service_id));Object.values(c).filter((e=>r.includes(e.service_id))).forEach((e=>{if(!e.service_id)return;const r=e.service_id.toString();t[r]={...t[r],available:!m.checkAll}})),o.setFieldsValue({available_agent_services:t})})(s)}),r.createElement(a.Label,{htmlFor:`category-${s.service_category_id}`},r.createElement(n.Secondary,null,l.__("Category","bookster")),": ",s.name))}function f({formNamePrefix:e}){const t=i.useActiveServices();return r.createElement("div",{className:"bw-divide-y bw-divide-base-border bw-rounded bw-border"},t.map((t=>r.createElement(a.ReactCollapsible.Root,{key:t.service_category_id,defaultOpen:!0},r.createElement("div",{className:"bw-flex bw-w-full bw-justify-between bw-bg-base-bg2/60 bw-p-3"},r.createElement(g,{formNamePrefix:e,category:t}),r.createElement(a.ReactCollapsible.Trigger,{asChild:!0},r.createElement(s.ChevronDown,{className:"bw-transition-transform data-[state=open]:bw-rotate-180"}))),r.createElement(a.CollapsibleContent,{forceMountWithAnimation:!0},r.createElement("div",{className:"bw-grid bw-grid-cols-6 bw-gap-x-4 bw-gap-y-4 bw-border-t bw-p-4"},t.services.map((t=>r.createElement("div",{className:"bw-col-span-3 sm:bw-col-span-2",key:t.service_id},r.createElement(v,{service:t,formNamePrefix:e}))))))))))}function h({formNamePrefix:n,allLabel:i}){const c=t.Form.useFormInstance(),m=t.Form.useWatch(n,c),u=e.useMemo((()=>{if(!m)return{checkAll:!1,indeterminate:!1};const e=Object.values(m);if(0===e.length)return{checkAll:!1,indeterminate:!1};const t=e.every((e=>e.available));return{checkAll:t,indeterminate:e.some((e=>e.available))&&!t}}),[m]);return r.createElement(r.Fragment,null,r.createElement("div",{className:"bw-mb-5 bw-mt-1 bw-inline-flex bw-items-center bw-gap-2"},r.createElement(a.Checkbox,{id:"check-all",checked:u.indeterminate?"indeterminate":u.checkAll,onClick:()=>{const e={...m};Object.values(m).forEach((t=>{if(!t.service_id)return!1;const r=t.service_id.toString();e[r]={...e[r],available:!u.checkAll}})),c.setFieldsValue({available_agent_services:e})}}),r.createElement(a.Label,{htmlFor:"check-all"},i),r.createElement(a.Tooltip,{content:l.sprintf(l.__("Available only apply to %(customer)s Booking Form. For Manager, there is no restriction.","bookster"),o)},r.createElement(s.HelpCircle,{className:"bw-text-info"}))),r.createElement(f,{formNamePrefix:n}))}function E(){return r.createElement(h,{formNamePrefix:["available_agent_services"],allLabel:l.sprintf(l.__("This %(agent)s is available for all %(services)s","bookster"),o)})}function k(){const{agentId:e}=i.useParams();return isNaN(Number(e))?null:Number(e)}function y(e){return i.useQuery({queryKey:["agent",e],queryFn:()=>e?_(e):null,staleTime:0})}function F(){const e=t.Form.useFormInstance(),{toast:m}=a.useToast(),u=k(),{data:d}=y(u),b=null===u,_=t.Form.useWatch("wp_user_id",e),v=t.Form.useWatch("wp_user_display_name",e),g=_&&v,f=i.useQueryClient(),h=i.useMutation({mutationFn:({id:e,email:t})=>p(e,t),onSuccess:t=>{e.setFieldsValue({wp_user_id:t.wp_user_id,wp_user_display_name:t.wp_user_display_name}),f.invalidateQueries({queryKey:["agents"]})}}),E=i.useMutation({mutationFn:({id:e})=>w(e),onSuccess:t=>{e.setFieldsValue({wp_user_id:t.wp_user_id,wp_user_display_name:t.wp_user_display_name}),f.invalidateQueries({queryKey:["agents"]})}});return r.createElement(r.Fragment,null,b?r.createElement(t.Form.Item,{label:l.__("Wordpress User :","bookster")},r.createElement(n.Secondary,null,l.__("Not Created Yet","bookster"))):r.createElement(t.Form.Item,{label:r.createElement("span",{className:"bw-flex bw-items-center bw-gap-1"},r.createElement("span",null,l.__("Wordpress User","bookster")," :"),g?r.createElement(r.Fragment,null,E.isLoading?r.createElement(s.Loader2,{className:"bw-animate-spin"}):r.createElement(c.Default,{onClick:async function(){(null==d?void 0:d.agent_id)&&await E.mutateAsync({id:d.agent_id})}},l.__("Unlink Now","bookster"))):r.createElement(r.Fragment,null,h.isLoading?r.createElement(s.Loader2,{className:"bw-animate-spin"}):r.createElement(c.Default,{onClick:async function(){if(!(null==d?void 0:d.agent_id))return;try{await e.validateFields(["email","first_name","last_name"])}catch(r){return}const t=e.getFieldValue("email");if(t===d.email)try{await h.mutateAsync({id:d.agent_id,email:t})}catch(r){m.error(await i.getErrorMsg(r))}else m.warning("Email has changed! Please save form before linking.")}},l.__("Link Now","bookster")))),tooltip:l.sprintf(l.__("Link %(agent)s with WP User to allow them to login and browse Working Calendar.","bookster"),o)},g?r.createElement(n.Default,{className:"bw-flex bw-items-center bw-gap-1.5"},r.createElement(s.Link2,null)," ",l.__("Linked to the WP User","bookster"),r.createElement(c.Default,{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${_}`,target:"_blank"},v),"."):r.createElement(n.Default,{className:"bw-flex bw-items-center bw-gap-1.5"},r.createElement(s.Unlink2,null)," ",l.__("Not Linked to any WP User.","bookster"))),r.createElement(t.Form.Item,{name:"wp_user_id",hidden:!0},r.createElement(t.InputNumber,null)),r.createElement(t.Form.Item,{name:"wp_user_display_name",hidden:!0},r.createElement(a.Input,null)))}function N(){const n=k(),{data:i}=y(n),[s,c]=e.useState(""),_=t.Form.useFormInstance(),p=t.Form.useWatch("wp_user_id",_);return e.useEffect((()=>{i&&c((null==i?void 0:i.transient_avatar_url)??"")}),[i]),r.createElement(r.Fragment,null,r.createElement(d,{avatarSrc:s,onSelectAvatar:e=>{_.setFieldValue("avatar_id",+e.id),c(e.url)}}),r.createElement(t.Form.Item,{name:"avatar_id",hidden:!0},r.createElement(b,null)),r.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},r.createElement(t.Form.Item,{label:l.__("First Name","bookster"),name:"first_name",rules:[{required:!0}]},r.createElement(a.Input,{placeholder:l.__("Please enter First Name","bookster"),autoFocus:!0})),r.createElement(t.Form.Item,{label:l.__("Last Name","bookster"),name:"last_name",rules:[{required:!0}]},r.createElement(a.Input,{placeholder:l.__("Please enter Last Name","bookster")})),r.createElement(t.Form.Item,{label:l.__("Email","bookster"),name:"email",rules:[{required:!0},{type:"email",validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"],tooltip:void 0!==p&&r.createElement(r.Fragment,null,l.__("Please change Email from","bookster"),"  ",r.createElement("a",{href:`${window.booksterMeta.wpPath.userProfileUrl}?user_id=${p}`,className:"bw-text-info",target:"_blank"},l.__("Wordpress Profile","bookster")))},r.createElement(a.Input,{placeholder:l.__("Please enter Email","bookster"),disabled:void 0!==p})),r.createElement(t.Form.Item,{label:l.__("Phone","bookster"),name:"phone",rules:[{required:!0},{validator:m,validateTrigger:"onBlur"}],validateTrigger:["onBlur","onChange"]},r.createElement(u,null)),r.createElement(F,null),r.createElement(t.Form.Item,{label:l.__("Priority","bookster"),name:"priority",rules:[{required:!0}],tooltip:l.sprintf(l.__("Display Priority (from 0 to 100) for this %(agent)s. Lower number will be showed first in list.","bookster"),o)},r.createElement(t.InputNumber,{min:0,max:100,step:5})),r.createElement(t.Form.Item,{label:l.__("Active","bookster"),name:"activated",valuePropName:"checked",rules:[{required:!0}],trigger:"onCheckedChange",tooltip:l.sprintf(l.__("Archiving %(agent)s to avoid Deleting referencing Appointment, Analytics Data in the past.","bookster"),o),help:l.sprintf(l.__("Active %(agents)s are available for booking.","bookster"),o)},r.createElement(a.Switch,{checkedChildren:"Active",unCheckedChildren:"Archived"})),r.createElement(t.Form.Item,{label:l.__("Visibility","bookster"),name:"visibility",trigger:"onValueChange",rules:[{required:!0}],help:l.sprintf(l.__("Private %(agents)s are visible to Staff only.","bookster"),o)},r.createElement(a.RadioGroup,null,r.createElement(a.RadioGroupItem,{value:"public"},l.__("Public","bookster")),r.createElement(a.RadioGroupItem,{value:"private"},l.__("Private","bookster"))))))}export{N as A,E as a,y as b,k as u};
