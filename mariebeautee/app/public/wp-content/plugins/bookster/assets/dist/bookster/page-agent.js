import{u as e,b as t,L as a,c as n,r,R as o,_ as s,e as l,i,a as p,d as m,f as u,g as c,p as d,h as _}from"./prefetch.helper-4a4e89e7.js";import{u as E,g as b,i as g,b as y,c as h,a as f,d as A,C as w,B as k}from"./BEConfigProvider-697f66d7.js";import{g as v,S as D,a as C,A as N,j as P,C as S,b as F,c as M,P as T,d as O,e as R,D as I,f as j,h as x,l as L,_ as G,i as H}from"./DeleteAppointmentButton-e4b7a1de.js";import{u as K,B as $}from"./index-ad7a2af3.js";import{l as B}from"./lodash-f550b173.js";import{p as Q,g as V,a as q,b as Y}from"./appointment.helper-80ab8c9c.js";import"./createBookTimeInput.helper-a66a36a8.js";import"./useBreakpoint-2ef0bad1.js";import"./index-f9ec547e.js";import"./useEffectWithTarget-688d6bb0.js";function W(){const n=e((e=>e.agentRecord));if(!n)throw new Error(t.sprintf(t.__("Sorry, Your %(agent)s Record is Not Existed.","bookster"),a));return n}async function U(e,t){return await n.api.patch(`as-agent/${e}/appointments/query`,{json:t}).json()}async function z(e){return await n.api.patch(`as-agent/${e}/appointments/counter`).json()}async function J(e,t,a){const r=X(a);return await n.api.patch(`as-agent/${e}/appointments/${t}`,{json:r}).json()}function X(e){return B.pick(e,["book_status","staff_note","datetime_start","datetime_end","abs_min_start","abs_min_end","buffer_before","buffer_after","busy_abs_min_start","busy_abs_min_end","busy_datetime_start","busy_datetime_end"])}function Z(){const[e,t]=r.useState("#"),[a,l]=r.useState(!1),{agent_id:i}=W(),p=K(e,{wait:500}),m=v(p),u="appointment"===(null==m?void 0:m.type)?m.search:null,{data:c,isLoading:d}=n.useQuery({queryKey:["appointment",u],queryFn:async()=>{if(!u)return null;try{return await async function(e,t){return await n.api.get(`as-agent/${e}/appointments/${t}`).json()}(i,u)}catch(e){if(e instanceof n.HTTPError&&404===e.response.status)return null;throw e}}}),_=n.useQueryClient(),b=E(),g=d;return o.createElement(D.Provider,{value:{search:e,isOpenModal:a,isLoading:g,setSearch:t,setIsOpenModal:l,clickAppointment:async e=>{b(`/appointments/${e.appointment_id}`),_.setQueryData(["appointment",e.appointment_id],e),l(!1)}}},o.createElement(s.ReactDialog.Root,{open:a,onOpenChange:l},o.createElement(s.ReactDialog.Trigger,{asChild:!0},o.createElement(C,null)),o.createElement(s.Dialog,{className:"bw-top-[20%] bw-flex bw-max-h-[60vh] bw-max-w-2xl bw-translate-y-0 bw-flex-col bw-overflow-auto bw-p-0"},o.createElement(s.CommandInDialog,{className:"bw-max-h-full [&_[cmdk-group-heading]]:bw-text-base [&_[cmdk-group-heading]]:bw-font-semibold [&_[cmdk-item]]:bw-px-5 [&_[cmdk-item]]:bw-py-1.5",loop:!0,shouldFilter:!1},o.createElement(s.CommandInput,{placeholder:"Enter Appointment ID, e.g. #1234",className:"bw-h-14 bw-rounded-lg bw-ps-9 bw-text-lg",value:e,onValueChange:t,isFetching:g}),o.createElement(s.LoadingOverlay,{loading:g}),o.createElement(s.CommandList,{className:"bw-py-2"},u&&o.createElement(N,{appt:c}),(null===m||"record"===m.type)&&o.createElement(P,null))))))}const ee=t=>({profile:{isLoading:!1},saveAgentProfile:async(a,r)=>{try{t((e=>{e.profile.isLoading=!0}));const o=await n.api.patch(`as-agent/${a}/profile`,{json:r}).json();e.getState().updateAgentRecord(o)}finally{t((e=>{e.profile.isLoading=!1}))}},saveAgentSetting:async(a,r)=>{try{t((e=>{e.profile.isLoading=!0}));const o=await n.api.patch(`as-agent/${a}/schedule`,{json:r}).json();e.getState().updateAgentRecord(o)}finally{t((e=>{e.profile.isLoading=!1}))}}});let te;function ae(e,t){return te||(te=n.createStore()(n.immer(n.devtools(((...e)=>{const t=l.dayjs(),a=t.add(1,"day"),n=t.utc(!0).startOf("day").toDate(),r=a.utc(!0).startOf("day").toDate(),o=b().calendarViewAgent,s=i(o),p=h(s),m=(u={title:t.format("MMMM D, YYYY"),activeStart:n,activeEnd:r},(e,t)=>({agentDashboard:{dayPreview:u},agentDashboardDayPreviewRefresh(t){e((e=>{e.agentDashboard.dayPreview.title=t.view.title,e.agentDashboard.dayPreview.activeStart=t.view.activeStart,e.agentDashboard.dayPreview.activeEnd=t.view.activeEnd}))},agentDashboardDayPreviewNext(e){e.next(),t().agentDashboardDayPreviewRefresh(e)},agentDashboardDayPreviewPrev(e){e.prev(),t().agentDashboardDayPreviewRefresh(e)},agentDashboardDayPreviewToday(e){e.today(),t().agentDashboardDayPreviewRefresh(e)}}));var u;const c=g({hidden:b().columnsForAgent.hidden,order:y()});return{...m(...e),...p(...e),...c(...e),...ee(...e)}}))))),n.useStore(te,e,t)}function ne(){return ae((e=>e.initAppointmentForm)),E(),W(),null}function re(){return o.createElement(n.Routes,null,o.createElement(n.Route,{path:"/dashboard/*",element:o.createElement(ne,null)}),o.createElement(n.Route,{path:"/calendar/*",element:o.createElement(ne,null)}),o.createElement(n.Route,{path:"/appointments/*",element:o.createElement(ne,null)}),o.createElement(n.Route,{path:"*",element:null}))}const{useToken:oe}=u.theme,se=l.dayjs(),le=se.add(7,"day");function ie(){const e=F(function(){if(f(S.MANAGE_AGENT_RECORDS_CAP))return"dashboard";if(f(S.MANAGE_AGENT_PROFILE_CAP))return"profile";if(f(S.MANAGE_AGENT_SETTINGS_CAP))return"settings";throw new Error("Sorry you don't have any permission to access this page.")}()),s=function(){const e=n.useNavigate(),{token:s}=oe();return r.useMemo((()=>{const n=f(S.MANAGE_AGENT_RECORDS_CAP)?[{type:"group",label:t.__("Management","bookster"),children:[{key:"dashboard",title:t.__("Dashboard","bookster"),label:t.__("Dashboard","bookster"),icon:o.createElement(p.Gauge,null),onClick:()=>{e("/dashboard")}},{key:"calendar",title:t.__("Calendar","bookster"),label:t.__("Calendar","bookster"),icon:o.createElement(p.CalendarDays,null),onClick:()=>{e("/calendar")}}]},{type:"group",label:t.__("Records","bookster"),children:[{key:"appointments",title:t.__("Appointments","bookster"),label:t.__("Appointments","bookster"),icon:o.createElement(p.NotebookPen,null),onClick:()=>{e(`/appointments?date-from=${se.format(l.DAY_KEY_FORMAT)}&date-to=${le.format(l.DAY_KEY_FORMAT)}`)}}]}]:[],r=f(S.MANAGE_AGENT_PROFILE_CAP)?[{key:"profile",title:t.__("Profile","bookster"),label:t.__("Profile","bookster"),icon:o.createElement(p.UserRound,null),onClick:()=>{e("/profile")}}]:[],i=[{key:"settings",title:t.__("Settings","bookster"),label:t.__("Settings","bookster"),icon:o.createElement(p.Settings,null),onTitleClick:()=>{e("/settings/schedule")},children:[{key:"settings-schedule",label:t.__("Schedule","bookster"),onClick:()=>{e("/settings/schedule")}},{key:"settings-daysoff",label:t.__("Days Off","bookster"),onClick:()=>{e("/settings/daysoff")}}]}],u=[...n,...f(S.MANAGE_AGENT_PROFILE_CAP)||f(S.MANAGE_AGENT_SETTINGS_CAP)?[{type:"group",label:a.agent,children:[...r,...i]}]:[],{type:"divider",style:{marginTop:s.marginSM,borderColor:s.colorBorder}},{key:"exit",title:t.__("Exit To Wordpress","bookster"),label:o.createElement("a",{href:window.booksterMeta.wpPath.adminUrl},o.createElement("span",null,t.__("To WordPress","bookster"))),icon:o.createElement(p.ArrowLeft,null)}];return m.booksterHooks.applyFilters(m.HOOK_NAMES.layout.agentMenuItems,u,s,e)}),[e,s])}();return o.createElement(u.ConfigProvider,{theme:{components:{Menu:{darkItemHoverBg:"rgb(var(--btr-p) / 0.6)"}}}},o.createElement(u.Menu,{className:"btr-scrollbar-xs btr-scrollbar-transparent bw-overflow-auto bw-overscroll-none bw-py-3",theme:"dark",selectedKeys:e,items:s}))}function pe(){const{transient_avatar_url:e}=W();return o.createElement(M,{userInfo:o.createElement(T,{avatarSrc:e}),sideMenu:o.createElement(ie,null),headerButtons:o.createElement(re,null),searchGlobal:o.createElement(Z,null)},o.createElement(n.Outlet,null),o.createElement(s.Toaster,null))}function me(){const e=ae((e=>e.resetAppointmentForm)),a=ae((e=>e.newAppointmentNestedCustomer)),l=ae((e=>e.editAppointmentNestedCustomer)),{agent_id:i}=W(),p=O(),{selectedAppt:d}=function(e,t){const{data:a}=n.useQuery({queryKey:["appointment",t],enabled:!1}),o=n.useQuery({queryKey:["appointment",t,"details"],queryFn:()=>t?async function(e,t){return await n.api.get(`as-agent/${e}/appointments/${t}/details`).json()}(e,t):null,staleTime:0});return{selectedAppt:r.useMemo((()=>{var e;if(!t)return null;if(!(null==(e=o.data)?void 0:e.appointment))return a||null;const n=o.data.appointment;return n.appointment_id===(null==a?void 0:a.appointment_id)&&n.updated_at===(null==a?void 0:a.updated_at)?a:o.data.appointment}),[t,a,o.data]),detailsQuery:o}}(i,p),{toast:_}=s.useToast(),b=E();function g(){b(".."),e()}const{form:y}=R(),h=n.useQueryClient(),f=n.useMutation({mutationKey:["appointments",p,"edit"],mutationFn:({agent_id:e,appt_id:t,values:a})=>async function(e,t,a){const r=X(a.apptInput);return await n.api.patch(`as-agent/${e}/appointments/${t}/bookings`,{json:{...a,apptInput:r}}).json()}(e,t,a),onSuccess:e=>{h.setQueryData(["appointment",p],e),h.removeQueries(["appointment",p,"details"]),h.invalidateQueries({queryKey:["appointments"]})}}),w=n.useMutation({mutationKey:["appointments",p,"delete"],mutationFn:({agent_id:e,appt_id:t})=>async function(e,t){return await n.api.delete(`as-agent/${e}/appointments/${t}`).json()}(e,t),onSuccess:()=>{h.removeQueries(["appointment",p]),h.invalidateQueries({queryKey:["appointments"]})}}),k=r.useMemo((()=>{let e;return e=d?Q(d,d.bookings[0],d.service):V(),m.booksterHooks.applyFilters(m.HOOK_NAMES.adminApptForm.initFormValues,e,d)}),[d]);r.useEffect((()=>{d&&(y.resetFields(),y.setFieldsValue(k),y.setFields([["details","booking"],["details","adjustment"],["details","tax"],"payment"].map((e=>({name:e,touched:!1})))))}),[k]);const v=!d||f.isLoading||w.isLoading;return o.createElement(o.Fragment,null,o.createElement(s.DrawerHeader,null,o.createElement(s.DrawerTitle,null,t.__("Edit Appointment","bookster"),"Â ",o.createElement(c.Default,{style:{fontSize:"inherit"}},`#${p}`)),o.createElement(s.DrawerCloseIcon,null)),o.createElement(s.DrawerBody,null,o.createElement(s.LoadingOverlay,{loading:v}),o.createElement(u.Form,{form:y,initialValues:k,disabled:v,layout:"vertical",scrollToFirstError:!0,onFinish:e=>{!async function(e){if(null==d?void 0:d.appointment_id)try{let t=q(e);t=m.booksterHooks.applyFilters(m.HOOK_NAMES.agentApptForm.prepareApptInput,t,e);let a=Y(e);a=m.booksterHooks.applyFilters(m.HOOK_NAMES.agentApptForm.prepareBookingInput,a,e),await f.mutateAsync({agent_id:i,appt_id:d.appointment_id,values:{apptInput:t,bookingInput:a}}),_.success("Appointment has been Saved Successfully!"),g()}catch(t){_.error(await n.getErrorMsg(t))}}(e)}},o.createElement(I,{selectedAppt:d,initialValues:k,isDisabled:!A.writeAppt},o.createElement(j,{editMode:A.writeAppt?"agent":"disabled",newCustomer:a,editCustomer:l})),o.createElement("button",{type:"submit",className:"bw-hidden"}))),o.createElement(s.DrawerFooter,null,o.createElement(x,{disabled:v||!A.writeAppt,onDelete:async()=>{if(null==d?void 0:d.appointment_id)try{await w.mutateAsync({agent_id:i,appt_id:d.appointment_id}),_.success("Appointment has been Deleted Successfully!"),g()}catch(e){_.error(await n.getErrorMsg(e))}}}),o.createElement(s.DrawerClose,{asChild:!0},o.createElement(s.Button,{key:"back",tabIndex:-1,variant:"trivial",className:"bw-min-w-[8rem]"},t.__("Cancel","bookster"))),o.createElement(s.Button,{key:"submit",disabled:v,className:"bw-min-w-[8rem]",onClick:()=>y.submit()},t.__("Save","bookster"))))}function ue(){const{presetValues:e}=ae((e=>e.appointments.form)),a=ae((e=>e.resetAppointmentForm)),l=ae((e=>e.newAppointmentNestedCustomer)),i=ae((e=>e.editAppointmentNestedCustomer)),{agent_id:p}=W(),{toast:c}=s.useToast(),d=E(),{form:_}=R(),b=n.useQueryClient(),g=n.useMutation({mutationKey:["appointments","new"],mutationFn:({agent_id:e,values:t})=>async function(e,t){return await n.api.post(`as-agent/${e}/appointments`,{json:t}).json()}(e,t),onSuccess:e=>{b.setQueryData(["appointment",e.appointment_id],e),b.removeQueries(["appointment",e.appointment_id,"details"]),b.invalidateQueries({queryKey:["appointments"]})}}),y=r.useMemo((()=>{let t=V();return e&&(t={...t,...e}),m.booksterHooks.applyFilters(m.HOOK_NAMES.adminApptForm.initFormValues,t,null)}),[e]);return r.useEffect((()=>{_.resetFields(),_.setFieldsValue(y),_.setFields([["details","booking"],["details","adjustment"],["details","tax"],"payment"].map((e=>({name:e,touched:!1}))))}),[]),o.createElement(o.Fragment,null,o.createElement(s.DrawerHeader,null,o.createElement(s.DrawerTitle,null,t.__("New Appointment","bookster")),o.createElement(s.DrawerCloseIcon,null)),o.createElement(s.DrawerBody,null,o.createElement(s.LoadingOverlay,{loading:g.isLoading}),o.createElement(u.Form,{form:_,initialValues:y,disabled:g.isLoading,layout:"vertical",scrollToFirstError:!0,onFinish:e=>{!async function(e){try{let t=q(e);t=m.booksterHooks.applyFilters(m.HOOK_NAMES.agentApptForm.prepareApptInput,t,e);let n=Y(e);n=m.booksterHooks.applyFilters(m.HOOK_NAMES.agentApptForm.prepareBookingInput,n,e),await g.mutateAsync({agent_id:p,values:{apptInput:t,bookingInput:n}}),c.success("Appointment has been Saved Successfully!"),d(".."),a()}catch(t){c.error(await n.getErrorMsg(t))}}(e)}},o.createElement(I,{selectedAppt:null,initialValues:y,isDisabled:!A.writeAppt},o.createElement(j,{editMode:A.writeAppt?"agent":"disabled",newCustomer:l,editCustomer:i})),o.createElement("button",{type:"submit",className:"bw-hidden"}))),o.createElement(s.DrawerFooter,null,o.createElement(s.DrawerClose,{asChild:!0},o.createElement(s.Button,{key:"back",tabIndex:-1,variant:"trivial",className:"bw-min-w-[8rem]"},t.__("Cancel","bookster"))),o.createElement(s.Button,{key:"submit",disabled:g.isLoading,className:"bw-min-w-[8rem]",onClick:()=>_.submit()},t.__("Save","bookster"))))}const ce=L((()=>G((()=>import("./AgentDashboardPage-aefe5698.js")),["AgentDashboardPage-aefe5698.js","prefetch.helper-4a4e89e7.js","DeleteAppointmentButton-e4b7a1de.js","createBookTimeInput.helper-a66a36a8.js","BEConfigProvider-697f66d7.js","useBreakpoint-2ef0bad1.js","index-f9ec547e.js","useEffectWithTarget-688d6bb0.js","index-ad7a2af3.js","appointment.helper-80ab8c9c.js","UIComponents-1eb3bdbf.js","AgentAppointmentFormDrawer-a75f2b4a.js","CalendarNav.styled-1832bdf1.js","queue.helper-9ff85512.js","index-db6d4b60.js","index-8ef1ff47.js","main-a21b2a58.js","useAgentAppointmentEvents-94e6a9bb.js","OverviewSkeleton-5cc1c90f.js","lodash-f550b173.js"]))),de=L((()=>G((()=>import("./AgentCalendarPage-d2e1d5e4.js")),["AgentCalendarPage-d2e1d5e4.js","prefetch.helper-4a4e89e7.js","DeleteAppointmentButton-e4b7a1de.js","createBookTimeInput.helper-a66a36a8.js","BEConfigProvider-697f66d7.js","useBreakpoint-2ef0bad1.js","index-f9ec547e.js","useEffectWithTarget-688d6bb0.js","index-ad7a2af3.js","appointment.helper-80ab8c9c.js","CalendarNav.styled-1832bdf1.js","queue.helper-9ff85512.js","index-db6d4b60.js","index-8ef1ff47.js","UIComponents-1eb3bdbf.js","AgentAppointmentFormDrawer-a75f2b4a.js","main-38921655.js","useAgentAppointmentEvents-94e6a9bb.js","ApptsFilterService-7f63b074.js","lodash-f550b173.js"]))),_e=L((()=>G((()=>import("./AgentAppointmentsPage-6eb9aed6.js")),["AgentAppointmentsPage-6eb9aed6.js","prefetch.helper-4a4e89e7.js","ApptsListContextProvider-a83efc72.js","index-ad7a2af3.js","index-f9ec547e.js","DeleteAppointmentButton-e4b7a1de.js","createBookTimeInput.helper-a66a36a8.js","BEConfigProvider-697f66d7.js","useBreakpoint-2ef0bad1.js","useEffectWithTarget-688d6bb0.js","appointment.helper-80ab8c9c.js","UIComponents-1eb3bdbf.js","AgentAppointmentFormDrawer-a75f2b4a.js","ApptsFilterService-7f63b074.js","usePagination-047a16d8.js","lodash-f550b173.js"]))),Ee=L((()=>G((()=>import("./AgentProfilePage-910d522d.js")),["AgentProfilePage-910d522d.js","prefetch.helper-4a4e89e7.js","UIComponents-1eb3bdbf.js","phoneInput.helper-24509875.js","index-f3d162c1.js","Settings.styled-5e4db2ce.js","AvatarPicker-e9de6b9b.js","BEConfigProvider-697f66d7.js","lodash-f550b173.js","DeleteAppointmentButton-e4b7a1de.js","createBookTimeInput.helper-a66a36a8.js","useBreakpoint-2ef0bad1.js","index-f9ec547e.js","useEffectWithTarget-688d6bb0.js","index-ad7a2af3.js","appointment.helper-80ab8c9c.js"]))),be=L((()=>G((()=>import("./AgentSettingsPage-8f7037aa.js")),["AgentSettingsPage-8f7037aa.js","prefetch.helper-4a4e89e7.js","UIComponents-1eb3bdbf.js","BEConfigProvider-697f66d7.js","AgentScheduleTab-f2a58cc2.js","HiddenInput-2f0ce489.js","holiday.helper-ca9c72dc.js","WeeklyScheduleEditor-df3fc586.js","lodash-f550b173.js","index-f9ec547e.js","Settings.styled-5e4db2ce.js","agentSchedule.helper-648c495b.js","DeleteAppointmentButton-e4b7a1de.js","createBookTimeInput.helper-a66a36a8.js","useBreakpoint-2ef0bad1.js","useEffectWithTarget-688d6bb0.js","index-ad7a2af3.js","appointment.helper-80ab8c9c.js"])));var ge;d(),_.createRoot(document.getElementById("bookster-app-agent")).render(o.createElement(o.StrictMode,null,o.createElement(k,null,o.createElement(n.RouterProvider,{router:n.createHashRouter([{path:"*",element:o.createElement(pe,null),errorElement:o.createElement($,null),children:(ge=[{index:!0,loader:()=>{if(f(S.MANAGE_AGENT_RECORDS_CAP))return n.redirect("/dashboard");if(f(S.MANAGE_AGENT_PROFILE_CAP))return n.redirect("/profile");if(f(S.MANAGE_AGENT_SETTINGS_CAP))return n.redirect("/settings/general");throw new Error("Sorry You don't Have Permission to Access this Page.")}},{path:"dashboard",element:o.createElement(ce,null),children:[{index:!0,element:o.createElement(w,null)},{path:"new",element:o.createElement(ue,null)},{path:":apptId",element:o.createElement(me,null)}]},{path:"calendar",element:o.createElement(de,null),children:[{index:!0,element:o.createElement(w,null)},{path:"new",element:o.createElement(ue,null)},{path:":apptId",element:o.createElement(me,null)}]},{path:"appointments",element:o.createElement(_e,null),children:[{index:!0,element:o.createElement(w,null)},{path:"new",element:o.createElement(ue,null)},{path:":apptId",element:o.createElement(me,null)}]},{path:"profile",element:o.createElement(Ee,null)},{path:"settings/:tabId/*",element:o.createElement(be,null)},{path:"*",element:o.createElement(H,null)}],m.booksterHooks.applyFilters(m.HOOK_NAMES.router.agentRouter,ge))}])}))));export{W as a,J as b,z as c,U as q,ae as u};
