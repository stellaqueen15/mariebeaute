import{R as e,d as t,_ as a,c as n,r as l,L as r,a as o,b as s,f as i}from"./prefetch.helper-4a4e89e7.js";import{P as m,a as c}from"./UIComponents-1eb3bdbf.js";import{A as p,N as u}from"./NestedCustomerDrawer-16c9e791.js";import{A as b}from"./ApptsFilterAgent-6f9c73b0.js";import{A as d,a as w,b as E}from"./ApptsFilterService-7f63b074.js";import{A as g,a as f,b as v,c as h,u as y,d as k,I as x,D as C,S as N,C as A,e as T,B as _,P,f as j,g as F,R as H}from"./ApptsListContextProvider-a83efc72.js";import{u as S,i as L,e as B,j as D,k as R}from"./store-87403b6b.js";import{u as O,f as q,h as K}from"./BEConfigProvider-697f66d7.js";import{u as M}from"./usePagination-047a16d8.js";import{k as Q}from"./DeleteAppointmentButton-e4b7a1de.js";import"./CustomerFormContent-cbddc6fa.js";import"./phoneInput.helper-24509875.js";import"./index-f3d162c1.js";import"./AvatarPicker-e9de6b9b.js";import"./HiddenInput-2f0ce489.js";import"./customer.helper-d5537c29.js";import"./index-ad7a2af3.js";import"./index-f9ec547e.js";import"./holiday.helper-ca9c72dc.js";import"./createBookTimeInput.helper-a66a36a8.js";import"./useBreakpoint-2ef0bad1.js";import"./useEffectWithTarget-688d6bb0.js";import"./appointment.helper-80ab8c9c.js";function I(){return e.createElement(e.Fragment,null,e.createElement(g,{className:"bw-w-44 bw-flex-none"}),e.createElement(f,null),e.createElement(v,null),e.createElement(h,null),e.createElement(b,null),e.createElement(d,null),e.createElement(w,null),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.BeforeApptsFilterClear,[]),e.createElement(E,null))}function z(){const s=S((e=>e.appointments.ui.order)),i=S((e=>e.appointments.ui.hidden)),m=s.filter((e=>!i.includes(e))),{toast:c}=a.useToast(),p=y(),{pagination:u,pagingPayload:b,setTotal:d,setCurrent:w}=M(),E={...b,...p},{data:g,isLoading:f,isFetching:v,isRefetching:h}=n.useQuery({queryKey:["appointments",E],queryFn:()=>L(E),keepPreviousData:!0});l.useEffect((()=>{d((null==g?void 0:g.total)||0),(null==g?void 0:g.total)&&0===(null==g?void 0:g.data.length)&&w(1)}),[g]);const{setListState:F}=k();l.useEffect((()=>{F({isLoading:f,isFetching:v,isRefetching:h})}),[v,h,f]);const H=n.useQueryClient(),R=O(),Q=n.useMutation({mutationFn:B,onSuccess:()=>H.invalidateQueries({queryKey:["appointments"]})}),I=n.useMutation({mutationFn:({id:e,status:t})=>D(e,t),onSuccess:e=>{H.invalidateQueries(["appointment",{id:e.appointment_id}]),H.invalidateQueries({queryKey:["appointments"]})}}),z=async(e,t)=>{if(!I.isLoading)try{await I.mutateAsync({id:e,status:t}),c.success("Appointment has been Saved Successfully!")}catch(a){c.error(await n.getErrorMsg(a))}};return e.createElement(e.Fragment,null,e.createElement(a.TableBorder,{className:"bw-relative"},e.createElement(a.LoadingOverlay,{loading:Q.isLoading}),e.createElement(a.Table,{className:"btr-fullpage-table bw-bg-white"},e.createElement(a.TableHeader,null,e.createElement(a.TableHeadRow,null,e.createElement(a.TableHead,null),m.map((n=>e.createElement(l.Fragment,{key:n},"book_time"===n&&e.createElement(a.TableHead,null,"Book Time"),"service"===n&&e.createElement(a.TableHead,null,r.service),"customer"===n&&e.createElement(a.TableHead,null,r.customer),"agent"===n&&e.createElement(a.TableHead,null,r.agent),"status"===n&&e.createElement(a.TableHead,null,"Status"),"payment"===n&&e.createElement(a.TableHead,null,"Payment"),"total"===n&&e.createElement(a.TableHead,null,"Total"),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.ColumnHeader,[],n)))),e.createElement(a.TableHead,{className:"bw-w-20"}))),e.createElement(a.TableBody,null,(f||0===(null==g?void 0:g.data.length))&&e.createElement(a.TableRow,null,e.createElement(a.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},e.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-base-foreground/60"},f?"Loading...":"No Data Found"))),null==g?void 0:g.data.map((r=>{var s,i,p;const u=(null==(s=I.variables)?void 0:s.id)===r.appointment_id,b=u&&I.isLoading,d=u&&I.isSuccess&&(null==(i=I.data)?void 0:i.updated_at)&&(null==(p=I.data)?void 0:p.updated_at)>r.updated_at,w=!b&&!d&&"pending"===r.book_status;return e.createElement(a.TableRow,{className:"btr-has-action-link",onClick:()=>{var e,t;const a=null==(e=null==window?void 0:window.getSelection())?void 0:e.toString();var n;(null==a?void 0:a.length)||I.isLoading&&(null==(t=I.variables)?void 0:t.id)===r.appointment_id||(n=r,H.setQueryData(["appointment",n.appointment_id],n),R(`${n.appointment_id}`))},key:r.appointment_id},e.createElement(x,{appt:r}),m.map((n=>e.createElement(l.Fragment,{key:n},"book_time"===n&&e.createElement(C,{appt:r}),"service"===n&&e.createElement(N,{appt:r}),"customer"===n&&e.createElement(A,{appt:r}),"agent"===n&&e.createElement(T,{appt:r}),"status"===n&&e.createElement(a.TableCell,null,e.createElement("div",{className:"bw-flex bw-flex-wrap bw-items-center bw-gap-px"},e.createElement(_,{bookStatus:r.book_status,className:"bw-m-0"}),(b||d)&&e.createElement(o.Loader2,{className:"-bw-my-0.5 bw-ms-1 bw-h-6 bw-w-6 bw-animate-spin bw-text-base-foreground/60"}),w&&e.createElement(e.Fragment,null,e.createElement(a.Tooltip,{content:"Approve Appointment"},e.createElement(o.Check,{className:"-bw-my-0.5 bw-ms-1 bw-h-6 bw-w-6 bw-text-success hover:bw-text-success/60",onClick:e=>{z(r.appointment_id,"approved"),e.stopPropagation()}})),e.createElement(a.Tooltip,{content:"Cancel Appointment"},e.createElement(o.X,{className:"-bw-my-0.5 bw-h-6 bw-w-6 bw-text-error hover:bw-text-error/60",onClick:e=>{z(r.appointment_id,"canceled"),e.stopPropagation()}}))))),"payment"===n&&e.createElement(P,{appt:r}),"total"===n&&e.createElement(j,{appt:r}),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.ColumnCell,[],n,r)))),e.createElement(a.TableCell,null,e.createElement("div",{className:"bw-flex bw-items-center bw-gap-1.5"},e.createElement(a.Tooltip,{content:"Edit Appointment"},e.createElement(o.SquarePen,{className:"btr-row-action-link bw-h-3.5 bw-w-3.5 bw-text-primary hover:bw-text-primary/60"})),e.createElement(a.ReactPopover.Root,null,e.createElement(a.ReactPopover.Trigger,{asChild:!0,onClick:e=>{e.stopPropagation()}},e.createElement("div",{className:"bw-flex bw-items-center"},e.createElement(a.Tooltip,{content:"Delete Appointment"},e.createElement(o.Trash,{className:"btr-row-action-link bw-h-3.5 bw-w-3.5 bw-text-error hover:bw-text-error/60"})))),e.createElement(q,{align:"end",side:"bottom",onClick:e=>e.stopPropagation()},e.createElement("div",{className:"bw-flex bw-items-center bw-gap-2"},e.createElement(o.Info,{className:"bw-h-5 bw-w-5 bw-fill-warning bw-text-base-bg1"}),"Are you sure you want to delete this appointment?"),e.createElement(K,null,e.createElement(a.ReactPopover.Close,{asChild:!0},e.createElement(a.Button,{variant:"trivial",size:"small"},"Cancel")),e.createElement(a.ReactPopover.Close,{asChild:!0},e.createElement(a.Button,{size:"small",color:"error",variant:"outline",onClick:()=>{(async e=>{try{await Q.mutateAsync(e),c.success("Appointment has been Deleted Successfully!")}catch(t){c.error(await n.getErrorMsg(t))}})(r.appointment_id)}},"Delete"))))))))}))))),e.createElement(a.Pagination,{pagination:u,onNavChange:w}))}function U({className:l,...i}){const m=S((e=>e.appointments.ui.hidden)),c=S((e=>e.appointments.ui.order)),p=S((e=>e.hideAppointmentColumn)),u=S((e=>e.showAppointmentColumn)),b=S((e=>e.moveAppointmentColumnUp)),d=S((e=>e.moveAppointmentColumnDown)),w=S((e=>e.persistAppointmentColsForManager)),[E]=n.useAutoAnimate();return e.createElement(a.Popover,null,e.createElement(a.PopoverTrigger,{asChild:!0,onClick:e=>e.stopPropagation()},e.createElement(a.Button,{variant:"trivial",className:a.cx("bw-px-2",l),...i},e.createElement(o.SlidersHorizontal,null),"Columns")),e.createElement(a.PopoverPortal,{forceMount:!0},e.createElement(a.PopoverContent,{className:"bw-min-w-[15rem] data-[state=closed]:bw-hidden",align:"end",side:"bottom"},e.createElement("div",{ref:E,className:"bw-flex bw-flex-col bw-gap-2.5"},c.map(((n,l)=>{const i=!m.includes(n),E=`bw-col-toggle_${n}`,g=function(e){let a;switch(e){case"agent":a=r.agent;break;case"service":a=r.service;break;case"customer":a=r.customer;break;case"status":a=s.__("Status","bookster");break;case"payment":a=s.__("Payment","bookster");break;case"total":a=s.__("Total","bookster");break;case"book_time":a=s.__("Book Time","bookster");break;default:a=e}return t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.columnToggleLabel,a,e)}(n);return e.createElement("div",{key:n,className:"bw-flex bw-items-center bw-gap-3"},e.createElement(a.Checkbox,{id:E,checked:i,onCheckedChange:e=>{!0===e?u(n):p(n),w()}}),e.createElement(a.Label,{htmlFor:E,className:"bw-me-auto bw-cursor-pointer"},g),e.createElement("div",{className:"bw-flex bw-items-center bw-gap-1"},e.createElement(a.Button,{className:"bw-h-4 bw-p-0",onClick:()=>{b(n),w()},variant:"ghost",disabled:0===l},e.createElement(o.ChevronUp,{className:"bw-cursor-pointer",fill:"currentColor"})),e.createElement(a.Button,{className:"bw-h-4 bw-p-0",onClick:()=>{d(n),w()},variant:"ghost",disabled:l===c.length-1},e.createElement(o.ChevronDown,{className:"bw-cursor-pointer",fill:"currentColor"}))))}))))))}function W(){const[t,l]=n.useSearchParams(),r=t.get("payment"),{data:o,isLoading:s}=n.useQuery({queryKey:["appointments","counter"],queryFn:async()=>await R(),keepPreviousData:!0}),i=1===t.size&&"incomplete"===r;return e.createElement("div",{className:a.cx("-bw-my-4 bw-flex bw-w-60 bw-cursor-pointer bw-justify-between bw-gap-2 bw-rounded bw-border bw-border-solid bw-px-4 bw-py-2.5 hover:bw-border-info/80",i&&"bw-border-info/80"),onClick:()=>{i||l({payment:"incomplete"})}},e.createElement("span",{className:a.cx("bw-font-medium bw-text-base-foreground/60",i&&"bw-text-info/80")},"Payment Incomplete"),e.createElement("span",{className:a.cx("bw-font-semibold bw-text-base-foreground/80",i&&"bw-text-info",s&&"bw-animate-pulse bw-text-lg bw-leading-none")},s?"...":null==o?void 0:o.payment_status_incomplete))}function $(){const[t,l]=n.useSearchParams(),r=t.get("status"),{data:o,isLoading:s}=n.useQuery({queryKey:["appointments","counter"],queryFn:async()=>await R(),keepPreviousData:!0}),i=1===t.size&&"pending"===r;return e.createElement("div",{className:a.cx("-bw-my-4 bw-flex bw-w-60 bw-cursor-pointer bw-justify-between bw-gap-2 bw-rounded bw-border bw-border-solid bw-px-4 bw-py-2.5 hover:bw-border-warning/80",i&&"bw-border-warning/80"),onClick:()=>{i||l({status:"pending"})}},e.createElement("span",{className:a.cx("bw-font-medium bw-text-base-foreground/60",i&&"bw-text-warning/80")},"Pending Approval"),e.createElement("span",{className:a.cx("bw-font-semibold bw-text-base-foreground/80",i&&" bw-text-warning",s&&"bw-animate-pulse")},s?"...":null==o?void 0:o.book_status_pending))}function J(){const[t]=i.Form.useForm();return e.createElement(m,null,e.createElement(F,null,e.createElement(c.Wrapper,null,e.createElement(c.Title,{className:"bw-flex-initial"},"Appointments"),e.createElement("div",{className:"bw-me-auto bw-hidden bw-gap-2 md:bw-flex"},e.createElement($,null),e.createElement(W,null)),e.createElement("div",{className:"bw-flex bw-gap-2"},e.createElement(H,null),e.createElement(U,null))),e.createElement("div",{className:"bw-mb-3 bw-flex bw-flex-row bw-flex-wrap bw-gap-2"},e.createElement(I,null)),e.createElement(z,null),e.createElement(Q.Provider,{value:{form:t}},e.createElement(p,{parentPath:"/appointments"},e.createElement(n.Outlet,null)),e.createElement(u,null))))}export{J as default};
