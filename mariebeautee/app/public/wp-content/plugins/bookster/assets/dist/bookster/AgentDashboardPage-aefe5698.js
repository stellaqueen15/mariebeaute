import{c as e,R as t,a,r as n,_ as r,b as s,L as l,f as o}from"./prefetch.helper-4a4e89e7.js";import{k as i}from"./DeleteAppointmentButton-e4b7a1de.js";import{P as m}from"./UIComponents-1eb3bdbf.js";import{A as c}from"./AgentAppointmentFormDrawer-a75f2b4a.js";import{u,S as p,g as d,a as E,b as w,C as v,m as b,c as f,d as h,R as y}from"./CalendarNav.styled-1832bdf1.js";import{m as g}from"./main-a21b2a58.js";import{u as C,a as N,b as j}from"./page-agent.js";import{u as x}from"./useAgentAppointmentEvents-94e6a9bb.js";import{d as D}from"./appointment.helper-80ab8c9c.js";import{u as T,d as P}from"./BEConfigProvider-697f66d7.js";import{S as k,P as A}from"./queue.helper-9ff85512.js";import{O as S,a as _,S as R}from"./OverviewSkeleton-5cc1c90f.js";import"./createBookTimeInput.helper-a66a36a8.js";import"./useBreakpoint-2ef0bad1.js";import"./index-f9ec547e.js";import"./useEffectWithTarget-688d6bb0.js";import"./index-ad7a2af3.js";import"./index-db6d4b60.js";import"./index-8ef1ff47.js";import"./lodash-f550b173.js";function F({isFetching:n,isSaving:r,...s}){const{getCalendarApi:l}=u(),{title:o}=C((e=>e.agentDashboard.dayPreview)),i=C((e=>e.agentDashboardDayPreviewToday)),m=C((e=>e.agentDashboardDayPreviewPrev)),c=C((e=>e.agentDashboardDayPreviewNext)),p=e.useQueryClient();return t.createElement(Q,{...s},t.createElement(q,{onClick:()=>i(l())},"Today"),t.createElement("div",{className:"bw-mr-1 bw-inline-flex -bw-space-x-px"},t.createElement(B,{onClick:()=>m(l())},t.createElement(a.ChevronLeft,{className:"bw-h-5 bw-w-5"})),t.createElement(B,{onClick:()=>c(l())},t.createElement(a.ChevronRight,{className:"bw-h-5 bw-w-5"}))),t.createElement(L,null,o,t.createElement(k,{isSaving:r})),t.createElement(M,{onClick:()=>p.invalidateQueries({queryKey:["appointments","events"]})},t.createElement(a.RefreshCw,{className:n?"bw-animate-spin":""})))}const{Wrapper:Q,NavButton:B,Title:L,TodayButton:q,ReloadButton:M}=p,H=new A;function I(){const[a,s]=n.useState(null),{activeStart:l,activeEnd:o}=C((e=>e.agentDashboard.dayPreview)),i=C((e=>e.agentDashboardDayPreviewRefresh)),m=N(),{businessHours:c,slotMinAbs:p,slotMaxAbs:h}=d(m.weekly_schedule??void 0),y=n.useMemo((()=>[{id:m.agent_id.toString(),title:m.first_name+" "+m.last_name,businessHours:c,model:m}]),[m]),{toast:k}=r.useToast(),{invalidateLazy:A,invalidateNow:S,updateModel:_}=E(),R=w(l,o),{data:Q,isFetching:B,isRefetching:L}=x(m.agent_id,R),{getCalendarApi:q,calendarRef:M}=u();n.useEffect((()=>{if(void 0!==Q&&M.current){const e=q();e.batchRendering((()=>{e.removeAllEvents(),Q.forEach((t=>e.addEvent(t)))}))}}),[Q,M.current]),n.useEffect((()=>{i(q())}),[]);const I=e.useQueryClient(),K=T();return t.createElement(t.Fragment,null,t.createElement(F,{className:"bw-mb-4",isSaving:a,isFetching:B||L}),t.createElement(v,{key:"agent-day-preview-calendar",plugins:[g,b],initialView:"resourceTimelineDay",slotMinTime:60*p*1e3,slotMaxTime:60*h*1e3,businessHours:c,resources:y,resourceAreaWidth:0,eventContent:f,eventClick:async function(e){var t;e.jsEvent.preventDefault(),t=e.event.extendedProps.model,I.setQueryData(["appointment",t.appointment_id],t),K(`${t.appointment_id}`)},eventDrop:async function(t){if(!P.writeAppt)return;const a=t.event;if(!a.start||!a.end)return;const n=D(a.extendedProps.model,a.start,a.end);H.add((async()=>{s(!0);try{const e=await j(m.agent_id,parseInt(t.event.id),n);t.event.setExtendedProp("model",e),_(e),A()}catch(a){throw s(null),k.error(await e.getErrorMsg(a)),S(),t.revert(),a}}),(()=>{s(!1)}))},editable:P.writeAppt}))}function K(e){return t.createElement("div",{...e},t.createElement(h,null,t.createElement(I,null)))}function O(n){const{agent_id:o}=N(),i=e.useQueryClient(),{data:m,isFetching:c}=e.useQuery({queryKey:["appointments","analytics","overview",{}],queryFn:async()=>{const t=i.getQueryState(["appointments","analytics","overview",{}]);return await async function(t,a,n=!1){return await e.api.patch(`analytics/overview/query/as-agent/${t}`,{json:{apptFilter:a,forceRecalculate:n}}).json()}(o,{},"loading"!==(null==t?void 0:t.status))}});return t.createElement(t.Fragment,null,!m&&t.createElement(S,{...n}),m&&t.createElement(W,null,t.createElement($,null,t.createElement(G,null,t.createElement("span",null,"Performance - Last 30 days"),t.createElement("div",{className:"bw-block"},t.createElement(y,{onClick:()=>{i.invalidateQueries({queryKey:["appointments","analytics","overview",{}]})}},t.createElement(a.RefreshCw,{className:c?"bw-animate-spin":""})))),t.createElement(z,null,t.createElement(_,{data:m.data}))),t.createElement(r.Tooltip,{content:"Total Revenue in the Last 30 Days"},t.createElement(U,null,t.createElement(V,null,t.createElement("span",{className:"bw-mr-1"},"Revenue"),t.createElement(a.CreditCard,{className:"bw-h-3 bw-w-3"})),t.createElement(Y,null,e.formatPrice(m.total.revenue)))),t.createElement(r.Tooltip,{content:"Total Appointments in the Last 30 Days"},t.createElement(U,null,t.createElement(V,null,t.createElement("span",{className:"bw-mr-1"},"Appointments"),t.createElement(a.NotebookPen,{className:"bw-h-3 bw-w-3"})),t.createElement(Y,null,m.total.apptCount))),t.createElement(r.Tooltip,{content:"Total Cancelation Case in the Last 30 Days"},t.createElement(U,null,t.createElement(V,null,t.createElement("span",{className:"bw-mr-1"},"Canceled Case"),t.createElement(a.AlertCircle,{className:"bw-h-3 bw-w-3"})),t.createElement(Y,null,m.total.cancelCase))),t.createElement(r.Tooltip,{content:s.sprintf(s.__("Total New %(customers)s in the Last 30 Days","bookster"),l)},t.createElement(U,null,t.createElement(V,null,t.createElement("span",{className:"bw-mr-1"},s.sprintf(s.__("New %(customer)s","bookster"),l)),t.createElement(a.Contact,{className:"bw-h-3 bw-w-3"})),t.createElement(Y,null,m.total.newCustomer)))))}const{Grid:W,Chart:$,ChartBody:z,ChartTitle:G,Stats:U,StatsTitle:V,StatsNumber:Y}=R;function J(){const[a]=o.Form.useForm();return t.createElement(m,null,t.createElement("div",{className:"bw-mx-auto bw-mt-0 bw-max-w-7xl xl:bw-mt-2 2xl:bw-mt-4"},t.createElement(O,{className:"bw-mx-auto bw-max-w-7xl"}),t.createElement(r.SectionSeparator.Title,null,"Day Schedule"),t.createElement(K,{className:"btr-agent-day-preview"})),t.createElement(i.Provider,{value:{form:a}},t.createElement(c,{parentPath:"/dashboard"},t.createElement(e.Outlet,null))))}export{J as default};
