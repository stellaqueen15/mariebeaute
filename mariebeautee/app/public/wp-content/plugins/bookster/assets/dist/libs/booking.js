function J(e){return{hour:Math.floor(e/60),minute:e%60,absMinute:e}}function Q(e,t){return{hour:e,minute:t,absMinute:e*60+t}}function Y(e){return{hour:e.hour(),minute:e.minute(),absMinute:e.hour()*60+e.minute()}}function p(e,t,o,r){return e<r&&o<t}function ee(e,t){return p(e.busy_abs_min_start,e.busy_abs_min_end,t.busy_abs_min_start,t.busy_abs_min_end)}function te(e,t,o){return p(e.busy_abs_min_start,e.busy_abs_min_end,t-o.bufferBefore,t+o.duration+o.bufferAfter)}function E(e,t){return p(e.start.absMinute,e.end.absMinute,t.start.absMinute,t.end.absMinute)}function oe(e){return R(e)!==null}function R(e){for(let t=1;t<e.length;t++)for(let o=0;o<t;o++)if(E(e[t],e[o]))return[t,o];return null}const ne={booktime:{createFromAbsMinute:J,createFromHourMinute:Q,createFromDayjs:Y},overlap:{isAbsOverlap:p,isApptOverlap:ee,isApptOverlapWithTimeSlot:te},period:{isOverlap:E,someOverlap:oe,findOverlapIndex:R}},re={selectService:"selectService",selectAgent:"selectAgent",selectDateTime:"selectDateTime",formContact:"formContact",selectPayOption:"selectPayOption",showAppointment:"showAppointment"};var i=React;const v=i.createContext(null);function _(){const e=i.useContext(v);if(!e)throw new Error("BookingConfigContext.Provider is missing!");return e}var d=booksterModules.utils;const se=e=>d.createStore()(d.immer(()=>e)),A=i.createContext(void 0);function N(){const e=i.useContext(A);if(!e)throw new Error("BookingStoreContext.Provider is missing!");return e}function B(e,t){const o=N();return d.useStore(o,e,t)}function ae(e,t){const o=t.process.steps[e.process.current.stepIndex],r=o.phase,s=o.acts[e.process.current.actIndex];if(e.process.current.actIndex===0){const G=t.process.steps[e.process.current.stepIndex-1];e.process.current.stepIndex-=1,e.process.current.actIndex=G.acts.length-1}else e.process.current.actIndex-=1;const{stepIndex:u,actIndex:l}=e.process.current,a=t.process.steps[u],m=a.phase,w=a.acts[l];return{oldStep:o,oldPhase:r,oldActName:s,newStep:a,newPhase:m,newActName:w}}function ue(e,t){const o=t.process.steps[e.process.current.stepIndex],r=o.phase,s=o.acts[e.process.current.actIndex];e.process.current.actIndex>=o.acts.length-1?(e.process.current.stepIndex+=1,e.process.current.actIndex=0):e.process.current.actIndex+=1;const{stepIndex:u,actIndex:l}=e.process.current,a=t.process.steps[u],m=a.phase,w=a.acts[l];return{oldStep:o,oldPhase:r,oldActName:s,newStep:a,newPhase:m,newActName:w}}const D=i.createContext(null);function f(){const e=i.useContext(D);if(!e)throw new Error("BookingLogicContext.Provider is missing!");return e}const I=i.createContext(null);function P(){const e=i.useContext(I);if(!e)throw new Error("BookingPartsContext.Provider is missing!");return e}const O=i.createContext({formLayout:"mobile",showSidebar:!1,showSummary:!1});function g(){return i.useContext(O)}var c=booksterModules.components,x=booksterModules.icons;function S(){const{context:e}=_();return e.parent.is==="dialog"?React.createElement(c.ReactDialog.Close,{asChild:!0},React.createElement(c.Button,{variant:"ghost",color:"base",size:"icon"},React.createElement(x.X,{className:"bw-h-5 bw-w-5"}))):null}function ce({prevButton:e,submitButton:t}){const o=f().process;return e||t||!e&&o.can.prevAct?React.createElement("div",{className:"bw-relative bw-z-10 bw-mt-auto bw-flex bw-items-center bw-justify-between bw-border-0 bw-border-t bw-border-solid bw-border-base-border bw-p-3 bw-px-4"},e,!e&&o.can.prevAct&&React.createElement(c.Button,{key:"default-prev-node",className:"bw-pl-0",variant:"link",onClick:()=>o.mutate.prevAct()},React.createElement(x.ArrowLeft,null),"Back"),t):null}function M(){const e=g().formLayout,{actIndex:t,stepIndex:o}=B(m=>m.process.current),r=f().process,{summaryCost:s,summarySelect:u}=P(),a=e==="mobile"&&!(t===0&&o===0)&&r.computed.phase!=="complete";return React.createElement(c.ReactDialog.Root,null,a&&React.createElement(c.ReactDialog.Trigger,{asChild:!0},React.createElement(c.Button,{variant:"ghost",size:"icon"},React.createElement(x.ReceiptText,null))),React.createElement(c.ReactDialog.Portal,{container:c.portalContainer},React.createElement(c.DialogOverlay,{className:"bw-z-[100001]"}),React.createElement(c.DialogContent,{className:"bw-z-[100002] bw-text-base-foreground"},React.createElement(c.DialogTitle,{className:"bw-font-heading bw-text-primary"},"Summary"),React.createElement("div",{className:"bw-mt-4 bw-flex bw-flex-col bw-gap-6 bw-rounded-lg bw-border-solid bw-border-base-border bw-p-4"},React.createElement(c.Slot,{key:u.key},u.node),React.createElement(c.Slot,{key:s.key,className:"bw-mt-auto bw-p-0 bw-pt-4"},s.node)),React.createElement(c.DialogCloseIcon,null))))}function ie(){const e=g().formLayout,t=f().process;return e==="mobile"?React.createElement("div",{className:"bw-px-4 bw-text-xl bw-font-bold"},React.createElement("div",{className:"bw-flex bw-items-center bw-gap-2 bw-border-0 bw-border-b bw-border-solid bw-border-base-border bw-py-3"},React.createElement("p",{className:"bw-mb-0 bw-flex-grow bw-font-heading bw-text-lg bw-font-semibold bw-text-primary"},t.computed.title),React.createElement(M,null),React.createElement(S,null))):null}const j=i.createContext(null);function le(){const e=i.useContext(j);if(!e)throw new Error("PreviewConfigContext.Provider is missing!");return e}const Z=i.createContext(void 0);function me(){const e=i.useContext(Z);if(!e)throw new Error("ApptFormContext.Provider is missing!");return e}var n=booksterModules.decimal,b=booksterModules.hooks;function F(e){return{items:e.items.map(t=>({id:t.id,title:t.title,quantity:t.quantity,unitPrice:n.Decimal.fromNumber(t.unitPrice),amount:n.Decimal.fromNumber(t.amount)})),subtotal:n.Decimal.fromNumber(e.subtotal)}}function L(e){return{items:e.items.map(t=>({id:t.id,title:t.title,quantity:t.quantity,unitPrice:t.unitPrice.numberValue,amount:t.amount.numberValue})),subtotal:e.subtotal.numberValue}}function z(e){return e.reduce((t,o)=>t.add(o.amount),n.Decimal.fromNumber(0))}function T(e){const t=e.items.map(o=>({...o,amount:o.unitPrice.multiply(o.quantity)}));return{items:t,subtotal:z(t)}}function k(e){return{id:d.genUniqueId(),title:e.name,quantity:1,unitPrice:n.Decimal.fromString(e.price),amount:n.ZERO}}function de(e,t,o,r,s){const u={items:[k(e)],subtotal:n.ZERO},l={items:[],subtotal:n.ZERO},a={items:[],total:n.ZERO},m={booking:u,adjustment:l,tax:a};return b.booksterHooks.applyFilters(b.HOOK_NAMES.bookingForm.makeBlueprintBooking,m,e,t,o,r,s)}function be(e,t,o=10){b.booksterHooks.addFilter(b.HOOK_NAMES.bookingForm.makeBlueprintBooking,e,t,o)}function h(e,t,o){const[r,s]=e;switch(r){case"fixed":return n.Decimal.fromNumber(s);case"rate":return t.pipe([{operator:"multiply",operand:n.Decimal.fromNumber(s,2)},{operator:"divide",operand:n.Decimal.fromNumber(100)}]);case"compoundRate":return o.pipe([{operator:"multiply",operand:n.Decimal.fromNumber(s,2)},{operator:"divide",operand:n.Decimal.fromNumber(100)}]);default:throw new Error(`Invalid formula key: ${r}`)}}function q(e){return{items:e.items.map(t=>({id:t.id,title:t.title,formula:t.formula,amount:n.Decimal.fromNumber(t.amount)})),subtotal:n.Decimal.fromNumber(e.subtotal)}}function H(e){return{items:e.items.map(t=>({id:t.id,title:t.title,formula:t.formula,amount:t.amount.numberValue})),subtotal:e.subtotal.numberValue}}function V(e,t){let o=t;const r=[];return e.items.forEach(s=>{const u=h(s.formula,t,o),l=o.add(u);l.isNegative()?(r.push({...s,amount:o.multiply(-1)}),o=n.ZERO):(r.push({...s,amount:u}),o=l)}),{items:r,subtotal:o}}function U(e){return{items:e.items.map(t=>({id:t.id,title:t.title,formula:t.formula,amount:n.Decimal.fromNumber(t.amount)})),total:n.Decimal.fromNumber(e.total)}}function K(e){return{items:e.items.map(t=>({id:t.id,title:t.title,formula:t.formula,amount:t.amount.numberValue})),total:e.total.numberValue}}function W(e,t){let o=t;const r=[];return e.items.forEach(s=>{const u=h(s.formula,t,o),l=o.add(u);l.isNegative()?(r.push({...s,amount:o.multiply(-1)}),o=n.ZERO):(r.push({...s,amount:u}),o=l)}),{items:r,total:o}}function pe(e){return{booking:F(e.booking),adjustment:q(e.adjustment),tax:U(e.tax)}}function fe(e){const t=y(e),o=X(t);return{booking:L(o.booking),adjustment:H(o.adjustment),tax:K(o.tax)}}function X(e){return{...e,adjustment:{items:e.adjustment.items.filter(t=>t.amount.isZero()===!1),subtotal:e.adjustment.subtotal},tax:{items:e.tax.items.filter(t=>t.amount.isZero()===!1),total:e.tax.total}}}function y(e){const t=T(e.booking),o=V(e.adjustment,t.subtotal),r=W(e.tax,o.subtotal);return{booking:t,adjustment:o,tax:r}}function we(e,t){const o=n.Decimal.fromString(t),r={items:[k(e)],subtotal:n.ZERO},s={items:[],subtotal:n.ZERO},u={items:[],total:n.ZERO},a=y({booking:r,adjustment:s,tax:u});if(o.equals(a.tax.total))return a;{const m=o.subtract(a.tax.total);return a.adjustment.items.push({id:d.genUniqueId(),title:"Adjustment",formula:["fixed",m.numberValue],amount:m}),a}}function ge(e,t){return e.status==="voided"||e.status==="refunded"?{status:e.status,paid:n.ZERO}:e.status==="complete"?{status:"complete",paid:t}:e.status==="incomplete"&&e.paid.equals(t)?{status:"complete",paid:e.paid}:e}function $(e,t){return e.status==="voided"||e.status==="refunded"?{status:e.status,paid:n.ZERO}:e.status==="complete"?{status:"complete",paid:t}:e}function xe(e,t){return t.isZero()?{status:"complete",paid:n.ZERO}:$(e,t)}const C=Object.freeze(Object.defineProperty({__proto__:null,ACT_NAME:re,ApptFormContext:Z,BookingConfigContext:v,BookingLayoutContext:O,BookingLogicContext:D,BookingPartsContext:I,BookingStoreContext:A,CloseDialogButton:S,Helper:ne,MainFooter:ce,MainHeader:ie,PreviewConfigContext:j,SummaryDialog:M,beginMutateNextAct:ue,beginMutatePrevAct:ae,calculateAdjustment:V,calculateBooking:T,calculateDetails:y,calculatePayment:$,calculateTax:W,cleanDetails:X,createBookingStore:se,extendBlueprintBooking:be,makeBasicItem:k,makeBlueprintBooking:de,makeBlueprintBookingVer1_0:we,parseAdjustment:q,parseBooking:F,parseDetails:pe,parseTax:U,reloadPayment:xe,runFormula:h,serializeAdjustment:H,serializeBooking:L,serializeDetails:fe,serializePayment:ge,serializeTax:K,sumBooking:z,useApptFormLogic:me,useBookingConfig:_,useBookingLayout:g,useBookingLogic:f,useBookingParts:P,useBookingState:B,useBookingStore:N,usePreviewConfig:le},Symbol.toStringTag,{value:"Module"}));window.booksterModules?window.booksterModules.booking=C:window.booksterModules={booking:C};
