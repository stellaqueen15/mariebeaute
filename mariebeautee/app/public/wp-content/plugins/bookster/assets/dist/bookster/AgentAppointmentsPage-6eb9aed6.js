import{R as e,d as t,c as a,r as n,_ as l,L as r,a as o,b as s,f as i}from"./prefetch.helper-4a4e89e7.js";import{A as m,a as c,b as p,c as u,u as b,d,I as w,D as E,S as g,C as f,B as v,P as k,f as y,g as h,R as x}from"./ApptsListContextProvider-a83efc72.js";import{k as C}from"./DeleteAppointmentButton-e4b7a1de.js";import{P as N,a as T}from"./UIComponents-1eb3bdbf.js";import{A}from"./AgentAppointmentFormDrawer-a75f2b4a.js";import{A as _,a as P,b as F}from"./ApptsFilterService-7f63b074.js";import{u as j,a as H,q as S,c as L}from"./page-agent.js";import{u as B}from"./BEConfigProvider-697f66d7.js";import{u as D}from"./usePagination-047a16d8.js";import"./index-ad7a2af3.js";import"./index-f9ec547e.js";import"./createBookTimeInput.helper-a66a36a8.js";import"./useBreakpoint-2ef0bad1.js";import"./useEffectWithTarget-688d6bb0.js";import"./appointment.helper-80ab8c9c.js";import"./lodash-f550b173.js";function O(){return e.createElement(e.Fragment,null,e.createElement(m,{className:"bw-w-44 bw-flex-none"}),e.createElement(c,null),e.createElement(p,null),e.createElement(u,null),e.createElement(_,null),e.createElement(P,null),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.BeforeApptsFilterClear,[]),e.createElement(F,null))}function q(){const s=j((e=>e.appointments.ui.order)),i=j((e=>e.appointments.ui.hidden)),m=s.filter((e=>!i.includes(e))),{agent_id:c}=H(),p=b(),{pagination:u,pagingPayload:h,setTotal:x,setCurrent:C}=D(),N={...h,...p},{data:T,isLoading:A,isFetching:_,isRefetching:P}=a.useQuery({queryKey:["appointments",N],queryFn:()=>S(c,N),keepPreviousData:!0});n.useEffect((()=>{x((null==T?void 0:T.total)||0),(null==T?void 0:T.total)&&0===(null==T?void 0:T.data.length)&&C(1)}),[T]);const{setListState:F}=d();n.useEffect((()=>{F({isLoading:A,isFetching:_,isRefetching:P})}),[_,P,A]);const L=a.useQueryClient(),O=B();return e.createElement(e.Fragment,null,e.createElement(l.TableBorder,{className:"bw-relative"},e.createElement(l.Table,{className:"btr-fullpage-table bw-bg-white"},e.createElement(l.TableHeader,null,e.createElement(l.TableHeadRow,null,e.createElement(l.TableHead,null),m.map((a=>e.createElement(n.Fragment,{key:a},"book_time"===a&&e.createElement(l.TableHead,null,"Book Time"),"service"===a&&e.createElement(l.TableHead,null,r.service),"customer"===a&&e.createElement(l.TableHead,null,r.customer),"status"===a&&e.createElement(l.TableHead,null,"Status"),"payment"===a&&e.createElement(l.TableHead,null,"Payment"),"total"===a&&e.createElement(l.TableHead,null,"Total"),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.ColumnHeader,[],a)))),e.createElement(l.TableHead,{className:"bw-w-20"}))),e.createElement(l.TableBody,null,(A||0===(null==T?void 0:T.data.length))&&e.createElement(l.TableRow,null,e.createElement(l.TableCell,{colSpan:100,className:"bw-h-60 bw-justify-center bw-text-center"},e.createElement("span",{className:"bw-text-2xl bw-font-medium bw-text-base-foreground/60"},A?"Loading...":"No Data Found"))),null==T?void 0:T.data.map((a=>e.createElement(l.TableRow,{className:"btr-has-action-link",onClick:()=>{var e;const t=null==(e=null==window?void 0:window.getSelection())?void 0:e.toString();var n;(null==t?void 0:t.length)||(n=a,L.setQueryData(["appointment",n.appointment_id],n),O(`${n.appointment_id}`))},key:a.appointment_id},e.createElement(w,{appt:a}),m.map((r=>e.createElement(n.Fragment,{key:r},"book_time"===r&&e.createElement(E,{appt:a}),"service"===r&&e.createElement(g,{appt:a}),"customer"===r&&e.createElement(f,{appt:a}),"status"===r&&e.createElement(l.TableCell,null,e.createElement(v,{bookStatus:a.book_status})),"payment"===r&&e.createElement(k,{appt:a}),"total"===r&&e.createElement(y,{appt:a}),t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.ColumnCell,[],r,a)))),e.createElement(l.TableCell,null,e.createElement(l.Tooltip,{content:"Edit Appointment"},e.createElement(o.SquarePen,{className:"btr-row-action-link bw-h-3.5 bw-w-3.5 bw-text-primary hover:bw-text-primary/80"}))))))))),e.createElement(l.Pagination,{pagination:u,onNavChange:C}))}function K({className:n,...i}){const m=j((e=>e.appointments.ui.hidden)),c=j((e=>e.appointments.ui.order)),p=j((e=>e.hideAppointmentColumn)),u=j((e=>e.showAppointmentColumn)),b=j((e=>e.moveAppointmentColumnUp)),d=j((e=>e.moveAppointmentColumnDown)),w=j((e=>e.persistAppointmentColsForAgent)),[E]=a.useAutoAnimate();return e.createElement(l.Popover,null,e.createElement(l.PopoverTrigger,{asChild:!0,onClick:e=>e.stopPropagation()},e.createElement(l.Button,{variant:"trivial",className:l.cx("bw-px-2",n),...i},e.createElement(o.SlidersHorizontal,null),"Columns")),e.createElement(l.PopoverPortal,{forceMount:!0},e.createElement(l.PopoverContent,{className:"bw-min-w-[15rem] data-[state=closed]:bw-hidden",align:"end",side:"bottom"},e.createElement("div",{ref:E,className:"bw-flex bw-flex-col bw-gap-2.5"},c.map(((a,n)=>{const i=!m.includes(a),E=`bw-col-toggle_${a}`,g=function(e){let a;switch(e){case"service":a=r.service;break;case"customer":a=r.customer;break;case"status":a=s.__("Status","bookster");break;case"payment":a=s.__("Payment","bookster");break;case"total":a=s.__("Total","bookster");break;case"book_time":a=s.__("Book Time","bookster");break;default:a=e}return t.booksterHooks.applyFilters(t.HOOK_NAMES.adminApptList.columnToggleLabel,a,e)}(a);return e.createElement("div",{key:a,className:"bw-flex bw-items-center bw-gap-3"},e.createElement(l.Checkbox,{id:E,checked:i,onCheckedChange:e=>{!0===e?u(a):p(a),w()}}),e.createElement(l.Label,{htmlFor:E,className:"bw-me-auto bw-cursor-pointer"},g),e.createElement("div",{className:"bw-flex bw-items-center bw-gap-1"},e.createElement(l.Button,{className:"bw-h-4 bw-p-0",onClick:()=>{b(a),w()},variant:"ghost",disabled:0===n},e.createElement(o.ChevronUp,{className:"bw-cursor-pointer",fill:"currentColor"})),e.createElement(l.Button,{className:"bw-h-4 bw-p-0",onClick:()=>{d(a),w()},variant:"ghost",disabled:n===c.length-1},e.createElement(o.ChevronDown,{className:"bw-cursor-pointer",fill:"currentColor"}))))}))))))}function R(){const{agent_id:t}=H(),[n,r]=a.useSearchParams(),o=n.get("payment"),{data:s,isLoading:i}=a.useQuery({queryKey:["appointments","counter"],queryFn:async()=>await L(t),keepPreviousData:!0}),m=1===n.size&&"incomplete"===o;return e.createElement("div",{className:l.cx("-bw-my-4 bw-flex bw-w-60 bw-cursor-pointer bw-justify-between bw-gap-2 bw-rounded bw-border bw-border-solid bw-px-4 bw-py-2.5 hover:bw-border-info/80",m&&"bw-border-info/80"),onClick:()=>{m||r({payment:"incomplete"})}},e.createElement("span",{className:l.cx("bw-font-medium bw-text-base-foreground/60",m&&"bw-text-info/80")},"Payment Incomplete"),e.createElement("span",{className:l.cx("bw-font-semibold bw-text-base-foreground/80",m&&"bw-text-info",i&&"bw-animate-pulse bw-text-lg bw-leading-none")},i?"...":null==s?void 0:s.payment_status_incomplete))}function M(){const{agent_id:t}=H(),[n,r]=a.useSearchParams(),o=n.get("status"),{data:s,isLoading:i}=a.useQuery({queryKey:["appointments","counter"],queryFn:async()=>await L(t),keepPreviousData:!0}),m=1===n.size&&"pending"===o;return e.createElement("div",{className:l.cx("-bw-my-4 bw-flex bw-w-60 bw-cursor-pointer bw-justify-between bw-gap-2 bw-rounded bw-border bw-border-solid bw-px-4 bw-py-2.5 hover:bw-border-warning/80",m&&"bw-border-warning/80"),onClick:()=>{m||r({status:"pending"})}},e.createElement("span",{className:l.cx("bw-font-medium bw-text-base-foreground/60",m&&"bw-text-warning/80")},"Pending Approval"),e.createElement("span",{className:l.cx("bw-font-semibold bw-text-base-foreground/80",m&&" bw-text-warning",i&&"bw-animate-pulse")},i?"...":null==s?void 0:s.book_status_pending))}function Q(){const[t]=i.Form.useForm();return e.createElement(N,null,e.createElement(h,null,e.createElement(T.Wrapper,null,e.createElement(T.Title,{className:"bw-flex-initial"},"My Appointments"),e.createElement("div",{className:"bw-me-auto bw-flex bw-gap-2"},e.createElement(M,null),e.createElement(R,null)),e.createElement("div",{className:"bw-flex bw-gap-2"},e.createElement(x,null),e.createElement(K,null))),e.createElement("div",{className:"bw-mb-3 bw-flex bw-flex-row bw-flex-wrap bw-gap-2"},e.createElement(O,null)),e.createElement(q,null),e.createElement(C.Provider,{value:{form:t}},e.createElement(A,{parentPath:"/appointments"},e.createElement(a.Outlet,null)))))}export{Q as default};
