import{r as e,R as t,a,_ as n,f as r,b as s,c as l,L as o,d as m,W as i}from"./prefetch.helper-4a4e89e7.js";import{P as c}from"./UIComponents-1eb3bdbf.js";import{u}from"./store-87403b6b.js";import{T as d,P as b,a as g,b as p,D as w,B as E,c as h,C as y,d as _}from"./settings.constants-ecdbecc8.js";import{S as f}from"./Settings.styled-5e4db2ce.js";import{H as k,W as S}from"./WeeklyScheduleEditor-df3fc586.js";import{l as C}from"./lodash-f550b173.js";import"./BEConfigProvider-697f66d7.js";import"./holiday.helper-ca9c72dc.js";import"./index-f3d162c1.js";import"./index-f9ec547e.js";const F=e.createContext(null);function v(){const t=e.useContext(F);if(!t)throw new Error("Missing SettingsFormsContext.Provider in the tree");return t}const N=t.createElement(t.Fragment,null,t.createElement("span",null,"You might need to Refresh the page to see the changes."),"Â "),P=t.createElement("a",{onClick:()=>window.location.reload()},"Refresh Now"),T={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"General Settings has been Saved Successfully!"),description:N,action:P},x={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"Schedule Settings has been Saved Successfully!"),description:N,action:P},I={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"Permissions Settings has been Saved Successfully!"),description:N,action:P},A={title:t.createElement(t.Fragment,null,t.createElement(a.CheckCircle,{className:"bw-text-success"}),"Payment Settings has been Saved Successfully!"),description:N,action:P};function H(){const{generalSettingsForm:e}=v(),{generalSettings:a}=u((e=>e.settings)),o=u((e=>e.settingsUpdateGeneral)),{toast:m}=n.useToast(),i={general:a};return t.createElement(r.Form,{layout:"vertical",name:"general",form:e,onFinish:async function(t){try{await o(t),e.resetFields(),m.openToast(T)}catch(a){m.error(await l.getErrorMsg(a))}},initialValues:i},t.createElement(n.SectionSeparator.Title,{className:"bw-mb-4"},s.__("Booking Options","bookster")),t.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(r.Form.Item,{name:["general","time_slot_step"],rules:[{required:!0}],label:s.__("Default Time Slot Step","bookster"),help:"Interval between time slots in booking form, time picker and calendar.",trigger:"onValueChange"},t.createElement(d,null)),t.createElement(r.Form.Item,{name:["general","default_appointment_status"],rules:[{required:!0}],label:s.__("Default Appointment Status","bookster"),trigger:"onValueChange"},t.createElement(n.Select,null,t.createElement(n.SelectTrigger,null,t.createElement(n.SelectValue,null)),t.createElement(n.SelectContent,null,t.createElement(n.SelectGroup,null,t.createElement(n.SelectItem,{value:"pending"},s.__("Pending","bookster")),t.createElement(n.SelectItem,{value:"approved"},s.__("Approved","bookster")))))),t.createElement(r.Form.Item,{name:["general","phone_country_code"],rules:[{required:!0}],label:s.__("Default Phone Country","bookster")},t.createElement(b,null)),t.createElement(r.Form.Item,{name:["general","items_per_page"],rules:[{required:!0}],label:s.__("Default Items Per Page","bookster"),help:"Apply to records pages.",trigger:"onValueChange"},t.createElement(g,null))),t.createElement(n.SectionSeparator.Title,{className:"bw-my-4"},"Datetime Formats"),t.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(r.Form.Item,{name:["general","time_system"],rules:[{required:!0}],label:s.__("Time Format","bookster"),help:"How to display time in Bookster, also apply to time picker.",trigger:"onValueChange"},t.createElement(p,null)),t.createElement(r.Form.Item,{name:["general","date_format"],rules:[{required:!0}],label:s.__("Date Format","bookster"),help:"How to display date in Bookster.",trigger:"onValueChange"},t.createElement(w,null))),t.createElement(n.SectionSeparator.Title,{className:"bw-my-4"},"Restrictions"),t.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(r.Form.Item,{name:["general","book_restriction_earliest"],rules:[{required:!0}],label:s.__("Earliest Possible Booking Time","bookster"),help:"Time Slots before this time will not be available for booking"},t.createElement(r.Cascader,{options:E,placeholder:s.__("Please select","bookster")})),t.createElement(r.Form.Item,{name:["general","book_restriction_latest"],rules:[{required:!0}],label:s.__("Latest Possible Booking Time","bookster"),help:"Time Slots after this time will not be available for booking"},t.createElement(r.Cascader,{options:h,placeholder:s.__("Please select","bookster")}))),t.createElement(f,null))}function M(){const e=u((e=>e.settings.holidaysSettings)),a=u((e=>e.settingsUpdateHoliday)),{toast:r}=n.useToast();return t.createElement(t.Fragment,null,t.createElement("h4",{className:"bw-text-lg bw-font-medium"},"Yearly Holiday Schedule"),t.createElement("p",{className:"bw-mb-6 bw-text-base bw-text-base-foreground/60"},s.sprintf(s.__("This is the holiday schedule for all %(agents)s. Each %(agent)s has their own day-off schedule, which adds more days off to the holiday schedule.","bookster"),o)),t.createElement(k,{legend:U,mode:"holiday",holidaysSettings:e,onSubmit:e=>{!async function(e){try{await a(e),r.success("Holidays Settings has been Saved Successfully!")}catch(t){r.error(await l.getErrorMsg(t))}}(e)}}))}t.Fragment,a.CheckCircle;const U=t.createElement(t.Fragment,null,t.createElement("p",{className:"bw-mb-0.5 bw-flex bw-items-center bw-gap-4"},t.createElement(a.Info,{className:"bw-h-5 bw-w-5 bw-fill-info bw-text-base-bg1"}),t.createElement("span",null,"Selected date")),t.createElement("p",{className:"bw-mb-0.5 bw-flex bw-items-center bw-gap-4"},t.createElement(a.Info,{className:"bw-h-5 bw-w-5 bw-fill-success bw-text-base-bg1"}),t.createElement("span",null,"Specific year Working Day")),t.createElement("p",{className:"bw-mb-0.5 bw-flex bw-items-center bw-gap-4"},t.createElement(a.Info,{className:"bw-h-5 bw-w-5 bw-fill-warning bw-text-base-bg1"}),t.createElement("span",null,"Specific year Holiday")),t.createElement("p",{className:"bw-mb-0.5 bw-flex bw-items-center bw-gap-4"},t.createElement(a.Info,{className:"bw-h-5 bw-w-5 bw-fill-error bw-text-base-bg1"}),t.createElement("span",null,"Every year Holiday")));function O(e){const t=L(),a=!0===C.get(e,t.later),n=t.now.reduce(((t,a)=>!0===C.get(e,a)?t+1:t),0);if(!a&&0===n)throw new Error("At least one payment gateway must be enabled!");if(n>1)throw new Error("Only one Online payment gateway can be enabled at a time!")}function L(){return m.booksterHooks.applyFilters(m.HOOK_NAMES.settings.validateGatewayEnabledPath,{later:["payment","payment-later","enabled"],now:[]})}function W(){return t.createElement(t.Fragment,null,t.createElement(n.SectionSeparator.Title,{className:"bw-mb-6 bw-mt-4"},s.__("Payment Gateways","bookster")),t.createElement("div",{className:"bw-divide-y bw-divide-base-border bw-rounded bw-border"},t.createElement("div",{className:"bw-flex bw-items-center bw-gap-3 bw-bg-base-bg2/60 bw-p-3 bw-pr-4"},t.createElement(r.Form.Item,{name:["payment","payment-later","enabled"],trigger:"onCheckedChange",valuePropName:"checked",noStyle:!0},t.createElement(n.Switch,{checkedChildren:"ON",unCheckedChildren:"OFF",id:"payment-later-enabled"})),t.createElement(n.Label,{className:"bw-font-medium",htmlFor:"payment-later-enabled"},s.__("Pay Later/Locally","bookster"))),m.booksterHooks.applyFilters(m.HOOK_NAMES.settings.PaymentGateways,[])))}function G(){const{paymentSettingsForm:e}=v(),{paymentSettings:a}=u((e=>e.settings)),o=u((e=>e.settingsUpdatePayment)),{toast:i}=n.useToast(),c=m.booksterHooks.applyFilters(m.HOOK_NAMES.settings.initPaymentSettingsForm,{payment:a});return t.createElement(r.Form,{layout:"vertical",name:"payment",form:e,onFinish:async function(t){try{O(t),await o(t),e.resetFields(),i.openToast(A)}catch(a){i.error(await l.getErrorMsg(a))}},initialValues:c},t.createElement(n.SectionSeparator.Title,{className:"bw-mb-4"},s.__("Currency Options","bookster")),t.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 sm:bw-grid-cols-2"},t.createElement(r.Form.Item,{name:["payment","currency"],label:s.__("Currency","bookster"),rules:[{required:!0,message:s.__("Please select currency!","bookster")}]},t.createElement(y,{onChange:t=>{const a=l.CURRENCY_OPTIONS.find((e=>e[0]===t));e.setFieldValue(["payment","currency_symbol"],a?a[2]:"$")}})),t.createElement(r.Form.Item,{name:["payment","currency_symbol"],hidden:!0,noStyle:!0},t.createElement("input",null)),t.createElement(_,null)),t.createElement(W,null),t.createElement(f,null))}function q({value:a,onChange:r,className:s,...o}){const[m,i]=e.useState(!1),{data:c,isLoading:u}=l.useQuery({queryKey:["wpPages"],queryFn:async()=>{let e=[],t=1,a=!0;for(;a;){const n=await D(t);n.length<100&&(a=!1),e=[...e,...n||[]],t++}return e}}),d=e.useMemo((()=>{if(!a)return"Select a Page...";if(!c)return`(ID: ${a})`;const e=c.find((e=>e.id===a));return e?`${e.title.rendered} (ID: ${e.id})`:"Select a Page..."}),[a,c]);return t.createElement(n.Popover,{open:m,onOpenChange:i},t.createElement(n.ComboboxTrigger,{className:s,...o},t.createElement("span",{className:"bw-overflow-hidden"},d),t.createElement(n.ComboboxIcon,null)),t.createElement(n.PopoverPortal,null,t.createElement(n.PopoverContent,{className:"bw-w-[22rem] bw-p-0 bw-shadow-md",side:"top"},t.createElement(n.Command,{loop:!0},t.createElement(n.CommandInput,{placeholder:"Search Wordpress Page..."}),t.createElement(n.CommandList,null,u&&t.createElement(n.CommandLoading,null,"Fetching pages..."),!u&&t.createElement(n.CommandEmpty,null,"No page found."),t.createElement(n.CommandGroup,null,(c||[]).map((e=>t.createElement(n.CommandItem,{key:e.id,value:`${e.id}`,keywords:[e.title.rendered,`${e.id}`],onSelect:()=>{return t=e.id,r&&r(t),void i(!1);var t}},t.createElement(n.ComboboxItemIcon,{isActive:a===e.id}),`${e.title.rendered} (ID: ${e.id})`)))))))))}async function D(e){return await l.wordpressApi.get("pages",{searchParams:{page:e,per_page:100}}).json()}function R(){const{permissionsSettingsForm:e}=v(),{permissionsSettings:a}=u((e=>e.settings)),m=u((e=>e.settingsUpdatePermissions)),{toast:i}=n.useToast(),c={permissions:a};return t.createElement(r.Form,{layout:"vertical",name:"permission",form:e,onFinish:async function(t){try{await m(t),e.resetFields(),i.openToast(I)}catch(a){i.error(await l.getErrorMsg(a))}},initialValues:c},t.createElement(n.SectionSeparator.Title,{className:"bw-mb-4"},s.sprintf(s.__("%(agent)s Permissions","bookster"),o)),t.createElement(j,null,t.createElement(V,null,t.createElement(r.Form.Item,{name:["permissions","agents_link_wp_users"],rules:[{required:!0}],trigger:"onValueChange",label:s.sprintf(s.__("Create and Link WP User to %(agent)s","bookster"),o),help:s.sprintf(s.__("Auto means WP User is created together with %(agent)s. Manual means WP User is created separately.","bookster"),o),tooltip:s.sprintf(s.__("%(agent)s would not be able to login to Bookster if WP User not linked.","bookster"),o)},t.createElement(n.RadioGroup,null,t.createElement(n.RadioGroupItem,{value:"auto"},s.__("Auto","bookster")),t.createElement(n.RadioGroupItem,{value:"manual"},s.__("Manual","bookster"))))),t.createElement(V,{className:"bw-flex bw-items-center bw-gap-3"},t.createElement(r.Form.Item,{name:["permissions","agents_allow_edit_appointment"],valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},t.createElement(n.Switch,{checkedChildren:"Allow",unCheckedChildren:"Forbid",id:"agents_allow_edit_appointment"})),t.createElement(n.Label,{htmlFor:"agents_allow_edit_appointment"},s.sprintf(s.__("Allow %(agent)s to Edit His/Her Appointment Time and Status","bookster"),o))),t.createElement(V,{className:"bw-flex bw-items-center bw-gap-3"},t.createElement(r.Form.Item,{name:["permissions","agents_allow_edit_settings"],valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},t.createElement(n.Switch,{checkedChildren:"Allow",unCheckedChildren:"Forbid",id:"agents_allow_edit_settings"})),t.createElement(n.Label,{htmlFor:"agents_allow_edit_settings"},s.sprintf(s.__("Allow %(agent)s to Edit His/Her Working Schedule","bookster"),o)))),t.createElement(n.SectionSeparator.Title,{className:"bw-my-6"},s.sprintf(s.__("%(customer)s Permissions","bookster"),o)),t.createElement(j,null,t.createElement(V,null,t.createElement(r.Form.Item,{name:["permissions","customers_link_wp_users"],rules:[{required:!0}],trigger:"onValueChange",label:s.sprintf(s.__("Create and Link WP User to %(customer)s","bookster"),o),help:s.sprintf(s.__("Auto means WP User is created together with %(customer)s. Manual means WP User is created separately.","bookster"),o),tooltip:s.sprintf(s.__("%(customer)s would not be able to login to Bookster if WP User not linked.","bookster"),o)},t.createElement(n.RadioGroup,null,t.createElement(n.RadioGroupItem,{value:"auto"},s.__("Auto","bookster")),t.createElement(n.RadioGroupItem,{value:"manual"},s.__("Manual","bookster"))))),t.createElement(V,{className:"bw-flex bw-items-center bw-gap-3"},t.createElement(r.Form.Item,{name:["permissions","customers_allow_cancel_appointment"],valuePropName:"checked",trigger:"onCheckedChange",noStyle:!0},t.createElement(n.Switch,{checkedChildren:"Allow",unCheckedChildren:"Forbid",id:"customers_allow_cancel_appointment"})),t.createElement(n.Label,{htmlFor:"customers_allow_cancel_appointment"},s.sprintf(s.__("Allow %(customer)s to Cancel His/Her Appointment","bookster"),o))),t.createElement(V,{className:"bw-flex bw-items-center bw-gap-3"},t.createElement("label",{htmlFor:"customer_dashboard_pages"},s.sprintf(s.__("%(customer)s Dashboard Page","bookster"),o),":"),t.createElement(r.Form.Item,{name:["permissions","customer_dashboard_page_id"],rules:[{required:!0}],className:"bw-m-0"},t.createElement(q,{className:"bw-w-[24rem]"})))),t.createElement(f,null))}L();const j=n.stylex.div(" bw-grid bw-grid-cols-1 bw-gap-y-4"),V=n.stylex.div("bw-col-span-1");function $(){const{scheduleSettingsForm:e}=v(),{scheduleSettings:a}=u((e=>e.settings)),m=u((e=>e.settingsUpdateSchedule)),{toast:c}=n.useToast(),d={schedule:a};return t.createElement(r.Form,{layout:"vertical",name:"schedule",form:e,onFinish:async function(t){try{await m(t),e.resetFields(),c.openToast(x)}catch(a){c.error(await l.getErrorMsg(a))}},initialValues:d},t.createElement("h4",{className:"bw-text-lg bw-font-medium"},"Weekly Working Schedule"),t.createElement("p",{className:"bw-mb-6 bw-text-base bw-text-base-foreground/60"},s.sprintf(s.__("This is the default schedule for all %(agents)s. Some %(agents)s can have their own custom schedule which overrides this one.","bookster"),o)),t.createElement(S,{formNamePrefix:["schedule","weekly"],defaultActivePanelKeys:[i.Monday]}),t.createElement(f,null))}function B(){const e=u((e=>e.settings.isLoading)),r=u((e=>e.settingsUpdateGeneral)),s=u((e=>e.settingsUpdateSchedule)),o=u((e=>e.settingsUpdatePermissions)),i=u((e=>e.settingsUpdatePayment)),c=v(),{toast:d}=n.useToast(),b=l.useNavigate(),{tabId:g="general"}=l.useParams(),p=async e=>{try{const t=function(e,t){switch(e){case"general":return t.generalSettingsForm;case"schedule":return t.scheduleSettingsForm;case"holiday":return null;case"permissions":return t.permissionsSettingsForm;case"payment":return t.paymentSettingsForm;default:return}}(g,c);(null==t?void 0:t.isFieldsTouched())&&(confirm("Do you want to save the form?")?await async function(e,t){const a=await e.validateFields();try{switch(t){case"general":r(a),d.openToast(T);break;case"schedule":s(a),d.openToast(x);break;case"permissions":o(a),d.openToast(I);break;case"payment":O(a),i(a),d.openToast(A);break;default:throw new Error(`Unknown tab id: ${t}`)}}catch(n){d.error(await l.getErrorMsg(n))}}(t,g):t.resetFields()),b(`/settings/${e}`)}catch(t){console.log("Error",t)}};return t.createElement(n.TabsRoot,{value:g},t.createElement(n.LoadingOverlay,{loading:e}),t.createElement("div",{className:"bw-mb-8 bw-overflow-x-auto"},t.createElement(n.TabsList,{className:"bw-mb-0 bw-min-w-max bw-justify-center bw-gap-1 bw-px-2"},t.createElement(n.CardTabsTrigger,{value:"general",onClick:()=>{p("general")}},t.createElement(a.Settings,{className:"bw-mr-2"}),"General"),t.createElement(n.CardTabsTrigger,{value:"schedule",onClick:()=>{p("schedule")}},t.createElement(a.Clock,{className:"bw-mr-2"}),"Schedule"),t.createElement(n.CardTabsTrigger,{value:"holiday",onClick:()=>{p("holiday")}},t.createElement(a.CalendarDays,{className:"bw-mr-2"}),"Holiday"),t.createElement(n.CardTabsTrigger,{value:"permissions",onClick:()=>{p("permissions")}},t.createElement(a.UsersRound,{className:"bw-mr-2"}),"Permissions"),t.createElement(n.CardTabsTrigger,{value:"payment",onClick:()=>{p("payment")}},t.createElement(a.CreditCard,{className:"bw-mr-2"}),"Payment"),m.booksterHooks.applyFilters(m.HOOK_NAMES.settings.TabsTrigger,[],p))),t.createElement(n.TabsContent,{value:"general",className:"bw-mx-auto bw-max-w-screen-lg",forceMount:!1},t.createElement(H,null)),t.createElement(n.TabsContent,{value:"schedule",className:"bw-mx-auto bw-max-w-screen-lg",forceMount:!1},t.createElement($,null)),t.createElement(n.TabsContent,{value:"holiday",className:"bw-mx-auto bw-max-w-screen-xl",forceMount:!1},t.createElement(M,null)),t.createElement(n.TabsContent,{value:"permissions",className:"bw-mx-auto bw-max-w-screen-md",forceMount:!1},t.createElement(R,null)),t.createElement(n.TabsContent,{value:"payment",className:"bw-mx-auto bw-max-w-screen-md",forceMount:!1},t.createElement(G,null)),m.booksterHooks.applyFilters(m.HOOK_NAMES.settings.TabsContent,[]))}function K({children:e}){const[a]=r.Form.useForm(),[n]=r.Form.useForm(),[s]=r.Form.useForm(),[l]=r.Form.useForm();return t.createElement(F.Provider,{value:{generalSettingsForm:a,scheduleSettingsForm:n,permissionsSettingsForm:s,paymentSettingsForm:l}},e)}function Y(){return t.createElement(c,{className:"bw-py-6"},t.createElement(K,null,t.createElement(B,null)))}export{Y as default};
