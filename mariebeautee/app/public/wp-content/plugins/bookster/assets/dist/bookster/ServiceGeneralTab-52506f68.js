import{t as e,r as t,f as r,R as a,_ as n,a as l,c as s,b as i,L as o,d as c,s as m}from"./prefetch.helper-4a4e89e7.js";import{z as u,u as b}from"./store-87403b6b.js";import{a as d,A as v}from"./BEConfigProvider-697f66d7.js";import{D as _}from"./color.helper-9b8c6bb8.js";function f(e,t,r){const a={};return t.forEach((t=>{if(!t.agent_id)return;const n=e.find((e=>e.agent_id===t.agent_id));a[t.agent_id.toString()]={agent_id:t.agent_id,service_id:r,available:!n||n.available}})),a}function p(e,t){const r=f(e.available_agent_services||[],t,e.service_id);return{...e,available_agent_services:r}}function g(e){const t=e.available_agent_services?Object.values(e.available_agent_services):[];return{...e,available_agent_services:t}}function w(t){const r=f([],t,void 0);return{name:"",activated:!0,visibility:"public",price:"100.00",duration:e(),buffer_before:0,buffer_after:0,description:"",theme_color:"#66cc8a",available_agent_services:r}}function E({formNamePrefix:e,agent:s}){if(!s.agent_id)return null;const i=t.useMemo((()=>[...e,s.agent_id.toString(),"agent_id"]),[e,s.agent_id]),o=t.useMemo((()=>[...e,s.agent_id.toString(),"available"]),[e,s.agent_id]),c=r.Form.useFormInstance(),m=r.Form.useWatch(o,c);return a.createElement(a.Fragment,null,a.createElement(r.Form.Item,{name:i,hidden:!0},a.createElement(r.InputNumber,null)),a.createElement(r.Form.Item,{name:o,trigger:"onCheckedChange",valuePropName:"checked",hidden:!0},a.createElement(n.Checkbox,null)),a.createElement("div",{className:n.cx("bw-flex bw-cursor-pointer bw-select-none bw-items-center bw-gap-1.5 bw-overflow-hidden bw-text-ellipsis bw-whitespace-nowrap bw-rounded-sm bw-border-0 bw-p-4 bw-text-primary bw-shadow bw-transition-shadow bw-duration-200 bw-ease-in-out hover:bw-shadow-md",m?"bw-bg-primary/10":"bw-grayscale"),onClick:function(){const e=c.getFieldValue(o);c.setFieldValue(o,!e)}},a.createElement(n.Avatar,{className:"bw-h-8 bw-w-8"},a.createElement(n.AvatarImage,{src:s.transient_avatar_url}),a.createElement(n.AvatarFallback,null,a.createElement(l.UserRound,null))),s.first_name," ",s.last_name))}function h({formNamePrefix:e,allLabel:c}){const m=s.useActiveAgents(),u=r.Form.useFormInstance(),b=r.Form.useWatch(e,u),d=t.useMemo((()=>{if(!b)return{checkAll:!1,indeterminate:!1};const e=Object.values(b);if(0===e.length)return{checkAll:!1,indeterminate:!1};const t=e.every((e=>e.available));return{checkAll:t,indeterminate:e.some((e=>e.available))&&!t}}),[b]);return a.createElement(a.Fragment,null,a.createElement("div",{className:"bw-mb-5 bw-mt-1 bw-inline-flex bw-items-center bw-gap-2"},a.createElement(n.Checkbox,{id:"check-all",onClick:()=>{const e={...b};Object.values(b).forEach((t=>{if(!t.agent_id)return;const r=t.agent_id.toString();e[r]={...e[r],available:!d.checkAll}})),u.setFieldsValue({available_agent_services:e})},checked:d.indeterminate?"indeterminate":d.checkAll}),a.createElement(n.Label,{htmlFor:"check-all"},c),a.createElement(n.Tooltip,{content:i.sprintf(i.__("Available only apply to %(customer)s Booking Form. For Manager, there is no restriction.","bookster"),o)},a.createElement(l.HelpCircle,{className:"bw-text-info"}))),a.createElement("div",{className:"bw-grid bw-grid-cols-6 bw-gap-x-4 bw-gap-y-4"},m.map((t=>a.createElement("div",{className:"bw-col-span-3 sm:bw-col-span-2",key:t.agent_id},a.createElement(E,{agent:t,formNamePrefix:e}))))))}function k(){return a.createElement(h,{formNamePrefix:["available_agent_services"],allLabel:i.sprintf(i.__("This %(service)s is available for all %(agents)s","bookster"),o)})}function N({coverSrc:e,onSelectCover:t}){const r=window.booksterMeta.appPath.bookster.assets+"/images/empty.png";return a.createElement("img",{className:n.cx("bw-mx-auto bw-my-4 bw-block bw-h-48 bw-w-96 bw-rounded bw-object-cover bw-shadow",F?"bw-cursor-pointer bw-duration-200 hover:bw-shadow-md":"bw-cursor-auto"),src:e||r,onClick:()=>{if(!F)return;const e=window.wp.media.frames.downloadable_file=window.wp.media({title:"Choose an image",multiple:!1});e.on("select",(function(){const r=e.state().get("selection").first().toJSON(),a=r.sizes.full||r.sizes.thumbnail;t({id:r.id,url:a.url})})),e.open()},alt:i.sprintf(i.__("%(service)s cover","bookster"),o)})}const F=d("upload_files");function y({value:e,onChange:t,...r}){const n=e?parseFloat(e):0;return a.createElement(v,{...r,value:n,onChange:e=>{t&&t(null===e?null:e.toLocaleString("en-US",{useGrouping:!1}))}})}function C(){const{serviceId:e}=s.useParams();return isNaN(Number(e))?null:Number(e)}function S(e){return s.useQuery({queryKey:["service",e],queryFn:()=>e?u(e):null,staleTime:0})}function A(){const l=b((e=>e.newServiceNestedCategory)),u=C(),{data:d}=S(u),v=s.useAllServices(),f=r.Form.useFormInstance(),[p,g]=t.useState("");return t.useEffect((()=>{d&&g((null==d?void 0:d.transient_cover_url)?d.transient_cover_url:"")}),[d]),a.createElement(a.Fragment,null,a.createElement(N,{coverSrc:p,onSelectCover:e=>{f.setFieldValue("cover_id",+e.id),g(e.url)}}),a.createElement(r.Form.Item,{name:"cover_id",hidden:!0},a.createElement("input",null)),a.createElement("div",{className:"bw-grid bw-grid-cols-2 bw-gap-x-4 sm:bw-grid-cols-4"},a.createElement("div",{className:"bw-col-span-2"},a.createElement(r.Form.Item,{name:"name",label:i.sprintf(i.__("%(service)s Name","bookster"),o),rules:[{required:!0}]},a.createElement(n.Input,{placeholder:i.sprintf(i.__("Please enter %(service)s Name","bookster"),o),autoFocus:!0})),a.createElement(r.Form.Item,{name:"description",label:i.sprintf(i.__("%(service)s Description","bookster"),o)},a.createElement(n.Textarea,{rows:2,placeholder:i.sprintf(i.__("Please enter %(service)s description","bookster"),o),maxLength:150}))),a.createElement("div",{className:"bw-col-span-2"},a.createElement(r.Form.Item,{label:i.sprintf(i.__("%(service)s Category","bookster"),o),required:!0},a.createElement("div",{className:"bw-flex bw-gap-0"},a.createElement(r.Form.Item,{label:i.sprintf(i.__("%(service)s Category","bookster"),o),name:"service_category_id",rules:[{required:!0}],trigger:"onValueChange",noStyle:!0},a.createElement(n.SelectNumber,null,a.createElement(n.SelectTrigger,{className:"bw-rounded-e-none"},a.createElement(n.SelectValue,{placeholder:a.createElement("span",{className:"bw-text-base-foreground/40"},i.sprintf(i.__("Please select %(service)s Category","bookster"),o))})),a.createElement(n.SelectContent,null,a.createElement(n.SelectGroup,null,v.map((e=>a.createElement(n.SelectItem,{key:e.service_category_id,value:e.service_category_id.toString()},e.name))))))),a.createElement(n.Button,{className:"bw-z-20 bw-rounded-s-none",onClick:()=>l()},i.__("New","bookster")))),a.createElement(r.Form.Item,{name:"theme_color",label:i.__("Theme Color","bookster"),rules:[{required:!0}],getValueFromEvent:e=>e.toHexString()},a.createElement(r.ColorPicker,{presets:_,style:{width:"100%",justifyContent:"start"}}))),a.createElement("div",null,a.createElement(r.Form.Item,{name:"price",label:i.sprintf(i.__("%(service)s Price","bookster"),o),rules:[{required:!0},{validator:function(e,t){return t&&m.Decimal.fromString(t).isNegative()?Promise.reject(i.sprintf(i.__("%(service)s Price can not be negative","bookster"),o)):Promise.resolve()}}]},a.createElement(y,{className:"bw-w-full",...s.defaultCurrencyAddonProps}))),a.createElement("div",null,a.createElement(r.Form.Item,{name:"duration",label:i.sprintf(i.__("%(service)s Duration","bookster"),o),rules:[{required:!0},{validator:function(e,t){return null==t||t>0?Promise.resolve():Promise.reject(i.sprintf(i.__("%(service)s Duration must be greater than 0","bookster"),o))}}]},a.createElement(r.InputNumber,{min:0,addonAfter:"mins",step:e()}))),a.createElement("div",null,a.createElement(r.Form.Item,{name:"buffer_before",label:i.__("Buffer Before","bookster")},a.createElement(r.InputNumber,{min:0,addonAfter:"mins",step:e()}))),a.createElement("div",null,a.createElement(r.Form.Item,{name:"buffer_after",label:i.__("Buffer After","bookster")},a.createElement(r.InputNumber,{min:0,addonAfter:"mins",step:e()}))),a.createElement("div",{className:"bw-col-span-2"},a.createElement(r.Form.Item,{label:i.__("Active","bookster"),name:"activated",valuePropName:"checked",rules:[{required:!0}],tooltip:i.sprintf(i.__("Archiving %(service)s to avoid Deleting referencing Appointment, Analytics Data in the past.","bookster"),o),help:i.sprintf(i.__("Active %(services)s are available for booking.","bookster"),o),trigger:"onCheckedChange"},a.createElement(n.Switch,{checkedChildren:"Active",unCheckedChildren:"Archived"}))),a.createElement("div",{className:"bw-col-span-2"},a.createElement(r.Form.Item,{name:"visibility",label:i.__("Visibility","bookster"),trigger:"onValueChange",rules:[{required:!0}],help:i.sprintf(i.__("Private %(services)s are visible to Staff only.","bookster"),o)},a.createElement(n.RadioGroup,null,a.createElement(n.RadioGroupItem,{value:"public"},i.__("Public","bookster")),a.createElement(n.RadioGroupItem,{value:"private"},i.__("Private","bookster"))))),c.booksterHooks.applyFilters(c.HOOK_NAMES.adminServiceForm.AfterGeneralTab,[])))}export{A as S,k as a,S as b,p as c,w as g,g as p,C as u};
