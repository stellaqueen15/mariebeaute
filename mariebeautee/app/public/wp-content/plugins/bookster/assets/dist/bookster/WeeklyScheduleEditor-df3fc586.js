import{r as e,f as t,R as a,b as r,_ as l,e as n,a as o,T as s,q as i,W as c,H as d}from"./prefetch.helper-4a4e89e7.js";import{l as m}from"./lodash-f550b173.js";import{f as u,i as b,h as f}from"./index-f9ec547e.js";const w=e.createContext(null);function y(){const t=e.useContext(w);if(!t)throw new Error("Missing HolidaysScheduleEditorContext.Provider in the tree");return t}function E(){const{year:e,mode:n}=y(),o=t.Form.useFormInstance(),s=t.Form.useWatch("isEveryYear",o);return a.createElement(a.Fragment,null,a.createElement(t.Form.Item,{name:"year",hidden:!0},a.createElement(t.InputNumber,null)),a.createElement("div",{className:"bw-grid bw-grid-cols-1 bw-gap-x-4 md:bw-grid-cols-2"},a.createElement("div",null,a.createElement(t.Form.Item,{label:r.__("From Date","bookster"),name:"dateFrom"},a.createElement(t.DatePicker,{className:"bw-w-full",disabled:!0,format:"MM-DD"}))),a.createElement("div",null,a.createElement(t.Form.Item,{label:r.__("To Date","bookster"),name:"dateTo"},a.createElement(t.DatePicker,{className:"bw-w-full",disabled:!0,format:"MM-DD"}))),a.createElement("div",null,a.createElement(t.Form.Item,{label:r.__("Year","bookster"),name:"isEveryYear",trigger:"onValueChange"},a.createElement(l.RadioGroup,null,a.createElement(l.RadioGroupItem,{value:"every_year",disabled:"dayoff"===n},r.__("Every Year","bookster")),a.createElement(l.RadioGroupItem,{value:"selected_year"},r.__("Year","bookster")," ",e)))),a.createElement("div",null,a.createElement(t.Form.Item,{name:"isHoliday",label:"dayoff"===n?r.__("Day Off Status","bookster"):r.__("Holiday Status","bookster"),trigger:"onValueChange",help:"dayoff"===n?"Select Default to use the Holiday Schedule Settings this Date Range.":"Select Default to use Every Year Settings this Date Range."},a.createElement(l.RadioGroup,null,a.createElement(l.RadioGroupItem,{value:"true"},"dayoff"===n?r.__("Day Off","bookster"):r.__("Holiday","bookster")),a.createElement(l.RadioGroupItem,{value:"false"},r.__("Working","bookster")),a.createElement(l.RadioGroupItem,{value:"default",disabled:"every_year"===s},r.__("Default","bookster")))))))}function v({date:t,selected:r}){const{holidaysSettings:o,year:s,mode:i,dayOff:c,onClickCell:d,onMouseEnterCell:m}=y(),u=e.useMemo((()=>t.format("DD")),[t]),b=e.useMemo((()=>s.toString()),[t]),f=e.useMemo((()=>t.format(n.DATE_KEY_FORMAT)),[t]),w=e.useMemo((()=>0!==r.length&&r[0]<=t.date()&&t.date()<=r[1]),[t,r]),E=e.useMemo((()=>{var e,t,a;return"dayoff"===i?!1===(null==(e=null==c?void 0:c[s])?void 0:e[f]):"holiday"===i&&!1===(null==(a=null==(t=o.specific_year)?void 0:t[b])?void 0:a[f])}),[i,s,t,c,o]),v=e.useMemo((()=>{var e,t,a;return"dayoff"===i?!0===(null==(e=null==c?void 0:c[s])?void 0:e[f]):"holiday"===i&&!0===(null==(a=null==(t=o.specific_year)?void 0:t[b])?void 0:a[f])}),[i,s,t,c,o]),g=e.useMemo((()=>{var e,t,a,r,l,n;return"dayoff"===i?!0===(null==(t=null==(e=o.specific_year)?void 0:e[b])?void 0:t[f])||!1!==(null==(r=null==(a=o.specific_year)?void 0:a[b])?void 0:r[f])&&!0===(null==(l=o.every_year)?void 0:l[f]):"holiday"===i&&!0===(null==(n=o.every_year)?void 0:n[f])}),[i,s,t,c,o]),p=e.useMemo((()=>l.cx("hover:bw-text-info-foreground hover:bw-bg-info bw-w-full bw-h-full bw-flex bw-items-center bw-justify-center bw-rounded",g&&"bw-text-error-foreground bw-bg-error",v&&"bw-text-warning-foreground bw-bg-warning",E&&"bw-text-success-foreground bw-bg-success",w&&"bw-text-info-foreground bw-bg-info")),[w,E,v,g]);return a.createElement("div",{className:p,onMouseEnter:()=>m(t),onClick:()=>d(t)},u)}function g({month:r,selected:l}){const{year:o}=y(),s=e.useMemo((()=>n.dayjs(`${o}-01-01`).month(r)),[o,r]);return a.createElement("div",{className:"bw-rounded bw-border bw-border-solid bw-border-base-border"},a.createElement(t.Calendar,{className:"btr-holiday-month-calendar",fullscreen:!1,headerRender:()=>a.createElement("p",{className:"bw-py-3 bw-text-center bw-text-base bw-font-semibold"},p[r]),mode:"month",value:s,fullCellRender:e=>a.createElement(v,{date:e,selected:l})}))}const p=n.dayjs().localeData().months();function h({legend:e,decrement:t,increment:r}){const{year:n}=y();return a.createElement("div",{className:"bw-mb-[20px] bw-mt-2 bw-flex bw-items-center bw-justify-center"},a.createElement("div",{className:"bw-flex -bw-space-x-px"},a.createElement(l.Button,{size:"icon",variant:"trivial",className:"bw-z-10 bw-rounded-none first:bw-rounded-s last:bw-rounded-e",onClick:t},a.createElement(o.ChevronLeft,{className:"bw-h-5 bw-w-5"})),a.createElement(l.Input,{readOnly:!0,withStatus:!1,className:"bw-pointer-events-none bw-w-24 bw-rounded-none bw-text-center",value:n}),a.createElement(l.Button,{size:"icon",variant:"trivial",className:"bw-z-10 bw-rounded-none first:bw-rounded-s last:bw-rounded-e",onClick:r},a.createElement(o.ChevronRight,{className:"bw-h-5 bw-w-5"}))),a.createElement("div",{className:"bw-relative bw-left-2 bw-w-0"},a.createElement(l.ReactHoverCard.Root,null,a.createElement(l.ReactHoverCard.Trigger,{asChild:!0},a.createElement(l.Button,{className:"bw-rounded-full",color:"info",variant:"ghost",size:"icon"},a.createElement(o.HelpCircle,null))),a.createElement(l.HoverCardContent,null,e,a.createElement(l.ReactHoverCard.Arrow,{fill:"white"})))))}const k=[1,31],C=[],D={isSelecting:"DateFrom",selectedDateFrom:null,selectedDateTo:null,monthSelectedMap:Array(12).fill(C)};function F({legend:r,mode:n,dayOff:o,holidaysSettings:s,onSubmit:i}){const[c]=t.Form.useForm(),[d,m]=e.useState(x),{selectedDateRange:y,selectDateFrom:v,selectDateTo:p,resetSelecting:F}=function(){const[t,a]=(r=D,l=u(e.useState(r),2),n=l[0],o=l[1],[n,e.useCallback((function(e){o((function(t){var a=b(e)?e(t):e;return a?f(f({},t),a):t}))}),[])]);var r,l,n,o;return{selectedDateRange:t,selectDateFrom:function(e){a((()=>{const t=e.month(),a=e.date(),r=Array(12).fill(C);return r[t]=[a,a],{isSelecting:"DateTo",selectedDateFrom:e,selectedDateTo:e,monthSelectedMap:r}}))},selectDateTo:function(e){a((t=>{const a=e.isAfter(t.selectedDateFrom),r=a?t.selectedDateFrom:e,l=a?e:t.selectedDateFrom,n=r.month(),o=l.month(),s=Array(12).fill(C).map(((e,t)=>t===n&&t===o?[r.date(),l.date()]:t===n?[r.date(),31]:t===o?[1,l.date()]:t>n&&t<o?k:e));return{isSelecting:"DateTo",selectedDateTo:e,monthSelectedMap:s}}))},resetSelecting:function(){a(D)}}}(),[_,M]=a.useState(!1);return a.createElement(w.Provider,{value:{holidaysSettings:s,year:d,mode:n,dayOff:o,onClickCell:function(e){if("DateTo"===y.isSelecting){const t=e.isAfter(y.selectedDateFrom);!function(e,t){var a,r,l;const i=e.format("MM-DD");let m="true";"dayoff"===n?m=!1===(null==(a=null==o?void 0:o[d])?void 0:a[i])?"false":"true":"holiday"===n&&(m=!1===(null==(l=null==(r=s.specific_year)?void 0:r[d])?void 0:l[i])?"false":"true"),c.setFieldsValue({dateFrom:e,dateTo:t,isEveryYear:"selected_year",isHoliday:m,year:d}),M(!0),F()}(t?y.selectedDateFrom:e,t?e:y.selectedDateFrom)}else"DateFrom"===y.isSelecting&&v(e)},onMouseEnterCell:function(e){"DateTo"===y.isSelecting&&p(e)}}},a.createElement(h,{legend:r,decrement:()=>{m(d-1),F()},increment:()=>{m(d+1),F()}}),a.createElement("div",{className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(20rem,1fr))] bw-gap-6"},S.map((e=>a.createElement(g,{key:e,month:e,selected:y.monthSelectedMap[e]})))),a.createElement(l.ReactDialog.Root,{open:_,onOpenChange:M},a.createElement(l.Dialog,{className:"bw-max-w-3xl"},a.createElement(l.DialogTitle,null,"Edit ","dayoff"===n?"Day Off":"Holiday"),a.createElement(t.Form,{form:c,layout:"vertical",initialValues:N,onFinish:e=>{i(e),M(!1)}},a.createElement(E,null)),a.createElement(l.DialogFooter,null,a.createElement(l.ReactDialog.Close,{asChild:!0},a.createElement(l.Button,{variant:"trivial"},"Cancel")),a.createElement(l.Button,{onClick:()=>c.submit()},"OK")),a.createElement(l.DialogCloseIcon,null))))}const S=m.range(12),x=(new Date).getFullYear(),N={dateFrom:n.dayjs(),dateTo:n.dayjs(),isEveryYear:"selected_year",year:x,isHoliday:"true"};function _({value:r,onChange:l,allowClear:o=!1,minuteStep:c=5,format:d=s,use12Hours:m="12h"==window.booksterPublicData.generalSettings.time_system,inputReadOnly:u=!0,...b}){const[f,w]=e.useState(r?[n.dayjs().hour(r.start.hour).minute(r.start.minute),n.dayjs().hour(r.end.hour).minute(r.end.minute)]:null);return e.useEffect((()=>{var e,t,a,l;(null==r?void 0:r.start.hour)===(null==(e=null==f?void 0:f[0])?void 0:e.hour())&&(null==r?void 0:r.start.minute)===(null==(t=null==f?void 0:f[0])?void 0:t.minute())&&(null==r?void 0:r.end.hour)===(null==(a=null==f?void 0:f[1])?void 0:a.hour())&&(null==r?void 0:r.end.minute)===(null==(l=null==f?void 0:f[1])?void 0:l.minute())||w(r?[n.dayjs().hour(r.start.hour).minute(r.start.minute),n.dayjs().hour(r.end.hour).minute(r.end.minute)]:null)}),[r]),a.createElement(t.TimePicker.RangePicker,{value:f,onChange:e=>{w(e),e&&e[0]&&e[1]&&(null==l||l({start:i.Helper.booktime.createFromDayjs(e[0]),end:i.Helper.booktime.createFromDayjs(e[1])}))},allowClear:o,minuteStep:c,format:d,use12Hours:m,inputReadOnly:u,...b})}const M=e.createContext(null);function P(){const t=e.useContext(M);if(!t)throw new Error("Missing WeeklyScheduleEditorContext.Provider in the tree");return t}function R({weekday:r}){const{formNamePrefix:n}=P(),s=t.Form.useFormInstance(),i=e.useCallback((()=>{const e=s.getFieldValue([...n,r]);[c.Monday,c.Tuesday,c.Wednesday,c.Thursday,c.Friday].forEach((t=>{t!==r&&(s.setFieldValue([...n,t,"working"],e.working),s.setFieldValue([...n,t,"periods"],e.periods))}))}),[r,n,s]),d=e.useCallback((()=>{const e=s.getFieldValue([...n,r]);[c.Monday,c.Tuesday,c.Wednesday,c.Thursday,c.Friday,c.Saturday,c.Sunday].forEach((t=>{t!==r&&(s.setFieldValue([...n,t,"working"],e.working),s.setFieldValue([...n,t,"periods"],e.periods))}))}),[r,n,s]),m=e.useCallback((()=>{s.setFieldValue([...n,r,"working"],!1),s.setFieldValue([...n,r,"periods"],[])}),[r,n,s]);return a.createElement(l.DropdownMenu,null,a.createElement(l.DropdownMenuTrigger,{asChild:!0},a.createElement(o.Wrench,{className:"hover:bw-text-primary",onClick:e=>{e.stopPropagation()}})),a.createElement(l.DropdownMenuContent,{align:"end"},a.createElement(l.DropdownMenuArrow,null),a.createElement(l.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),i()}},a.createElement(o.NotebookPen,null),a.createElement("span",{className:"bw-ml-2"},"Apply to every Weekday")),a.createElement(l.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),d()}},a.createElement(o.CalendarDays,null),a.createElement("span",{className:"bw-ml-2"},"Apply to every Day")),a.createElement(l.DropdownMenuItem,{onClick:e=>{e.stopPropagation(),m()}},a.createElement(o.Trash,null),a.createElement("span",{className:"bw-ml-2"},"Delete All Time Period of ",T[r]))))}const T=n.dayjs().localeData().weekdays();function I(e){return null==e?void 0:e.filter((e=>e)).map((e=>`${e.start.hour.toString().padStart(2,"0")}:${e.start.minute.toString().padStart(2,"0")}~${e.end.hour.toString().padStart(2,"0")}:${e.end.minute.toString().padStart(2,"0")}`)).join(" | ")}function H({weekday:e}){const{formNamePrefix:r}=P(),l=t.Form.useFormInstance(),n=t.Form.useWatch([...r,e,"periods"],l);return a.createElement("span",null,I(n))}function j({weekday:e,onChange:r}){const{formNamePrefix:n}=P();return a.createElement("div",{className:"bw-flex bw-flex-auto bw-items-center bw-gap-3"},a.createElement(t.Form.Item,{name:[...n,e,"working"],trigger:"onCheckedChange",valuePropName:"checked",noStyle:!0},a.createElement(l.Switch,{checkedChildren:"Work",unCheckedChildren:"Off",onCheckedChange:e=>{r(e)},onClick:e=>e.stopPropagation()})),a.createElement("label",null,A[e]))}const A=n.dayjs().localeData().weekdays();function O({weekday:r}){const{formNamePrefix:n,defaultActivePanelKeys:s}=P(),[c,d]=e.useState(!!s.includes(r));return a.createElement(l.ReactCollapsible.Root,{onOpenChange:d,open:c},a.createElement(l.ReactCollapsible.Trigger,{asChild:!0},a.createElement("div",{className:"bw-flex bw-cursor-pointer bw-items-center bw-bg-base-bg2/60 bw-p-3 bw-pr-4"},a.createElement("span",{className:"bw-me-auto bw-flex-auto"},a.createElement("div",{className:"bw-mr-3 bw-flex"},a.createElement(j,{weekday:r,onChange:e=>d(e)}),a.createElement(H,{weekday:r}))),a.createElement(R,{weekday:r}))),a.createElement(l.CollapsibleContent,{forceMountWithAnimation:!0},a.createElement("div",{className:"bw-grid bw-grid-cols-[repeat(auto-fill,minmax(16rem,1fr))] bw-gap-x-4 bw-border-t bw-p-4"},a.createElement(t.Form.List,{name:[...n,r,"periods"],rules:[{validator:async(e,t)=>t?i.Helper.period.someOverlap(t.filter((e=>!!e)))?Promise.reject(new Error("Some Work Periods are overlapping")):void 0:Promise.resolve()}]},((e,{add:r,remove:n},{errors:s})=>a.createElement(a.Fragment,null,e.map((({key:e,name:r,...l})=>a.createElement("div",{key:e},a.createElement("div",{className:"bw-flex bw-items-start bw-gap-2"},a.createElement(t.Form.Item,{...l,name:r,className:"bw-flex-grow",rules:[{required:!0,message:"Please enter Work Period !"}]},a.createElement(_,{className:"bw-w-full",placeholder:["Start Time","End Time"]})),a.createElement(o.MinusCircle,{className:"bw-h-8 bw-cursor-pointer bw-text-error hover:bw-text-error/60",onClick:()=>n(r)}))))),a.createElement("div",null,a.createElement(t.Form.Item,null,a.createElement(l.Button,{variant:"trivial",className:"bw-w-full bw-border-dashed bw-py-0",onClick:()=>r()},a.createElement(o.Plus,null),"Add Work Period"),a.createElement(t.Form.ErrorList,{errors:s})))))))))}function W({formNamePrefix:e,defaultActivePanelKeys:t}){return a.createElement(M.Provider,{value:{formNamePrefix:e,defaultActivePanelKeys:t}},a.createElement("div",{className:"bw-mx-auto bw-w-full bw-divide-y bw-divide-base-border bw-rounded bw-border"},d.map((e=>a.createElement(O,{weekday:e,key:e})))))}export{F as H,W,w as a,h as b,g as c,I as g};
